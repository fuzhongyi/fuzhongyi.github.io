<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
    

    
<!-- Tencent Speed -->
<script>var _speedMark = new Date()</script>
<!-- End Tencent Speed -->
<!-- Tencent Analysis -->
<script async src="//tajs.qq.com/stats?sId=66539672"></script>
<!-- End Tencent Analysis -->


    
<!-- Baidu Tongji -->
<script>var _hmt = _hmt || []</script>
<script async src="//hm.baidu.com/hm.js?71d34fe208bc96e33a9d60adabaf9dcb"></script>
<!-- End Baidu Tongji -->



<!-- Baidu Site Verification-->
<meta name="baidu-site-verification" content="PAq6P6Yule">
<!-- End Baidu Site Verification-->




    <meta charset="utf-8">
    
    
    <link rel="canonical" href="https://xyue.me/2017/10/18/search-engine-solr-build/">
    
    
    <title>全文检索引擎 Solr 搭建 | XYue&#39;s Notes | Keep Going</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="solr">
    <meta name="description" content="Solr是一个高性能，采用Java5开发，基于Lucene的全文搜索服务器。同时对其进行了扩展，提供了比Lucene更为丰富的查询语言，同时实现了可配置、可扩展并对查询性能进行了优化，">
<meta name="keywords" content="solr">
<meta property="og:type" content="article">
<meta property="og:title" content="全文检索引擎 Solr 搭建">
<meta property="og:url" content="http://xyue.me/2017/10/18/search-engine-solr-build/index.html">
<meta property="og:site_name" content="XYue&#39;s Notes">
<meta property="og:description" content="Solr是一个高性能，采用Java5开发，基于Lucene的全文搜索服务器。同时对其进行了扩展，提供了比Lucene更为丰富的查询语言，同时实现了可配置、可扩展并对查询性能进行了优化，">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://xyue.me/2017/10/18/search-engine-solr-build/header-img.png">
<meta property="og:image" content="http://xyue.me/2017/10/18/search-engine-solr-build/2-1.png">
<meta property="og:image" content="http://xyue.me/2017/10/18/search-engine-solr-build/2-2.png">
<meta property="og:image" content="http://xyue.me/2017/10/18/search-engine-solr-build/2-3.png">
<meta property="og:image" content="http://xyue.me/2017/10/18/search-engine-solr-build/3-1.png">
<meta property="og:image" content="http://xyue.me/2017/10/18/search-engine-solr-build/3-2.png">
<meta property="og:image" content="http://xyue.me/2017/10/18/search-engine-solr-build/3-3.png">
<meta property="og:image" content="http://xyue.me/2017/10/18/search-engine-solr-build/4-1.png">
<meta property="og:image" content="http://xyue.me/2017/10/18/search-engine-solr-build/4-2.png">
<meta property="og:image" content="http://xyue.me/2017/10/18/search-engine-solr-build/4-3.png">
<meta property="og:image" content="http://xyue.me/2017/10/18/search-engine-solr-build/4-4.png">
<meta property="og:image" content="http://xyue.me/2017/10/18/search-engine-solr-build/4-5.png">
<meta property="og:image" content="http://xyue.me/2017/10/18/search-engine-solr-build/5-1.png">
<meta property="og:image" content="http://xyue.me/2017/10/18/search-engine-solr-build/5-2.png">
<meta property="og:image" content="http://xyue.me/2017/10/18/search-engine-solr-build/6-1.png">
<meta property="og:image" content="http://xyue.me/2017/10/18/search-engine-solr-build/6-2.png">
<meta property="og:updated_time" content="2020-01-20T03:49:52.122Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="全文检索引擎 Solr 搭建">
<meta name="twitter:description" content="Solr是一个高性能，采用Java5开发，基于Lucene的全文搜索服务器。同时对其进行了扩展，提供了比Lucene更为丰富的查询语言，同时实现了可配置、可扩展并对查询性能进行了优化，">
<meta name="twitter:image" content="http://xyue.me/2017/10/18/search-engine-solr-build/header-img.png">
    
        <link rel="alternate" type="application/atom+xml" title="XYue&#39;s Notes" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="https://avatars2.githubusercontent.com/u/26210263?v=4&s=460">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">歆月</h5>
          <a href="mailto:fuzy450@foxmail.com" title="fuzy450@foxmail.com" class="mail">fuzy450@foxmail.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                归档
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                标签
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                分类
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="http://wpa.qq.com/msgrd?v=3&uin=450805067&site=qq&menu=yes" target="_blank" >
                <i class="icon icon-lg icon-qq"></i>
                QQ
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/fuzhongyi" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://leetcode.xyue.me" target="_blank" >
                <i class="icon icon-lg icon-code"></i>
                LeetCode
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">全文检索引擎 Solr 搭建</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">全文检索引擎 Solr 搭建</h1>
        <h5 class="subtitle">
            
                <time datetime="2017-10-18T01:43:31.000Z" itemprop="datePublished" class="page-time">
  2017-10-18
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/技术水波文/">技术水波文</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#准备"><span class="post-toc-number">1.</span> <span class="post-toc-text">准备</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#配置环境"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">配置环境</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#目录说明"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">目录说明</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#启动"><span class="post-toc-number">2.</span> <span class="post-toc-text">启动</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#新建索引库core"><span class="post-toc-number">3.</span> <span class="post-toc-text">新建索引库core</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#导入数据"><span class="post-toc-number">4.</span> <span class="post-toc-text">导入数据</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#查询数据"><span class="post-toc-number">5.</span> <span class="post-toc-text">查询数据</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#分词器"><span class="post-toc-number">6.</span> <span class="post-toc-text">分词器</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#smartcn"><span class="post-toc-number">6.1.</span> <span class="post-toc-text">smartcn</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#IKAnalyzer"><span class="post-toc-number">6.2.</span> <span class="post-toc-text">IKAnalyzer</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#mmseg4j"><span class="post-toc-number">6.3.</span> <span class="post-toc-text">mmseg4j</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Analysis"><span class="post-toc-number">6.4.</span> <span class="post-toc-text">Analysis</span></a></li></ol></li></ol>
        </nav>
    </aside>
    
<article id="post-search-engine-solr-build"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">全文检索引擎 Solr 搭建</h1>
        <div class="post-meta">
            <time class="post-time" title="2017-10-18 09:43:31" datetime="2017-10-18T01:43:31.000Z"  itemprop="datePublished">2017-10-18</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/技术水波文/">技术水波文</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/2017/10/18/search-engine-solr-build/header-img.png" alt title>
                </div>
                <div class="image-caption"></div>
            </figure>
<blockquote>
<p>Solr是一个高性能，采用Java5开发，基于Lucene的全文搜索服务器。同时对其进行了扩展，提供了比Lucene更为丰富的查询语言，同时实现了可配置、可扩展并对查询性能进行了优化，并且提供了一个完善的功能管理界面，是一款非常优秀的全文搜索引擎。</p>
</blockquote>
<h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><h3 id="配置环境"><a href="#配置环境" class="headerlink" title="配置环境"></a>配置环境</h3><ul>
<li>window</li>
<li><a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html" target="_blank" rel="noopener">JDK 1.8</a></li>
<li><a href="https://mirrors.tuna.tsinghua.edu.cn/apache/lucene/solr/7.0.1/solr-7.0.1.zip" target="_blank" rel="noopener">Solr 7.0.1</a></li>
<li>oracle</li>
</ul>
<h3 id="目录说明"><a href="#目录说明" class="headerlink" title="目录说明"></a>目录说明</h3><p>下载Solr后解压得到目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">├─bin               // 脚本的启动目录</span><br><span class="line">├─contrib           // 第三方 jar 包存放目录</span><br><span class="line">├─dist              // 编译打包后存放目录，即构建后的输出产物存放目录</span><br><span class="line">├─docs              // solr 的 API 文档文档存放目录</span><br><span class="line">├─example           // 示范例子的存放目录，example-DIH 目录下的是一些 solr 索引 core 样例</span><br><span class="line">├─licenses          // solr 相关的一些许可信息</span><br><span class="line">└─server            // solr 服务端工作目录，自带集成 jetty 插件方式启动 solr 服务器</span><br><span class="line">    │ start.jar     // 服务端启动 jar 包</span><br><span class="line">    ├─solr          // solr 搜索引擎工作目录，即 SOLRHOME</span><br><span class="line">    └─solr-webapp   // solr 后台管理页面 webapp</span><br></pre></td></tr></table></figure>
<h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><p>进入 /bin 目录， 按住 shift + 鼠标右键打开命令窗口</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/2017/10/18/search-engine-solr-build/2-1.png" alt="打开命令窗口" title>
                </div>
                <div class="image-caption">打开命令窗口</div>
            </figure>
<p>输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">solr start</span><br></pre></td></tr></table></figure>
<p>启动 Solr 服务</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/2017/10/18/search-engine-solr-build/2-2.png" alt="启动 Solr 服务" title>
                </div>
                <div class="image-caption">启动 Solr 服务</div>
            </figure>
<p>在浏览器中输入 <a href="http://localhost:8983" target="_blank" rel="noopener">localhost:8983</a> 访问 Solr 管理后台</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/2017/10/18/search-engine-solr-build/2-3.png" alt="管理后台" title>
                </div>
                <div class="image-caption">管理后台</div>
            </figure>
<h2 id="新建索引库core"><a href="#新建索引库core" class="headerlink" title="新建索引库core"></a>新建索引库core</h2><p>输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">solr create -c my_core</span><br></pre></td></tr></table></figure>
<p>新建名为 my_core 的 core</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/2017/10/18/search-engine-solr-build/3-1.png" alt="create" title>
                </div>
                <div class="image-caption">create</div>
            </figure>
<p>创建成功后，在管理页面选择 Core Admin 可以看到刚创建的 core</p>
<p><img src="/2017/10/18/search-engine-solr-build/3-2.png" alt="Core Admin"></p>
<p>在 SOLRHOME （目录说明中有提到）下会生成 my_core 目录</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/2017/10/18/search-engine-solr-build/3-3.png" alt="my_core" title>
                </div>
                <div class="image-caption">my_core</div>
            </figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">├─conf               // 存放core的配置文件</span><br><span class="line">│    solrconfig.xml  // 定义了这个 core 的配置信息</span><br><span class="line">│    start.jar       // 定义索引库的字段及分词器等，这个配置文件是核心文件</span><br><span class="line">└─data               // 存放core的数据，即index-索引文件和log-日志记录</span><br></pre></td></tr></table></figure>
<h2 id="导入数据"><a href="#导入数据" class="headerlink" title="导入数据"></a>导入数据</h2><p>导入 oracle 表 <a href="/2017/10/18/search-engine-solr-build/news.sql">news</a> 中的数据</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/2017/10/18/search-engine-solr-build/4-1.png" alt="table_news" title>
                </div>
                <div class="image-caption">table_news</div>
            </figure>
<p>在 %SOLRHOME%/my_core/conf 目录下创建 data-config.xml 文件，并写入以下内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dataConfig</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">user</span>=<span class="string">"[user]"</span> <span class="attr">password</span>=<span class="string">"[password]"</span> <span class="attr">url</span>=<span class="string">"jdbc:oracle:thin:@[host]:[port]:[SID]"</span> <span class="attr">driver</span>=<span class="string">"oracle.jdbc.driver.OracleDriver"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">document</span> &gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 表中字段映射 </span></span><br><span class="line"><span class="comment">	     pk: 主键</span></span><br><span class="line"><span class="comment">	     transformer： clob 转换</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">entity</span> <span class="attr">name</span>=<span class="string">"news"</span> <span class="attr">pk</span>=<span class="string">"ID"</span> <span class="attr">query</span>=<span class="string">"select * from news"</span> <span class="attr">transformer</span>=<span class="string">"ClobTransformer"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"N_ID"</span>/&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"title"</span> <span class="attr">column</span>=<span class="string">"N_TITLE"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"content"</span> <span class="attr">column</span>=<span class="string">"N_CONTENT"</span> <span class="attr">clob</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"time"</span> <span class="attr">column</span>=<span class="string">"N_TIME"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">entity</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">document</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dataConfig</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在 %SOLRHOME%/my_core 下创建 lib 文件夹，并将 oracle 驱动包 <a href="http://www.datanucleus.org/downloads/maven2/oracle/ojdbc6/11.2.0.3/ojdbc6-11.2.0.3.jar" target="_blank" rel="noopener">ojdbc6.jar</a> 放到该目录下<br>此时 my_core 文件结构如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">│  core.properties</span><br><span class="line">│  </span><br><span class="line">├─conf</span><br><span class="line">│  │  data-config.xml</span><br><span class="line">│  │  dataimport.properties</span><br><span class="line">│  │  managed-schema</span><br><span class="line">│  │  params.json</span><br><span class="line">│  │  protwords.txt</span><br><span class="line">│  │  solrconfig.xml</span><br><span class="line">│  │  stopwords.txt</span><br><span class="line">│  │  synonyms.txt</span><br><span class="line">│  └─lang        </span><br><span class="line">├─data        </span><br><span class="line">└─lib</span><br><span class="line">        ojdbc6.jar</span><br></pre></td></tr></table></figure>
<p>编辑 %SOLRHOME%/my_core/conf/solrconfig.xml，添加类库和数据库配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">lib</span> <span class="attr">dir</span>=<span class="string">"$&#123;solr.install.dir:../../../..&#125;/dist/"</span> <span class="attr">regex</span>=<span class="string">"solr-dataimporthandler-\d.*\.jar"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">requestHandler</span> <span class="attr">name</span>=<span class="string">"/dataimport"</span> <span class="attr">class</span>=<span class="string">"solr.DataImportHandler"</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">lst</span> <span class="attr">name</span>=<span class="string">"defaults"</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">str</span> <span class="attr">name</span>=<span class="string">"config"</span>&gt;</span>data-config.xml<span class="tag">&lt;/<span class="name">str</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">lst</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">requestHandler</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>选择当前 my_core ,选择 Schema, 添加索引字段 <strong>（字段名称和 solrconfig.xml 中 field 相同，忽略主键）</strong></p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/2017/10/18/search-engine-solr-build/4-2.png" alt="Add Filed" title>
                </div>
                <div class="image-caption">Add Filed</div>
            </figure>
<p>添加完成后，打开 %SOLRHOME%/my_core/conf/managed-schema，可以看到，此时添加索引字段已写入该文件中</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/2017/10/18/search-engine-solr-build/4-3.png" alt="managed-schema" title>
                </div>
                <div class="image-caption">managed-schema</div>
            </figure>
<p>在命令台中输入<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">solr restart -p 8983</span><br></pre></td></tr></table></figure></p>
<p>重启服务</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/2017/10/18/search-engine-solr-build/4-4.png" alt="restart" title>
                </div>
                <div class="image-caption">restart</div>
            </figure>
<p>进入管理界面，选择 my_core –&gt; Dataimport –&gt; Execute 导入数据，可以点击 Refresh Status 查看导入状态</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/2017/10/18/search-engine-solr-build/4-5.png" alt="Dataimport" title>
                </div>
                <div class="image-caption">Dataimport</div>
            </figure>
<h2 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h2><p>选择 Query</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/2017/10/18/search-engine-solr-build/5-1.png" alt="Query" title>
                </div>
                <div class="image-caption">Query</div>
            </figure>
<p>点击 Execute Query 查询数据</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/2017/10/18/search-engine-solr-build/5-2.png" alt="Execute Query" title>
                </div>
                <div class="image-caption">Execute Query</div>
            </figure>
<h2 id="分词器"><a href="#分词器" class="headerlink" title="分词器"></a>分词器</h2><p><code>smartcn</code> 、 <code>IKAnalyzer</code> 、 <code>mmseg4j</code>，选择其中任意一种即可</p>
<h3 id="smartcn"><a href="#smartcn" class="headerlink" title="smartcn"></a>smartcn</h3><p>smartcn 是 Solr 同步发行的一个中文分词包，将 solr-7.0.1/contrib/analysis-extras/lucene-libs/lucene-analyzers-smartcn-7.0.1.jar 拷贝至 %SOLRHOME%/my_core/lib，编辑 %SOLRHOME%/my_core/conf/managed-schema 文件，添加配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- smartcn --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_smartcn"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"0"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">analyzer</span> <span class="attr">type</span>=<span class="string">"index"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"org.apache.lucene.analysis.cn.smart.HMMChineseTokenizerFactory"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">analyzer</span> <span class="attr">type</span>=<span class="string">"query"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"org.apache.lucene.analysis.cn.smart.HMMChineseTokenizerFactory"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- smartcn --&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="IKAnalyzer"><a href="#IKAnalyzer" class="headerlink" title="IKAnalyzer"></a>IKAnalyzer</h3><blockquote>
<p>IKAnalyzer 是一个开源的，基于 java 语言开发的轻量级的中文分词工具包。</p>
</blockquote>
<p>将 <a href="https://github.com/EugenePig/ik-analyzer-solr5" target="_blank" rel="noopener">ik-analyzer-solr5</a> 打包后放至 %SOLRHOME%/my_core/lib 下<br>编辑 %SOLRHOME%/my_core/conf/managed-schema 文件，添加配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- IKAnalyzer --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_ik"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">analyzer</span> <span class="attr">type</span>=<span class="string">"index"</span> <span class="attr">isMaxWordLength</span>=<span class="string">"false"</span> <span class="attr">class</span>=<span class="string">"org.wltea.analyzer.lucene.IKAnalyzer"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">analyzer</span> <span class="attr">type</span>=<span class="string">"query"</span> <span class="attr">isMaxWordLength</span>=<span class="string">"true"</span> <span class="attr">class</span>=<span class="string">"org.wltea.analyzer.lucene.IKAnalyzer"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- IKAnalyzer --&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="mmseg4j"><a href="#mmseg4j" class="headerlink" title="mmseg4j"></a>mmseg4j</h3><blockquote>
<ul>
<li>mmseg4j 用 Chih-Hao Tsai 的 MMSeg <a href="http://technology.chtsai.org/mmseg" target="_blank" rel="noopener">算法</a> 实现的中文分词器，并实现 lucene 的 analyzer 和 solr 的TokenizerFactory 以方便在Lucene和Solr中使用。</li>
<li>MMSeg 算法有两种分词方法： Simple 和 Complex，都是基于正向最大匹配。</li>
<li>mmseg4j 有三种分词模式 simple | complex | max-word，默认是 max-word。</li>
<li>mmseg4j 的词库强制使用 UTF-8。</li>
</ul>
</blockquote>
<p>下载需要的包</p>
<ul>
<li><a href="http://central.maven.org/maven2/com/chenlb/mmseg4j/mmseg4j-core/1.10.0/mmseg4j-core-1.10.0.jar" target="_blank" rel="noopener">mmseg4j-core-1.10.0.jar</a></li>
<li><a href="http://central.maven.org/maven2/com/chenlb/mmseg4j/mmseg4j-solr/2.4.0/mmseg4j-solr-2.4.0.jar" target="_blank" rel="noopener">mmseg4j-solr-2.4.0.jar</a></li>
</ul>
<p>放至 %SOLRHOME%/my_core/lib 中<br>编辑 %SOLRHOME%/my_core/conf/managed-schema 文件，添加配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- mmseg4j--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_mmseg4j_complex"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span> &gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"com.chenlb.mmseg4j.solr.MMSegTokenizerFactory"</span> <span class="attr">mode</span>=<span class="string">"complex"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_mmseg4j_maxword"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span> &gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"com.chenlb.mmseg4j.solr.MMSegTokenizerFactory"</span> <span class="attr">mode</span>=<span class="string">"max-word"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_mmseg4j_simple"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span> &gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"com.chenlb.mmseg4j.solr.MMSegTokenizerFactory"</span> <span class="attr">mode</span>=<span class="string">"simple"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- mmseg4j--&gt;</span></span><br></pre></td></tr></table></figure>
<p>重启服务</p>
<h3 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h3><p>分词器配置完成后，选择 Analysis，输入要分词的内容（Field Value），选择字段类型（Analyse Fieldname / FieldType [与配置信息 fieldType name 同步]），点击 Analyse Values 获取分词结果。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/2017/10/18/search-engine-solr-build/6-1.png" alt="Analyse Values" title>
                </div>
                <div class="image-caption">Analyse Values</div>
            </figure>
<p>编辑 %SOLRHOME%/my_core/conf/managed-schema，修改索引字段类型为新添加分词类型其中任意一种即可，这里我们将 text_general 修改为 text_ik，重启服务后重新导入数据</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/2017/10/18/search-engine-solr-build/6-2.png" alt="Modify Type" title>
                </div>
                <div class="image-caption">Modify Type</div>
            </figure>
<p>这样我们在对该字段行进搜索时就能达到分词搜索的效果了😛</p>

        </div>

        <blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2020-01-20T03:49:52.122Z" itemprop="dateUpdated">2020-01-20 11:49:52</time>
</span><br>


        
        <a href="/2017/10/18/search-engine-solr-build/" target="_blank" rel="external">http://xyue.me/2017/10/18/search-engine-solr-build/</a>
        
    </div>
    <footer>
        <a href="http://xyue.me">
            <img src="https://avatars2.githubusercontent.com/u/26210263?v=4&s=460" alt="歆月">
            歆月
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/solr/">solr</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://xyue.me/2017/10/18/search-engine-solr-build/&title=《全文检索引擎 Solr 搭建》 — XYue's Notes&pic=https://avatars2.githubusercontent.com/u/26210263?v=4&s=460" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://xyue.me/2017/10/18/search-engine-solr-build/&title=《全文检索引擎 Solr 搭建》 — XYue's Notes&source=🌠 瞎琢磨，乱折腾 🌠" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://xyue.me/2017/10/18/search-engine-solr-build/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《全文检索引擎 Solr 搭建》 — XYue's Notes&url=http://xyue.me/2017/10/18/search-engine-solr-build/&via=http://xyue.me" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://xyue.me/2017/10/18/search-engine-solr-build/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2017/11/27/ionic-start-white-screen/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">ionic3 启动白屏解决</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2017/10/12/problems-of-using-ueditor/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">使用 UEditor(JSP 1.4.3版本) 遇到的问题</h4>
      </a>
    </div>
  
</nav>



    

<section class="comments" id="comments">
    <div id="lv-container" data-id="city" data-uid="MTAyMC8zMDY2MC83MjE1">
        <script type="text/javascript">
            (function(d, s) {
                var j, e = d.getElementsByTagName(s)[0];
                if (typeof LivereTower === 'function') { return; }
                j = d.createElement(s);
                j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
                j.async = true;
                e.parentNode.insertBefore(j, e);
            })(document, 'script');
        </script>
        <noscript>为正常使用来必力评论功能请激活JavaScript</noscript>
    </div>
</section>













</article>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        <i class="icon icon-user"></i><span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        <i class="icon icon-eye"></i><span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>歆月 &copy; 2017 - 2020</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://xyue.me/2017/10/18/search-engine-solr-build/&title=《全文检索引擎 Solr 搭建》 — XYue's Notes&pic=https://avatars2.githubusercontent.com/u/26210263?v=4&s=460" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://xyue.me/2017/10/18/search-engine-solr-build/&title=《全文检索引擎 Solr 搭建》 — XYue's Notes&source=🌠 瞎琢磨，乱折腾 🌠" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://xyue.me/2017/10/18/search-engine-solr-build/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《全文检索引擎 Solr 搭建》 — XYue's Notes&url=http://xyue.me/2017/10/18/search-engine-solr-build/&via=http://xyue.me" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://xyue.me/2017/10/18/search-engine-solr-build/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACL0lEQVR42u3aza6CMBAGUN//pbmJW6X5plNvQntYGVToYTF0fl6v+LjeR3L++jg+z3/+9+5fiw8MDIzHMq7hcXfLu8WNfz8mJedvqRgYGAcwxsF0HASTb/NQm9wXAwMDox9Yk8/JGQwMDIy5gDv+ffJtNbnFwMDAyJPYpCiWFMvG1/l5Lo6BgfFARrUx8J+ff9jfwMDAeAjjmjqSjWAeQPurwsDA2JtRXdDaMtlcmzMKuxgYGBsxEkB1/KLa2uw0Tb+8NzAwMLZj9FuV1dBZLZwVXgMYGBibMvoBd1ULIR8d+3IFDAyMrRlzLcw81UwW2i/AYWBgnMBIEtF8w7eqhFctxmFgYOzKyBPIzoYvT26rhTkMDIwTGNXy/dwmMt8URsnq3ZoxMDC2ZnSCYBUwd6/yvzAwMDZlJEX/6kWT0tuqjSYGBsYJjE65vzraVeVVy3YYGBh7M/Im5ZhaTVYXPHsMDIytGfnl8lCbP5o8GV62t8XAwHgsozrOVd3YVcv95SIdBgbGAYy5gFstonVamz98b2BgYDyQUR3F6Cy681AwMDDOYeSJZb4FTHjlluTcQBgGBsbDGf2lJONf+YjYXOMBAwNjb8ba/uBkQX9qFGzBEAYGBsajGNUiV3/8YvxEJwMuBgbGAYxq4Es2gqsS12h0DAMDA2Np8pk3JCb7GxgYGAczqmlqJ3FNQjYGBsZpjCSJ7bQ2q3csbx8xMDC2ZnQmNeYS0eo1czYGBsZ2jD/4fiLgTmQzHAAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '死鬼去哪里了😥!';
            clearTimeout(titleTime);
        } else {
            document.title = '咦!回来啦😋!';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
