[{"title":"async/await å®ç°åŸç†","date":"2020-05-29T09:56:43.000Z","path":"2020/05/29/async-await-realize/","text":"ä½¿ç”¨123456789101112var p1 = () =&gt; new Promise(resolve =&gt; setTimeout(() =&gt; resolve('Promisem 1'), 3000));var p2 = () =&gt; new Promise(resolve =&gt; setTimeout(() =&gt; resolve('Promisem 2'), 3000));async function test() &#123; var data1 = await p1(); console.log(data1); var data2 = await p2(); console.log(data2); return 'end';&#125;test().then(console.log); å®ç°123456789101112131415161718192021222324252627var p1 = () =&gt; new Promise(resolve =&gt; setTimeout(() =&gt; resolve('Promisem 1'), 3000));var p2 = () =&gt; new Promise(resolve =&gt; setTimeout(() =&gt; resolve('Promisem 2'), 3000));function* test() &#123; var data1 = yield p1(); console.log(data1); var data2 = yield p2(); console.log(data2); return 'end';&#125;function asyncToGenerator(gen) &#123; return new Promise((resolve, reject) =&gt; &#123; var g = gen.apply(this, Array.prototype.slice.call(arguments, 1)); function step(val) &#123; var result = g.next(val); if (result.done) &#123; resolve(result.value); &#125; else &#123; Promise.resolve(result.value).then(step, reject); &#125; &#125; step(); &#125;);&#125;asyncToGenerator(test).then(console.log);","tags":[{"name":"javascript","slug":"javascript","permalink":"http://xyue.me/tags/javascript/"},{"name":"async","slug":"async","permalink":"http://xyue.me/tags/async/"}]},{"title":"ä¸€æ–‡çœ‹å°½ reduxï¼Œä¸­é—´ä»¶è®¾è®¡å®ç°","date":"2020-04-15T09:30:57.000Z","path":"2020/04/15/react-redux-middleware/","text":"reduxReact ä½œä¸ºä¸€ä¸ªç»„ä»¶åŒ–å¼€å‘æ¡†æ¶ï¼Œç»„ä»¶ä¹‹é—´å­˜åœ¨å¤§é‡é€šä¿¡ï¼Œæœ‰æ—¶è¿™äº›é€šä¿¡è·¨è¶Šå¤šä¸ªç»„ä»¶ï¼Œæˆ–è€…å¤šä¸ªç»„ä»¶ä¹‹é—´å…±äº«ä¸€å¥—æ•°æ®ï¼Œç®€å•çš„çˆ¶å­ç»„ä»¶é—´ä¼ å€¼ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œè‡ªç„¶è€Œç„¶åœ°ï¼Œæˆ‘ä»¬éœ€è¦æœ‰ä¸€ä¸ªåœ°æ–¹å­˜å–å’Œæ“ä½œè¿™äº›å…¬å…±çŠ¶æ€ã€‚è€Œ redux å°±ä¸ºæˆ‘ä»¬æä¾›äº†è¿™æ ·ä¸€ç§ç®¡ç†å…¬å…±çŠ¶æ€çš„æ–¹æ¡ˆã€‚ äº†è§£äº†ä»€ä¹ˆæ˜¯ reduxï¼Œä»¥åŠå®ƒçš„åˆ°æ¥ä¸ºæˆ‘ä»¬è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Œæˆ‘ä»¬å›´ç»•è¿™ä¸€åŠŸèƒ½ï¼Œé€æ­¥å®ç°ã€‚ æ—¢ç„¶æ˜¯å…¬å…±çŠ¶æ€ï¼Œé‚£ä¹ˆæˆ‘ä»¬åˆ›å»ºè¿™æ ·ä¸€ä¸ªæ–‡ä»¶ store.jsï¼Œç„¶åç›´æ¥åœ¨é‡Œè¾¹å­˜æ”¾å…¬å…±çš„ stateï¼Œå…¶ä»–ç»„ä»¶åªè¦å¼•å…¥è¿™ä¸ª store å°±å¯ä»¥å­˜å–å…±ç”¨çŠ¶æ€äº†ã€‚ 123export const state = &#123; count: 0&#125; å½“ç„¶æˆ‘ä»¬å¹¶ä¸èƒ½è¿™æ ·å»è®¾è®¡ï¼Œä¸»è¦åŸå› æœ‰ 2 ç‚¹ï¼š å®¹æ˜“è¯¯æ“ä½œ - å…¶ä»–ä»»ä½•åœ°æ–¹å‡å¯ä»¥ä¿®æ”¹ stateï¼Œè¿™æ ·åšæ˜¾ç„¶ä¸å¤ªå®‰å…¨ å‡ºé”™äº†ä¹Ÿå¾ˆéš¾æ’æŸ¥ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æœ‰æ¡ä»¶åœ°æ“ä½œ storeï¼Œé˜²æ­¢ä½¿ç”¨è€…ç›´æ¥ä¿®æ”¹ store çš„æ•°æ® å¯è¯»æ€§å¾ˆå·® - js æ˜¯ä¸€é—¨æå…¶ä¾èµ–è¯­ä¹‰åŒ–çš„è¯­è¨€ï¼Œè¯•æƒ³å¦‚æœåœ¨ä»£ç ä¸­ä¸ç»æ³¨é‡Šç›´æ¥ä¿®æ”¹äº†å…¬ç”¨çš„ stateï¼Œéš¾ä»¥ç»´æŠ¤ï¼Œä¸ºäº†ææ¸…æ¥šä¿®æ”¹ state çš„å«ä¹‰è¿˜å¾—æ ¹æ®ä¸Šä¸‹æ–‡æ¨æ–­ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ€å¥½æ˜¯ç»™æ¯ä¸ªæ“ä½œèµ·ä¸ªåå­— æ€è€ƒï¼š æˆ‘ä»¬å¸Œæœ›å…¬å…±çŠ¶æ€æ—¢èƒ½å¤Ÿè¢«å…¨å±€è®¿é—®åˆ°ï¼Œåˆæ˜¯ç§æœ‰çš„ä¸èƒ½è¢«ç›´æ¥ä¿®æ”¹ï¼Œé—­åŒ…å®Œå…¨æ»¡è¶³è¿™ä¸¤æ¡è¦æ±‚ï¼Œå› æ­¤æˆ‘ä»¬ä¼šæŠŠå…¬å…±çŠ¶æ€è®¾è®¡æˆé—­åŒ…ã€‚ æ—¢ç„¶æˆ‘ä»¬è¦å­˜å–çŠ¶æ€ï¼Œé‚£ä¹ˆè‚¯å®šè¦æœ‰ getter å’Œ setterï¼Œæ­¤å¤–å½“çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæˆ‘ä»¬å¾—è¿›è¡Œå¹¿æ’­ï¼Œé€šçŸ¥ç»„ä»¶çŠ¶æ€å‘ç”Ÿäº†å˜æ›´ã€‚ è¿™ä¸å°±å’Œ redux çš„ä¸‰ä¸ª apiï¼šgetStateã€dispatchã€subscribe å¯¹åº”ä¸Šäº†å—ã€‚ æˆ‘ä»¬ç”¨å‡ å¥ä»£ç å‹¾å‹’å‡º store çš„å¤§è‡´å½¢çŠ¶ï¼š 1234567export const createStore = () =&gt; &#123; let currentState = &#123;&#125; // å…¬å…±çŠ¶æ€ function getState() &#123;&#125; // getter function dispatch() &#123;&#125; // setter function subscribe() &#123;&#125; // å‘å¸ƒè®¢é˜… return &#123; getState, dispatch, subscribe &#125;&#125; getState å®ç°getState() çš„å®ç°éå¸¸ç®€å•ï¼Œè¿”å›å½“å‰çŠ¶æ€å³å¯ï¼š 123456789export const createStore = () =&gt; &#123; let currentState = &#123;&#125; // å…¬å…±çŠ¶æ€ function getState() &#123; // getter return currentState; &#125; function dispatch() &#123;&#125; // setter function subscribe() &#123;&#125; // å‘å¸ƒè®¢é˜… return &#123; getState, dispatch, subscribe &#125;&#125; dispatch å®ç°ç»è¿‡ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯æœ‰æ¡ä»¶åœ°ã€å…·ååœ°ä¿®æ”¹ store çš„æ•°æ®ã€‚æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬åƒ redux ä¸­ dispatch é‚£æ ·ä¼ å…¥ä¸€ä¸ª action å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åŒ…å«æ“ä½œç±»å‹ typeï¼Œæ ¹æ® type çš„ä¸åŒå¯¹åº”ä¿®æ”¹è¿”å›ä¸åŒçš„ stateã€‚ 1234567891011121314151617export const createStore = () =&gt; &#123; let currentState = &#123;&#125; function getState() &#123; return currentState &#125; function dispatch(action) &#123; switch (action.type) &#123; case 'plus': currentState = &#123; ...state, count: currentState.count + 1 &#125; &#125; &#125; function subscribe() &#123;&#125; return &#123; getState, subscribe, dispatch &#125;&#125; ä½†æ˜¯è¿™æ ·æˆ‘ä»¬æŠŠæ‰§è¡Œé€»è¾‘å†™åœ¨äº† dispatch ä¸­ï¼Œè€¦åˆåº¦å¤ªé«˜ï¼Œäºæ˜¯æˆ‘ä»¬æƒ³åˆ°æŠŠè¿™éƒ¨åˆ†ä»£ç æŠ½ç¦»å‡ºæ¥æ”¾åˆ°å¤–é¢ã€‚ 1234567891011export const createStore = (reducer) =&gt; &#123; let currentState = &#123;&#125; function getState() &#123; return currentState &#125; function dispatch(action) &#123; currentState = reducer(currentState, action) &#125; function subscribe() &#123;&#125; return &#123; getState, subscribe, dispatch &#125;&#125; è¿™ä¸å°±æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„ reducer å—ï¼Œç„¶åæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª reducer.js æ–‡ä»¶ï¼Œå†™æˆ‘ä»¬çš„ reducerã€‚ 12345678910111213141516171819const initialState = &#123; count: 0&#125;export function reducer(state = initialState, action) &#123; switch(action.type) &#123; case 'plus': return &#123; ...state, count: state.count + 1 &#125; case 'subtract': return &#123; ...state, count: state.count - 1 &#125; default: return initialState &#125;&#125; ä»£ç å†™åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥éªŒè¯ä¸€ä¸‹ getState å’Œ dispatchã€‚ 12345import &#123; reducer &#125; from './reducer'const store = createStore(reducer) // åˆ›å»ºstorestore.dispatch(&#123; type: 'plus' &#125;) // æ‰§è¡ŒåŠ æ³•æ“ä½œï¼Œç»™ count åŠ  1console.log(store.getState()) // è·å– state è¿è¡Œä»£ç ï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œæ‰“å°å¾—åˆ°çš„ state æ˜¯ï¼š{ count: NaN }ã€‚è¿™æ˜¯å› ä¸ºï¼Œstore ä¸­ state çš„åˆå§‹æ•°æ®ä¸º {}ï¼Œ state.count + 1 å®é™…ä¸Šæ˜¯ underfind + 1ã€‚ æ‰€ä»¥æˆ‘ä»¬å¾—å…ˆè¿›è¡Œ state æ•°æ®çš„åˆå§‹åŒ–ï¼š 123456789101112export const createStore = (reducer) =&gt; &#123; let currentState = &#123;&#125; function getState() &#123; return currentState &#125; function dispatch(action) &#123; currentState = reducer(currentState, action) &#125; dispatch(&#123;type:'@STATE_INIT@'&#125;); // åˆå§‹åŒ– state æ•°æ® function subscribe() &#123;&#125; return &#123; getState, subscribe, dispatch &#125;&#125; è¿™æ ·æˆ‘ä»¬å°±èƒ½å¾—åˆ°æ­£ç¡®çš„ stateï¼š{ count: 1 }ã€‚ subscribe å®ç°å°½ç®¡æˆ‘ä»¬å·²ç»èƒ½å¤Ÿå­˜å–å…¬ç”¨ stateï¼Œä½† store çš„å˜åŒ–å¹¶ä¸ä¼šç›´æ¥å¼•èµ·è§†å›¾çš„æ›´æ–°ï¼Œæˆ‘ä»¬éœ€è¦ç›‘å¬ store çš„å˜åŒ–ã€‚æ¯æ¬¡ dispatchï¼Œéƒ½è¿›è¡Œå¹¿æ’­ï¼Œé€šçŸ¥ç»„ä»¶ store çš„çŠ¶æ€å‘ç”Ÿäº†å˜æ›´ï¼Œè¿™é‡Œæˆ‘ä»¬åº”ç”¨ä¸€ä¸ªè®¾è®¡æ¨¡å¼â€”â€”è§‚å¯Ÿè€…æ¨¡å¼ã€‚ 123456789101112131415161718192021export const createStore = (reducer) =&gt; &#123; let currentState = &#123;&#125; let observers = [] // è§‚å¯Ÿè€…é˜Ÿåˆ— function getState() &#123; return currentState &#125; function dispatch(action) &#123; currentState = reducer(currentState, action) observers.forEach(fn =&gt; fn()) &#125; dispatch(&#123;type:'@STATE_INIT@'&#125;); // åˆå§‹åŒ– state æ•°æ® function subscribe(fn) &#123; observers.push(fn) &#125; return &#123; getState, subscribe, dispatch &#125;&#125;const store = createStore(reducer) store.subscribe(() =&gt; &#123; console.log('ç»„ä»¶ 1 æ”¶åˆ° store çš„é€šçŸ¥') &#125;)store.subscribe(() =&gt; &#123; console.log('ç»„ä»¶ 2 æ”¶åˆ° store çš„é€šçŸ¥') &#125;)store.dispatch(&#123; type: 'plus' &#125;) // æ‰§è¡Œ dispatchï¼Œè§¦å‘ store çš„é€šçŸ¥ åˆ°è¿™é‡Œï¼Œä¸€ä¸ªç®€å•çš„ redux å°±å·²ç»å®Œæˆã€‚ ä½†æˆ‘ä»¬åœ¨ä½¿ç”¨ store æ—¶ï¼Œéœ€è¦åœ¨æ¯ä¸ªç»„ä»¶ä¸­ import å¼•å…¥ storeï¼Œç„¶åè·å–çŠ¶æ€(getState)ï¼Œä¿®æ”¹çŠ¶æ€(dispatch) ï¼Œè®¢é˜…æ›´æ–°(subscribe)ï¼Œä»£ç æ¯”è¾ƒå†—ä½™ï¼Œæˆ‘ä»¬éœ€è¦åˆå¹¶ä¸€äº›é‡å¤æ“ä½œï¼Œè€Œå…¶ä¸­ä¸€ç§ç®€åŒ–åˆå¹¶çš„æ–¹æ¡ˆï¼Œå°±æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„ react-reduxã€‚ react-reduxä¸Šæ–‡æˆ‘ä»¬è¯´åˆ°ï¼Œä¸€ä¸ªç»„ä»¶å¦‚æœæƒ³ä» store å­˜å–å…¬ç”¨çŠ¶æ€ï¼Œéœ€è¦è¿›è¡Œå››æ­¥æ“ä½œã€‚ react-redux æä¾› Provider å’Œ connect ä¸¤ä¸ª APIï¼ŒProvider å°† store æ”¾è¿› this.context é‡Œï¼Œçœå»äº† import è¿™ä¸€æ­¥ï¼Œconnect å°† getStateã€dispatch åˆå¹¶è¿›äº† this.propsï¼Œå¹¶è‡ªåŠ¨è®¢é˜…æ›´æ–°ï¼Œç®€åŒ–äº†å¦å¤–ä¸‰æ­¥ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¦‚ä½•å®ç°è¿™ä¸¤ä¸ª APIï¼š Provider å®ç°Provider æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œæ¥æ”¶ store å¹¶å°†å…¶æ”¾è¿›å…¨å±€ contextã€‚ 123456789101112131415161718192021222324import React, &#123; Component &#125; from 'react'import PropTypes from 'prop-types'export class Provider extends Component &#123; // éœ€è¦å£°æ˜é™æ€å±æ€§ childContextTypes æ¥æŒ‡å®š context å¯¹è±¡çš„å±æ€§ï¼Œæ˜¯ context çš„å›ºå®šå†™æ³• static childContextTypes = &#123; store: PropTypes.object &#125; // å®ç° getChildContext æ–¹æ³•ï¼Œè¿”å› context å¯¹è±¡ï¼Œä¹Ÿæ˜¯å›ºå®šå†™æ³• getChildContext() &#123; return &#123; store: this.store &#125; &#125; constructor(props, context) &#123; super(props, context) this.store = props.store &#125; // æ¸²æŸ“è¢« Provider åŒ…è£¹çš„ç»„ä»¶ render() &#123; return this.props.children &#125;&#125; å®Œæˆ Provider åï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦å†å•ç‹¬ import storeï¼Œå¯ç›´æ¥åœ¨ç»„ä»¶ä¸­é€šè¿‡ this.context.store å–åˆ° storeã€‚ connect å®ç°ä¸‹é¢æˆ‘ä»¬æ¥æ€è€ƒä¸€ä¸‹å¦‚ä½•å®ç° connectï¼Œæˆ‘ä»¬å…ˆå›é¡¾ä¸€ä¸‹ connect çš„ä½¿ç”¨æ–¹æ³•ï¼š 1connect(mapStateToProps, mapDispatchToProps)(App) æˆ‘ä»¬çŸ¥é“ï¼Œconnect æ¥æ”¶ mapStateToPropsã€mapDispatchToProps ä¸¤ä¸ªæ–¹æ³•ï¼Œç„¶åè¿”å›ä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼Œè¿™ä¸ªé«˜é˜¶å‡½æ•°æ¥æ”¶ä¸€ä¸ªç»„ä»¶ï¼Œè¿”å›ä¸€ä¸ªé«˜é˜¶ç»„ä»¶ï¼Œå…¶å®ç›®çš„å°±æ˜¯ç»™ä¼ å…¥ç»„ä»¶å¢åŠ ä¸€äº›å±æ€§å’ŒåŠŸèƒ½ï¼Œconnect æ ¹æ®ä¼ å…¥çš„ mapStateToPropsã€mapDispatchToPropsï¼Œå°† state å’Œ dispatch(action) æŒ‚è½½åˆ°å­ç»„ä»¶çš„ props ä¸Šï¼š 12345678910111213141516171819202122232425262728293031323334import React from 'react'export function connect(mapStateToProps, mapDispatchToProps) &#123; return function(Component) &#123; class Connect extends React.Component &#123; componentDidMount() &#123; // ä» context è·å– store å¹¶è®¢é˜…æ›´æ–° this.context.store.subscribe(this.handleStoreChange.bind(this)); &#125; handleStoreChange() &#123; // è§¦å‘æ›´æ–° // è§¦å‘çš„æ–¹æ³•æœ‰å¤šç§ï¼Œè¿™é‡Œä¸ºäº†ç®€æ´èµ·è§ï¼Œç›´æ¥ forceUpdate å¼ºåˆ¶æ›´æ–°ï¼Œè¯»è€…ä¹Ÿå¯ä»¥é€šè¿‡ setState æ¥è§¦å‘å­ç»„ä»¶æ›´æ–° this.forceUpdate() &#125; render() &#123; return ( &lt;Component // ä¼ å…¥è¯¥ç»„ä»¶çš„ propsï¼Œéœ€è¦ç”± connect è¿™ä¸ªé«˜é˜¶ç»„ä»¶åŸæ ·ä¼ å›åŸç»„ä»¶ &#123; ...this.props &#125; // æ ¹æ® mapStateToProps æŠŠ state æŒ‚åˆ° this.props ä¸Š &#123; ...mapStateToProps(this.context.store.getState()) &#125; // æ ¹æ® mapDispatchToProps æŠŠ dispatch(action) æŒ‚åˆ° this.props ä¸Š &#123; ...mapDispatchToProps(this.context.store.dispatch) &#125; /&gt; ) &#125; &#125; // æ¥æ”¶ context çš„å›ºå®šå†™æ³• Connect.contextTypes = &#123; store: PropTypes.object &#125; return Connect &#125;&#125; redux Middlewareæ‰€è°“ä¸­é—´ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºæ‹¦æˆªå™¨ï¼Œç”¨äºå¯¹æŸäº›è¿‡ç¨‹è¿›è¡Œæ‹¦æˆªå’Œå¤„ç†ï¼Œä¸”ä¸­é—´ä»¶ä¹‹é—´èƒ½å¤Ÿä¸²è”ä½¿ç”¨ã€‚åœ¨ redux ä¸­ï¼Œæˆ‘ä»¬ä¸­é—´ä»¶æ‹¦æˆªçš„æ˜¯ dispatch æäº¤åˆ° reducer è¿™ä¸ªè¿‡ç¨‹ï¼Œä»è€Œå¢å¼º dispatch çš„åŠŸèƒ½ã€‚ å¯æŸ¥é˜…å®˜æ–¹æ–‡æ¡£ã€‚ æ¥ä¸‹æ¥è®©æˆ‘ä»¬å’Œå®˜æ–¹æ–‡æ¡£ä¸€æ ·ï¼Œä»¥ä¸€ä¸ªè®°å½•æ—¥å¿—çš„ä¸­é—´ä»¶ä¸ºä¾‹ï¼Œä¸€æ­¥ä¸€æ­¥åˆ†æ redux ä¸­é—´ä»¶çš„è®¾è®¡å®ç°ã€‚ åœ¨æ¯æ¬¡ dispatch ä¹‹åæ‰‹åŠ¨æ‰“å° store çš„å†…å®¹å‡å¦‚æˆ‘ä»¬æƒ³åœ¨æ¯æ¬¡ dispatch ä¹‹åï¼Œæ‰“å°ä¸€ä¸‹ store çš„å†…å®¹ï¼Œæˆ‘ä»¬åˆ™ä¼šè¿™æ ·å»å®ç°ï¼š 12store.dispatch(&#123; type: 'plus' &#125;)console.log('next state', store.getState()) è¿™æ˜¯æœ€ç®€å•ç›´æ¥çš„å®ç°æ–¹å¼ï¼Œå½“ç„¶æˆ‘ä»¬å¹¶ä¸å¯èƒ½åœ¨é¡¹ç›®æ¯ä¸ª dispatch çš„åœ°æ–¹éƒ½æ·»åŠ è¿™æ ·ä¸€æ®µä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™éƒ¨åˆ†åŠŸèƒ½çš„ä»£ç æå–å‡ºæ¥ã€‚ å°è£… dispatch1234function patchStoreToAddLogging(store, action) &#123; store.dispatch(action) console.log('next state', store.getState())&#125; è¿™æ ·å¯ä»¥å‡å°‘ä¸€éƒ¨åˆ†é‡å¤çš„ä»£ç ã€‚ä¸è¿‡æ¯æ¬¡ä½¿ç”¨è¿™ä¸ªæ–°çš„ dispatch éƒ½å¾—ä»å¤–éƒ¨å¼•ä¸€ä¸‹ï¼Œä¾ç„¶æ²¡æœ‰è§£å†³å¢åŠ ä¸å¿…è¦çš„ä¸šåŠ¡ä»£ç ã€‚ æ‰€ä»¥æˆ‘ä»¬å¾—æ€è€ƒå¦å¤–ä¸€ç§ä¸€åŠ³æ°¸é€¸çš„æ–¹å¼ï¼Œæ›¿æ¢ dispatchï¼š æ›¿æ¢ dispatch123456const next = store.dispatchstore.dispatch = function patchStoreToAddLogging(action) &#123; let result = next(action) console.log('next state', store.getState()) return result&#125; è¿™æ ·æˆ‘ä»¬æ¯æ¬¡ä½¿ç”¨çš„æ—¶å€™å°±ä¸éœ€è¦å†ä»å¤–éƒ¨å¼•ç”¨ä¸€æ¬¡äº†ã€‚ ä½†è¿™æ ·è¿˜æ˜¯ä¸å¤Ÿå¥½çš„ï¼Œè¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬åˆæœ‰å…¶ä»–çš„éœ€æ±‚ï¼Œæ¯”æ–¹ç›‘æ§ dispatch é”™è¯¯ï¼Œæˆ‘ä»¬å›ºç„¶å¯ä»¥åœ¨æ‰“å°æ—¥å¿—çš„ä»£ç åé¢åŠ ä¸Šæ•è·é”™è¯¯çš„ä»£ç ï¼Œä½†éšç€åŠŸèƒ½æ¨¡å—çš„å¢å¤šï¼Œä»£ç é‡ä¹Ÿä¼šè¿…é€Ÿè†¨èƒ€ï¼Œå¯¼è‡´éš¾ä»¥ç»´æŠ¤ã€‚ æ‰€ä»¥ï¼Œæˆ‘ä»¬å¸Œæœ›ä¸åŒçš„åŠŸèƒ½æ˜¯ç‹¬ç«‹çš„å¯æ‹”æ’çš„æ¨¡å—ã€‚ æ¨¡å—åŒ–1234567891011121314151617181920212223242526// æ‰“å° state ä¸­é—´ä»¶function patchStoreToAddLogging(store) &#123; const next = store.dispatch //æ­¤å¤„ä¹Ÿå¯ä»¥å†™æˆåŒ¿åå‡½æ•° store.dispatch = function(action) &#123; let result = next(action) console.log('next state', store.getState()) return result &#125;&#125; // ç›‘æ§é”™è¯¯ä¸­é—´ä»¶function patchStoreToAddCrashReporting(store) &#123; // è¿™é‡Œå–åˆ°çš„ dispatch å·²ç»æ˜¯è¢«ä¸Šä¸€ä¸ªä¸­é—´ä»¶åŒ…è£…è¿‡çš„ dispatchï¼Œä»è€Œå®ç°ä¸­é—´ä»¶ä¸²è” const next = store.dispatch store.dispatch = function(action) &#123; try &#123; return next(action) &#125; catch (err) &#123; console.error('æ•è·ä¸€ä¸ªå¼‚å¸¸!', err) throw err &#125; &#125;&#125;patchStoreToAddLogging(store)patchStoreToAddCrashReporting(store) åˆ°è¿™é‡Œæˆ‘ä»¬åŸºæœ¬å®ç°äº†å¯ç»„åˆã€æ‹”æ’çš„ä¸­é—´ä»¶ã€‚ applyMiddlewareæˆ‘ä»¬æ³¨æ„åˆ°ï¼Œæˆ‘ä»¬å½“å‰å†™çš„ä¸­é—´ä»¶æ–¹æ³•éƒ½æ˜¯å…ˆè·å– dispatchï¼Œç„¶ååœ¨æ–¹æ³•å†…æ›¿æ¢ dispatchï¼Œè¿™éƒ¨åˆ†é‡å¤ä»£ç æˆ‘ä»¬å¯ä»¥å†ç¨å¾®ç®€åŒ–ä¸€ä¸‹ã€‚ æˆ‘ä»¬ä¸åœ¨æ–¹æ³•å†…æ›¿æ¢ dispatchï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªæ–°çš„ dispatchï¼Œç„¶åè®©å¾ªç¯æ¥è¿›è¡Œæ¯ä¸€æ­¥çš„æ›¿æ¢ï¼š 1234567891011121314151617181920212223242526272829function logger(store) &#123; const next = store.dispatch return function(action) &#123; let result = next(action) console.log('next state', store.getState()) return result &#125;&#125;function crashReporter(store) &#123; const next = store.dispatch return function(action) &#123; try &#123; return next(action) &#125; catch (err) &#123; console.error('æ•è·ä¸€ä¸ªå¼‚å¸¸!', err) throw err &#125; &#125;&#125;function applyMiddleware(store, middlewares) &#123; middlewares = middlewares.slice() // è¿”å›æ–°æ•°ç»„ï¼Œé¿å… reserve() å½±å“åŸæ•°ç»„ middlewares.reverse() // ç”±äºå¾ªç¯æ›¿æ¢ dispatch æ—¶ï¼Œå‰é¢çš„ä¸­é—´ä»¶åœ¨æœ€é‡Œå±‚ï¼Œå› æ­¤éœ€è¦ç¿»è½¬æ•°ç»„æ‰èƒ½ä¿è¯ä¸­é—´ä»¶çš„è°ƒç”¨é¡ºåº // å¾ªç¯æ›¿æ¢ dispatch middlewares.forEach(middleware =&gt; (store.dispatch = middleware(store)))&#125;applyMiddleware(store, [ logger, crashReporter ]) çº¯å‡½æ•°ä¹‹å‰çš„ä¾‹å­å·²ç»åŸºæœ¬å®ç°æˆ‘ä»¬çš„éœ€æ±‚ï¼Œä½†æˆ‘ä»¬è¿˜å¯ä»¥è¿›ä¸€æ­¥æ”¹è¿›ï¼Œä¸Šé¢è¿™ä¸ªå‡½æ•°çœ‹èµ·æ¥ä»ç„¶ä¸å¤Ÿâ€çº¯â€œï¼Œå‡½æ•°åœ¨å‡½æ•°ä½“å†…ä¿®æ”¹äº† store è‡ªèº«çš„ dispatch ï¼Œäº§ç”Ÿäº†æ‰€è°“çš„â€œå‰¯ä½œç”¨â€ï¼Œä»å‡½æ•°å¼ç¼–ç¨‹çš„è§„èŒƒå‡ºå‘ï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œä¸€äº›æ”¹é€ ï¼Œå€Ÿé‰´ react-redux çš„å®ç°æ€è·¯ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ applyMiddleware ä½œä¸ºé«˜é˜¶å‡½æ•°ï¼Œç”¨äºå¢å¼º storeï¼Œè€Œä¸æ˜¯æ›¿æ¢ dispatchã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364import &#123; reducer &#125; from './reducer'const logger = store =&gt; next =&gt; action =&gt; &#123; let result = next(action) console.log('next state', store.getState()) return result&#125;const crashReporter = store =&gt; next =&gt; action =&gt; &#123; try &#123; return next(action) &#125; catch (err) &#123; console.error('æ•è·ä¸€ä¸ªå¼‚å¸¸!', err) throw err &#125;&#125;const thunk = store =&gt; next =&gt; action =&gt; typeof action === 'function' ? action(store.dispatch, store.getState) : next(action)const applyMiddleware = (...middlewares) =&gt; createStore =&gt; reducer =&gt; &#123; const store = createStore(reducer) let &#123; getState, dispatch &#125; = store const params = &#123; getState, // å¦‚æœæ‰€æœ‰ä¸­é—´ä»¶éƒ½å…±äº«åŒä¸€ä¸ª dispatchï¼Œå‡ºç°ä¸­é—´ä»¶ä¿®æ”¹äº† dispatch æˆ–è€…è¿›è¡Œå¼‚æ­¥ dispatch å°±å¯èƒ½å‡ºé”™ dispatch: (action) =&gt; dispatch(action) &#125; const middlewareArr = middlewares.map(middleware =&gt; middleware(params)) dispatch = compose(...middlewareArr)(dispatch) return &#123; ...store, dispatch &#125;&#125;// compose è¿™ä¸€æ­¥å¯¹åº”äº† middlewares.reverse()ï¼Œæ˜¯å‡½æ•°å¼ç¼–ç¨‹ä¸€ç§å¸¸è§çš„ç»„åˆæ–¹æ³•// ä½¿ä¼ å…¥çš„ä¸­é—´ä»¶å‡½æ•°å˜æˆ (...arg) =&gt; mid1(mid2(mid3(...arg)))function compose(...funcs) &#123; if (funcs.length === 0) return arg =&gt; arg if (funcs.length === 1) return funcs[0] return funcs.reduce((a, b) =&gt;(...args) =&gt; a(b(...args)))&#125;export const createStore = (reducer, enhancer) =&gt; &#123; if(applyMiddleware) &#123; return enhancer(createStore)(reducer) &#125; let currentState = &#123;&#125; let observers = [] // è§‚å¯Ÿè€…é˜Ÿåˆ— function getState() &#123; return currentState &#125; function dispatch(action) &#123; currentState = reducer(currentState, action) observers.forEach(fn =&gt; fn()) &#125; dispatch(&#123;type:'@STATE_INIT@'&#125;); // åˆå§‹åŒ– state æ•°æ® function subscribe(fn) &#123; observers.push(fn) &#125; return &#123; getState, subscribe, dispatch &#125;&#125;createStore(reducer, applyMiddleware(logger, crashReporter, thunk))","tags":[{"name":"javascript","slug":"javascript","permalink":"http://xyue.me/tags/javascript/"},{"name":"react","slug":"react","permalink":"http://xyue.me/tags/react/"}]},{"title":"JavaScript ç»§æ‰¿çš„å‡ ç§æ–¹å¼","date":"2020-04-07T09:15:36.000Z","path":"2020/04/07/javascript-extend/","text":"åœ¨äº†è§£ç»§æ‰¿ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£æ„é€ å‡½æ•°ã€åŸå‹å’ŒåŸå‹é“¾çš„ç›¸å…³çŸ¥è¯†ã€‚ æ„é€ å‡½æ•°æ„é€ å‡½æ•°å’Œæ™®é€šå‡½æ•°çš„åŒºåˆ«ä»…åœ¨äºè°ƒç”¨å®ƒä»¬çš„æ–¹å¼ä¸åŒã€‚åªè¦é€šè¿‡ new æ“ä½œç¬¦æ¥è°ƒç”¨ï¼Œé‚£å®ƒå°±å¯ä»¥ä½œä¸ºæ„é€ å‡½æ•°ï¼›å¦‚æœä¸é€šè¿‡ new æ“ä½œç¬¦æ¥è°ƒç”¨ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°ã€‚ å®ä¾‹æ‹¥æœ‰ constructor å±æ€§ï¼Œè¯¥å±æ€§è¿”å›åˆ›å»ºå®ä¾‹å¯¹è±¡çš„æ„é€ å‡½æ•°ã€‚ 1234567function Person(name, age) &#123; this.name = name; this.age = age;&#125;var person = new Person('XYue', 20);console.log(person.constructor === Person); // true åŸå‹æˆ‘ä»¬åˆ›å»ºçš„æ¯ä¸ªå‡½æ•°éƒ½æœ‰ prototype å±æ€§ï¼Œè¿™ä¸ªå±æ€§æŒ‡å‘å‡½æ•°çš„åŸå‹å¯¹è±¡ã€‚åŸå‹å¯¹è±¡çš„ç”¨é€”æ˜¯åŒ…å«å¯ä»¥ç”±ç‰¹å®šç±»å‹çš„æ‰€æœ‰å®ä¾‹å…±äº«çš„å±æ€§å’Œæ–¹æ³•ã€‚ åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰åŸå‹å¯¹è±¡éƒ½ä¼šè‡ªåŠ¨è·å¾—ä¸€ä¸ª constructor å±æ€§ï¼Œè¿™ä¸ªå±æ€§åŒ…å«ä¸€ä¸ªæŒ‡å‘ prototype å±æ€§æ‰€åœ¨å‡½æ•°çš„æŒ‡é’ˆã€‚ å½“è°ƒç”¨æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°å®ä¾‹åï¼Œè¯¥å®ä¾‹çš„å†…éƒ¨å°†åŒ…å«ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ï¼ˆå¯ä»¥é€šè¿‡å®ä¾‹çš„ __proto__ æ¥è®¿é—®æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ï¼‰ã€‚ 123456789101112131415function Person(name) &#123; this.name = name;&#125;Person.prototype.sayName = function () &#123; console.log(this.name);&#125;var person1 = new Person('XYue');var person2 = new Person('æ­†æœˆ');person1.sayName(); // XYueperson2.sayName(); // æ­†æœˆconsole.log(person1.__proto__ === Person.prototype); // trueconsole.log(Person.prototype.__proto__ === Object.prototype); // trueconsole.log(Object.prototype.__proto__ === null); // true åŸå‹é“¾æ¯ä¸ªæ„é€ å‡½æ•°éƒ½æœ‰ä¸€ä¸ªåŸå‹å¯¹è±¡ï¼ŒåŸå‹å¯¹è±¡éƒ½åŒ…å«ä¸€ä¸ªæŒ‡å‘æ„é€ å‡½æ•°çš„æŒ‡é’ˆï¼Œè€Œå®ä¾‹éƒ½åŒ…å«ä¸€ä¸ªå¯ä»¥æŒ‡å‘åŸå‹å¯¹è±¡çš„å†…éƒ¨æŒ‡é’ˆï¼ˆå¯ä»¥é€šè¿‡ __proto__ è®¿é—®ï¼‰ã€‚ å‡å¦‚æˆ‘ä»¬è®©åŸå‹å¯¹è±¡ç­‰äºå¦ä¸€ä¸ªç±»å‹çš„å®ä¾‹ï¼Œé‚£ä¹ˆæ­¤æ—¶åŸå‹å¯¹è±¡åŒ…å«ä¸€ä¸ªæŒ‡å‘å¦ä¸€ä¸ªåŸå‹çš„æŒ‡é’ˆï¼Œç›¸åº”åœ°ï¼Œå¦ä¸€ä¸ªåŸå‹ä¸­ä¹ŸåŒ…å«ç€ä¸€ä¸ªæŒ‡å‘å¦ä¸€ä¸ªæ„é€ å‡½æ•°çš„æŒ‡é’ˆã€‚å‡å¦‚å¦ä¸€ä¸ªåŸå‹åˆæ˜¯å¦ä¸€ä¸ªç±»å‹çš„å®ä¾‹ï¼Œé‚£ä¹ˆä¸Šè¿°å…³ç³»ä»ç„¶æˆç«‹ï¼Œå¦‚æ­¤å±‚å±‚é€’è¿›ï¼Œå°±æ„æˆäº†å®ä¾‹ä¸åŸå‹çš„é“¾æ¡ï¼Œè¿™å°±æ˜¯åŸå‹é“¾çš„åŸºæœ¬æ¦‚å¿µã€‚ ç»§æ‰¿åŸå‹é“¾ç»§æ‰¿åŸå‹é“¾ç»§æ‰¿çš„åŸºæœ¬æ€æƒ³æ˜¯åˆ©ç”¨åŸå‹è®©ä¸€ä¸ªå¼•ç”¨ç±»å‹ç»§æ‰¿å¦ä¸€ä¸ªå¼•ç”¨ç±»å‹çš„å±æ€§å’Œæ–¹æ³•ã€‚ 1234567891011121314151617function SuperType(name) &#123; this.name = name; this.hobbies = ['å”±', 'è·³', 'rap'];&#125;SuperType.prototype.getHobbies = function() &#123; console.log(this.hobbies);&#125;function SubType() &#123;&#125;SubType.prototype = new SuperType();SubType.prototype.constructor = SubType;var sub1 = new SubType();var sub2 = new SubType();sub1.hobbies.push('ç¯®çƒ');sub1.getHobbies(); // ['å”±', 'è·³', 'rap', 'ç¯®çƒ']sub2.getHobbies(); // ['å”±', 'è·³', 'rap', 'ç¯®çƒ'] ç¼ºç‚¹ é€šè¿‡åŸå‹æ¥å®ç°ç»§æ‰¿æ—¶ï¼ŒåŸå‹ä¼šå˜æˆå¦ä¸€ä¸ªç±»å‹çš„å®ä¾‹ï¼ŒåŸå…ˆçš„å®ä¾‹å±æ€§å˜æˆäº†ç°åœ¨çš„åŸå‹å±æ€§ï¼Œè¯¥åŸå‹çš„å¼•ç”¨ç±»å‹å±æ€§ä¼šè¢«æ‰€æœ‰çš„å®ä¾‹å…±äº« åœ¨åˆ›å»ºå­ç±»å‹çš„å®ä¾‹æ—¶ï¼Œæ²¡æœ‰åŠæ³•åœ¨ä¸å½±å“æ‰€æœ‰å¯¹è±¡å®ä¾‹çš„æƒ…å†µä¸‹ç»™è¶…ç±»å‹çš„æ„é€ å‡½æ•°ä¸­ä¼ é€’å‚æ•° æ„é€ å‡½æ•°ç»§æ‰¿åŸºæœ¬æ€è·¯ï¼šåœ¨å­ç±»å‹çš„æ„é€ å‡½æ•°ä¸­è°ƒç”¨è¶…ç±»å‹æ„é€ å‡½æ•°ã€‚ 123456789101112131415161718function SuperType(name) &#123; this.name = name; this.hobbies = ['å”±', 'è·³', 'rap'];&#125;SuperType.prototype.getHobbies = function() &#123; console.log(this.hobbies);&#125;function SubType(name) &#123; SuperType.call(this, name);&#125;var sub1 = new SubType('XYue-1');var sub2 = new SubType('XYue-2');sub1.hobbies.push('ç¯®çƒ');console.log(sub1.hobbies); // ['å”±', 'è·³', 'rap', 'ç¯®çƒ'];console.log(sub2.hobbies); // ['å”±', 'è·³', 'rap'];sub1.getHobbies(); // Uncaught TypeError: sub1.getHobbies is not a function ä¼˜ç‚¹ å¯ä»¥å‘è¶…ç±»ä¼ é€’å‚æ•° è§£å†³äº†åŸå‹ä¸­åŒ…å«å¼•ç”¨ç±»å‹å€¼è¢«æ‰€æœ‰å®ä¾‹å…±äº«çš„é—®é¢˜ ç¼ºç‚¹ æ–¹æ³•éƒ½åœ¨æ„é€ å‡½æ•°ä¸­å®šä¹‰ï¼Œå‡½æ•°å¤ç”¨æ— ä»è°ˆèµ·ï¼Œå¦å¤–è¶…ç±»å‹åŸå‹ä¸­å®šä¹‰çš„æ–¹æ³•å¯¹äºå­ç±»å‹è€Œè¨€éƒ½æ˜¯ä¸å¯è§çš„ã€‚ ç»„åˆç»§æ‰¿ç»„åˆç»§æ‰¿æŒ‡çš„æ˜¯å°†åŸå‹é“¾å’Œå€Ÿç”¨æ„é€ å‡½æ•°æŠ€æœ¯ç»„åˆåˆ°ä¸€å—ï¼Œä»è€Œå‘æŒ¥äºŒè€…ä¹‹é•¿çš„ä¸€ç§ç»§æ‰¿æ¨¡å¼ã€‚ åŸºæœ¬æ€è·¯ï¼šä½¿ç”¨åŸå‹é“¾å®ç°å¯¹åŸå‹å±æ€§å’Œæ–¹æ³•çš„ç»§æ‰¿ï¼Œé€šè¿‡å€Ÿç”¨æ„é€ å‡½æ•°æ¥å®ç°å¯¹å®ä¾‹å±æ€§çš„ç»§æ‰¿ï¼Œæ—¢é€šè¿‡åœ¨åŸå‹ä¸Šå®šä¹‰æ–¹æ³•æ¥å®ç°äº†å‡½æ•°å¤ç”¨ï¼Œåˆä¿è¯äº†æ¯ä¸ªå®ä¾‹éƒ½æœ‰è‡ªå·±çš„å±æ€§ã€‚ 1234567891011121314151617181920212223242526function SuperType(name) &#123; this.name = name; this.hobbies = ['å”±', 'è·³', 'rap'];&#125;SuperType.prototype.getHobbies = function() &#123; console.log(this.hobbies);&#125;function SubType(name, age) &#123; SuperType.call(this, name); this.age = age;&#125;SubType.prototype = new SuperType();SubType.prototype.constructor = SubType;SubType.prototype.getAge = function() &#123; console.log(this.age);&#125;var sub1 = new SubType('XYue1', 18);var sub2 = new SubType('XYue2', 20);sub1.hobbies.push('ç¯®çƒ');console.log(sub1.hobbies); // ['å”±', 'è·³', 'rap', 'ç¯®çƒ'];console.log(sub2.hobbies); // ['å”±', 'è·³', 'rap'];sub1.getHobbies(); // ['å”±', 'è·³', 'rap', 'ç¯®çƒ'];sub1.getAge(); // 18sub2.getAge(); // 20 ä¼˜ç‚¹ å¯ä»¥å‘è¶…ç±»ä¼ é€’å‚æ•° æ¯ä¸ªå®ä¾‹éƒ½æœ‰è‡ªå·±çš„å±æ€§ å®ç°äº†å‡½æ•°å¤ç”¨ ç¼ºç‚¹ æ— è®ºä»€ä¹ˆæƒ…å†µä¸‹ï¼Œéƒ½ä¼šè°ƒç”¨ä¸¤æ¬¡è¶…ç±»å‹æ„é€ å‡½æ•°ã€‚ä¸€æ¬¡æ˜¯åœ¨åˆ›å»ºå­ç±»å‹åŸå‹çš„æ—¶å€™ï¼Œå¦ä¸€æ¬¡æ˜¯åœ¨å­ç±»å‹æ„é€ å‡½æ•°å†…éƒ¨ åŸå‹å¼ç»§æ‰¿å€ŸåŠ©åŸå‹å¯ä»¥åŸºäºå·²æœ‰çš„å¯¹è±¡åˆ›å»ºæ–°å¯¹è±¡ï¼ŒåŒæ—¶è¿˜ä¸å¿…å› æ­¤åˆ›å»ºè‡ªå®šä¹‰ç±»å‹ã€‚ 12345function object(obj)&#123; function F()&#123;&#125;; F.prototype = obj; return new F();&#125; åœ¨ object() å‡½æ•°å†…éƒ¨ï¼Œå…ˆæ·»åŠ ä¸€ä¸ªä¸´æ—¶æ€§çš„æ„é€ å‡½æ•°ï¼Œç„¶åå°†ä¼ å…¥çš„å¯¹è±¡ä½œä¸ºè¿™ä¸ªæ„é€ å‡½æ•°çš„åŸå‹ï¼Œæœ€åè¿”å›äº†è¿™ä¸ªä¸´æ—¶ç±»å‹çš„ä¸€ä¸ªæ–°å®ä¾‹ï¼Œä»æœ¬è´¨ä¸Šè®²ï¼Œobject() å¯¹ä¼ å…¥çš„å¯¹è±¡æ‰§è¡Œäº†ä¸€æ¬¡æµ…æ‹·è´ã€‚ECMAScript5 é€šè¿‡æ–°å¢ Object.create() æ–¹æ³•è§„èŒƒäº†åŸå‹å¼ç»§æ‰¿ã€‚è¿™ä¸ªæ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªç”¨ä½œæ–°å¯¹è±¡åŸå‹çš„å¯¹è±¡å’Œï¼ˆå¯é€‰çš„ï¼‰ä¸€ä¸ªä¸ºæ–°å¯¹è±¡å®šä¹‰é¢å¤–å±æ€§çš„å¯¹è±¡ï¼ˆå¯ä»¥è¦†ç›–åŸå‹å¯¹è±¡ä¸Šçš„åŒåå±æ€§ï¼‰ï¼Œåœ¨ä¼ å…¥ä¸€ä¸ªå‚æ•°çš„æƒ…å†µä¸‹ï¼ŒObject.create() å’Œ object() æ–¹æ³•çš„è¡Œä¸ºç›¸åŒã€‚ 1234567891011var person = &#123; name: 'XYue', hobbies: ['å”±', 'è·³', 'rap']&#125;;var person1 = Object.create(person);var person2 = Object.create(person);person1.hobbies.push('ğŸ€');person2.hobbies.push('âš½ï¸');console.log(person.hobbies); // [\"å”±\", \"è·³\", \"rap\", \"ğŸ€\", \"âš½ï¸\"]console.log(person1.hobbies); // [\"å”±\", \"è·³\", \"rap\", \"ğŸ€\", \"âš½ï¸\"]console.log(person2.hobbies); // [\"å”±\", \"è·³\", \"rap\", \"ğŸ€\", \"âš½ï¸\"] ç¼ºç‚¹ åŒåŸå‹é“¾å®ç°ç»§æ‰¿ä¸€æ ·ï¼ŒåŒ…å«å¼•ç”¨ç±»å‹å€¼çš„å±æ€§ä¼šè¢«æ‰€æœ‰å®ä¾‹å…±äº« å¯„ç”Ÿå¼ç»§æ‰¿å¯„ç”Ÿç»§æ‰¿ æ˜¯ä¾æ‰˜äºä¸€ä¸ªå¯¹è±¡è€Œç”Ÿçš„ä¸€ç§ç»§æ‰¿æ–¹å¼ï¼Œå› æ­¤ç§°ä¹‹ä¸º å¯„ç”Ÿã€‚ å¯„ç”Ÿå¼ç»§æ‰¿æ˜¯ä¸åŸå‹å¼ç»§æ‰¿ç´§å¯†ç›¸å…³çš„ä¸€ç§æ€è·¯ã€‚å¯„ç”Ÿå¼ç»§æ‰¿çš„æ€è·¯ä¸å¯„ç”Ÿæ„é€ å‡½æ•°å’Œå·¥å‚æ¨¡å¼ç±»ä¼¼ï¼Œå³åˆ›å»ºä¸€ä¸ªä»…ç”¨äºå°è£…ç»§æ‰¿è¿‡ç¨‹çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°åœ¨å†…éƒ¨å·²æŸç§æ–¹å¼æ¥å¢å¼ºå¯¹è±¡ï¼Œæœ€åå†åƒçœŸçš„æ˜¯å®ƒåšäº†æ‰€æœ‰å·¥ä½œä¸€æ ·è¿”å›å¯¹è±¡ã€‚ 1234567891011121314function createObj(obj) &#123; var clone = Object.create(obj); clone.sing = function() &#123; console.log('å¤§å±±çš„å­å­™å‘¦~çˆ±å¤ªé˜³å•°~'); &#125; return clone;&#125;var person = &#123; name: 'XYue', hobbies: ['å”±', 'è·³', 'rap']&#125;;var person1 = createObj(person);person1.sing(); // å¤§å±±çš„å­å­™å‘¦~çˆ±å¤ªé˜³å•°~ ç¼ºç‚¹ ä½¿ç”¨å¯„ç”Ÿå¼ç»§æ‰¿æ¥ä¸ºå¯¹è±¡æ·»åŠ å‡½æ•°ï¼Œä¼šç”±äºä¸èƒ½åšåˆ°å‡½æ•°å¤ç”¨è€Œæ•ˆç‡ä½ä¸‹ åŒåŸå‹é“¾å®ç°ç»§æ‰¿ä¸€æ ·ï¼ŒåŒ…å«å¼•ç”¨ç±»å‹å€¼çš„å±æ€§ä¼šè¢«æ‰€æœ‰å®ä¾‹å…±äº« å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿æ‰€è°“å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿ï¼Œå³é€šè¿‡å€Ÿç”¨æ„é€ å‡½æ•°æ¥ç»§æ‰¿å±æ€§ï¼Œé€šè¿‡åŸå‹é“¾ç»§æ‰¿çš„å½¢å¼æ¥ç»§æ‰¿æ–¹æ³•ã€‚ åŸºæœ¬æ€è·¯ï¼šä¸å¿…ä¸ºäº†æŒ‡å®šå­ç±»å‹çš„åŸå‹è€Œè°ƒç”¨è¶…ç±»å‹çš„æ„é€ å‡½æ•°ï¼Œæˆ‘ä»¬éœ€è¦çš„ä»…æ˜¯è¶…ç±»å‹åŸå‹çš„ä¸€ä¸ªå‰¯æœ¬ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ä½¿ç”¨å¯„ç”Ÿå¼ç»§æ‰¿æ¥ç»§æ‰¿è¶…ç±»å‹çš„åŸå‹ï¼Œç„¶åå†å°†ç»“æœæŒ‡å®šç»™å­ç±»å‹çš„åŸå‹ã€‚ 12345678function inheritPrototype(subType, superType) &#123; // åˆ›å»ºè¶…ç±»å‹åŸå‹çš„ä¸€ä¸ªå‰¯æœ¬ var prototype = Object.create(superType.prototype); // ä¸ºåˆ›å»ºçš„å‰¯æœ¬æ·»åŠ  constructor å±æ€§ prototype.constructor = subType; // å°†æ–°åˆ›å»ºçš„å¯¹è±¡èµ‹å€¼ç»™å­ç±»å‹çš„åŸå‹ subType.prototype = prototype;&#125; è‡³æ­¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è°ƒç”¨ inheritPrototype ä¸ºå­ç±»å‹åŸå‹èµ‹å€¼ï¼š 123456789function SuperType(name) &#123; this.name = name; this.hobbies = ['å”±', 'è·³', 'rap'];&#125;function SubType(name, age) &#123; SuperType.call(this, name); this.age = age;&#125;inheritPrototype(SubType, SuperType); ä¼˜ç‚¹ åªè°ƒç”¨äº†ä¸€æ¬¡è¶…ç±»æ„é€ å‡½æ•°ï¼Œæ•ˆç‡æ›´é«˜ é¿å…åœ¨ SubType.prototype ä¸Šé¢åˆ›å»ºä¸å¿…è¦çš„ã€å¤šä½™çš„å±æ€§ï¼Œä¸å…¶åŒæ—¶ï¼ŒåŸå‹é“¾è¿˜èƒ½ä¿æŒä¸å˜ å› æ­¤å¯„ç”Ÿç»„åˆç»§æ‰¿æ˜¯å¼•ç”¨ç±»å‹æœ€ç†æ€§çš„ç»§æ‰¿èŒƒå¼ã€‚ ES6 ç»§æ‰¿Class å¯ä»¥é€šè¿‡ extends å…³é”®å­—å®ç°ç»§æ‰¿ï¼Œå¦‚: 12345678910111213141516171819class SuperType &#123; constructor(name) &#123; this.name = name; this.hobbies = ['å”±', 'è·³', 'rap']; &#125; getName() &#123; console.log(this.name); &#125;&#125;class SubType extends SuperType &#123; constructor(name, age) &#123; super(name); this.age = age; &#125;&#125;const sub = new SubType('XYue', 20);sub.getName(); // XYue ä½¿ç”¨ extends å…³é”®å­—å®ç°ç»§æ‰¿ï¼Œæœ‰ä¸€ç‚¹éœ€è¦ç‰¹åˆ«è¯´æ˜ï¼š å­ç±»å¿…é¡»åœ¨ constructor ä¸­è°ƒç”¨ super æ–¹æ³•ï¼Œå¦åˆ™æ–°å»ºå®ä¾‹æ—¶ä¼šæŠ¥é”™ã€‚å¦‚æœæ²¡æœ‰å­ç±»æ²¡æœ‰å®šä¹‰ constructor æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ³•ä¼šè¢«é»˜è®¤æ·»åŠ ã€‚åœ¨å­ç±»çš„æ„é€ å‡½æ•°ä¸­ï¼Œåªæœ‰è°ƒç”¨ super ä¹‹åï¼Œæ‰èƒ½ä½¿ç”¨ this å…³é”®å­—ï¼Œå¦åˆ™æŠ¥é”™ã€‚è¿™æ˜¯å› ä¸ºå­ç±»å®ä¾‹çš„æ„å»ºï¼ŒåŸºäºçˆ¶ç±»å®ä¾‹ï¼Œåªæœ‰ super æ–¹æ³•æ‰èƒ½è°ƒç”¨çˆ¶ç±»å®ä¾‹ã€‚","tags":[{"name":"javascript","slug":"javascript","permalink":"http://xyue.me/tags/javascript/"}]},{"title":"Promise å®ç°åŸç†","date":"2020-03-30T10:14:44.000Z","path":"2020/03/30/promise-realize/","text":"ä»€ä¹ˆæ˜¯ Promiseåœ¨ javascript çš„ä¸–ç•Œä¸­ï¼Œä»£ç éƒ½æ˜¯ å•çº¿ç¨‹ æ‰§è¡Œçš„ã€‚è¿™å°±å¯¼è‡´æˆ‘ä»¬çš„ä»£ç é‡Œä¼šæœ‰åµŒå¥—å›è°ƒå‡½æ•°ï¼Œä¸€æ—¦åµŒå¥—è¿‡å¤šï¼Œå¯¼è‡´ä»£ç ä¸å®¹æ˜“ç†è§£å’Œç»´æŠ¤ã€‚ä¸ºäº†é™ä½å¼‚æ­¥ç¼–ç¨‹çš„å¤æ‚æ€§ï¼Œå¼€å‘äººå‘˜ä¸€ç›´åœ¨å¯»æ‰¾å„ç§è§£å†³æ–¹æ¡ˆï¼ŒPromise å°±æ˜¯ç”¨æ¥å¤„ç†å¼‚æ­¥æ“ä½œçš„å…¶ä¸­ä¸€ä¸ªæ–¹æ¡ˆã€‚ ä¸‹é¢å°†æ ¹æ® Promise/A+ çš„è§„èŒƒï¼Œæ¥å†™å‡ºç¬¦åˆè§„èŒƒçš„æºç ã€‚ Promise çš„åŸºæœ¬ä½¿ç”¨12345678const promise = new Promise((resolve, reject) =&gt; &#123; resolve('success'); // è¿™é‡Œå¦‚æœæ˜¯ reject('fail')&#125;);promise.then((res)=&gt;&#123; console.log(res); // è¾“å‡ºï¼šsuccess&#125;,(err)=&gt;&#123; console.log(err); // ä¸Šé¢å¦‚æœæ‰§è¡Œ reject('fail')ï¼Œè¿™é‡Œå°±è¾“å‡º fail&#125;); resolve æ‰¾ then é‡Œçš„æˆåŠŸå›è°ƒï¼Œreject æ‰¾ then é‡Œå¤±è´¥çš„å›è°ƒã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬å°†æŒ‰è‡ªå·±çš„æ–¹å¼ä¸€æ­¥æ­¥å®ç°è¿™æ ·çš„ä¸€ä¸ª Promise ç±»ï¼Œç›´æ¥ä¸Šä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142const PENDING = \"pending\";const FULFILLED = \"fulfilled\";const REJECTED = \"rejected\";class Promise &#123; constructor(executor) &#123; this.state = PENDING; this.onFulfilled = []; // æˆåŠŸå›è°ƒé˜Ÿåˆ— this.onRejected = []; // å¤±è´¥å›è°ƒé˜Ÿåˆ— // PromiseA+ 2.1 const resolve = value =&gt; &#123; if (this.state === PENDING) &#123; this.state = FULFILLED; this.value = value; this.onFulfilled.forEach(fn =&gt; fn()); // PromiseA+ 2.2.6.1 &#125; &#125;; const reject = reason =&gt; &#123; if (this.state === PENDING) &#123; this.state = REJECTED; this.reason = reason; this.onRejected.forEach(fn =&gt; fn()); // PromiseA+ 2.2.6.1 &#125; &#125;; try &#123; executor(resolve, reject); &#125; catch (error) &#123; reject(error); &#125; &#125; then(onFulfilled, onRejected) &#123; if (this.state === PENDING) &#123; this.onFulfilled.push(() =&gt; onFulfilled(this.value)); this.onRejected.push(() =&gt; onRejected(this.reason)); &#125; &#125;&#125;module.exports = Promise; è¿™æ ·æˆ‘ä»¬å°±ç®€å•çš„å®ç°äº†ä¸€ä¸ª Promise åº”è¯¥æ‹¥æœ‰çš„åŸºæœ¬åŠŸèƒ½ã€‚ é“¾å¼è°ƒç”¨åœ¨ä¸Šè¿°ä»£ç ä¸­æˆ‘ä»¬å¹¶æ²¡æœ‰å¤„ç† then çš„é“¾å¼è°ƒç”¨ï¼Œç›´æ¥ä½¿ç”¨åˆ™ä¼šæŠ¥é”™ï¼šTypeError: Cannot read property â€˜thenâ€™ of undefinedã€‚ åœ¨ Promise/A+ è§„èŒƒä¸­æåˆ°ï¼š 2.2.6 then may be called multiple times on the same promise.2.2.6.1 If/when promise is fulfilled, all respective onFulfilled callbacks must execute in the order of their originating calls to then.2.2.6.2 If/when promise is rejected, all respective onRejected callbacks must execute in the order of their originating calls to then.2.2.7 then must return a promise [3.3].2.2.7.1 If either onFulfilled or onRejected returns a value x, run the Promise Resolution Procedure \\[\\[Resolve]](promise2, x).2.2.7.2 If either onFulfilled or onRejected throws an exception e, promise2 must be rejected with e as the reason.2.2.7.3 If onFulfilled is not a function and promise1 is fulfilled, promise2 must be fulfilled with the same value as promise1.2.2.7.4 If onRejected is not a function and promise1 is rejected, promise2 must be rejected with the same reason as promise1. 1234567892.2.6 then æ–¹æ³•å¯èƒ½è¢«å¤šæ¬¡è°ƒç”¨2.2.6.1 å¦‚æœ promise å˜æˆäº† fulfilled æ€ï¼Œæ‰€æœ‰çš„ onFulfilled å›è°ƒéƒ½éœ€è¦æŒ‰ç…§ then çš„é¡ºåºæ‰§è¡Œ2.2.6.2 å¦‚æœ promise å˜æˆäº† rejected æ€ï¼Œæ‰€æœ‰çš„ onRejected å›è°ƒéƒ½éœ€è¦æŒ‰ç…§ then çš„é¡ºåºæ‰§è¡Œ2.2.7 then å¿…é¡»è¿”å›ä¸€ä¸ª promise2.2.7.1 å¦‚æœ onFulfilled æˆ– onRejected æ‰§è¡Œçš„ç»“æœä¸º xï¼Œè°ƒç”¨ handlePromise2.2.7.2 å¦‚æœ onFulfilled æˆ–è€… onRejected æ‰§è¡Œæ—¶æŠ›å‡ºå¼‚å¸¸ eï¼Œpromise2 éœ€è¦è¢« reject2.2.7.3 å¦‚æœ onFulfilled ä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œpromise2 ä»¥ promise1 çš„ value fulfilled2.2.7.4 å¦‚æœ onRejected ä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œpromise2 ä»¥ promise1 çš„ reason rejected æ‰€ä»¥ then æ–¹æ³•é‡Œå¯èƒ½è¿”å›ä¸€ä¸ªå€¼æˆ–è€…è¿”å›çš„ä¸€ä¸ª Promise å®ä¾‹ï¼Œæˆ‘ä»¬éœ€è¦åˆ†åˆ«å¤„ç†è¿™ä¸¤ç§æƒ…å†µã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103class Promise &#123; // ... çœç•¥å¦‚ä¸Š then(onFulfilled, onRejected) &#123; // PromiseA+ 2.2.1 / PromiseA+ 2.2.5 / PromiseA+ 2.2.7.3 / PromiseA+ 2.2.7.4 // å€¼ç©¿é€ promise.then().then().then(res =&gt; &#123; console.log(res); &#125;) onFulfilled = typeof onFulfilled === \"function\" ? onFulfilled : value =&gt; value; onRejected = typeof onRejected === \"function\" ? onRejected : reason =&gt; &#123; throw reason; &#125;; // PromiseA+ 2.2.7 è¿”å›ä¸€ä¸ªæ–°çš„ Promise let promise2 = new Promise((resolve, reject) =&gt; &#123; if (this.state === FULFILLED) &#123; // PromiseA+ 2.2.2 // PromiseA+ 2.2.4 --- setTimeout æ¨¡æ‹Ÿå¼‚æ­¥ä»»åŠ¡ï¼ˆè§„èŒƒè¦æ±‚ï¼‰ setTimeout(() =&gt; &#123; try &#123; // PromiseA+ 2.2.7.1 let x = onFulfilled(this.value); handlePromise(promise2, x, resolve, reject); &#125; catch (e) &#123; // PromiseA+ 2.2.7.2 reject(e); &#125; &#125;); &#125; else if (this.state === REJECTED) &#123; // PromiseA+ 2.2.3 setTimeout(() =&gt; &#123; try &#123; let x = onRejected(this.reason); handlePromise(promise2, x, resolve, reject); &#125; catch (e) &#123; reject(e); &#125; &#125;); &#125; else if (this.state === PENDING) &#123; this.onFulfilled.push(() =&gt; &#123; setTimeout(() =&gt; &#123; try &#123; let x = onFulfilled(this.value); handlePromise(promise2, x, resolve, reject); &#125; catch (e) &#123; reject(e); &#125; &#125;); &#125;); this.onRejected.push(() =&gt; &#123; setTimeout(() =&gt; &#123; try &#123; let x = onRejected(this.reason); handlePromise(promise2, x, resolve, reject); &#125; catch (e) &#123; reject(e); &#125; &#125;); &#125;); &#125; &#125;); return promise2; &#125;&#125;function handlePromise(promise2, x, resolve, reject) &#123; // PromiseA+ 2.3.1 promise2 æ˜¯å¦ç­‰äºxï¼Œåˆ¤æ–­æ˜¯å¦å°†è‡ªå·±æœ¬èº«è¿”å›ï¼ŒæŠ›å‡º TypeError é”™è¯¯ if (promise2 === x) &#123; reject(new TypeError('Chaining cycle')); &#125; // PromiseA+ 2.3.3 if (x &amp;&amp; typeof x === 'object' || typeof x === 'function') &#123; let used; // PromiseA+ 2.3.3.3.3 æ§åˆ¶ resolve æˆ– reject åªæ‰§è¡Œä¸€æ¬¡ï¼ˆè§„èŒƒè¦æ±‚ï¼‰ try &#123; // PromiseA+ 2.3.3.1 let then = x.then; // å¦‚æœæ˜¯å‡½æ•°ï¼Œå°±è®¤ä¸ºå®ƒæ˜¯è¿”å›æ–°çš„ promise if (typeof then === 'function') &#123; // PromiseA+ 2.3.3.1 then.call(x, (y) =&gt; &#123; if (used) return; used = true; handlePromise(promise2, y, resolve, reject); &#125;, (r) =&gt; &#123; // PromiseA+ 2.3.3.2 if (used) return; used = true; reject(r); &#125;); &#125; else &#123; // PromiseA+ 2.3.3.4 x æ˜¯æ™®é€šå€¼ï¼Œç›´æ¥è¿”å› if (used) return; used = true; resolve(x); &#125; &#125; catch (e) &#123; // PromiseA+ 2.3.3.2 if (used) return; used = true; reject(e); &#125; &#125; else &#123; // PromiseA+ 2.3.4 x æ˜¯æ™®é€šå€¼ï¼Œç›´æ¥è¿”å› resolve(x); &#125;&#125;module.exports = Promise; è¿™æ ·æˆ‘ä»¬å°±å®ç°ä¸€ä¸ªå®Œå…¨ç¬¦åˆ Promise/A+ è§„èŒƒçš„ Promise äº†ã€‚ è®©æˆ‘ä»¬å®‰è£…æµ‹è¯•è„šæœ¬æ£€æµ‹ä¸‹: 1npm install -g promises-aplus-tests åœ¨ Promise å®ç°çš„ä»£ç ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š 12345678Promise.defer = Promise.deferred = function () &#123; let dfd = &#123;&#125;; dfd.promise = new Promise((resolve, reject) =&gt; &#123; dfd.resolve = resolve; dfd.reject = reject; &#125;); return dfd;&#125; å¯¹åº”ç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤: 1promises-aplus-tests promise.js promises-aplus-tests ä¸­å…±æœ‰ 872 æ¡æµ‹è¯•ç”¨ä¾‹ï¼Œä»¥ä¸Šä»£ç ï¼Œå¯ä»¥å®Œç¾é€šè¿‡æ‰€æœ‰ç”¨ä¾‹ã€‚ æ•´ä½“æ€è·¯ new Promise æ—¶ï¼Œéœ€è¦ä¼ é€’ä¸€ä¸ª executor æ‰§è¡Œå™¨ï¼Œæ‰§è¡Œå™¨ç«‹åˆ»æ‰§è¡Œ executor æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯ resolve å’Œ reject promise åªèƒ½ä» pending åˆ° rejected, æˆ–è€…ä» pending åˆ° fulfilled promise çš„çŠ¶æ€ä¸€æ—¦ç¡®è®¤ï¼Œå°±ä¸ä¼šå†æ”¹å˜ promise éƒ½æœ‰ then æ–¹æ³•ï¼Œthen æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯ promise æˆåŠŸçš„å›è°ƒ onFulfilled,å’Œ promise å¤±è´¥çš„å›è°ƒ onRejected å¦‚æœè°ƒç”¨ then æ—¶ï¼Œpromise å·²ç»æˆåŠŸï¼Œåˆ™æ‰§è¡Œ onFulfilledï¼Œå¹¶å°† promise çš„å€¼ä½œä¸ºå‚æ•°ä¼ é€’è¿›å»ï¼›å¦‚æœ promise å·²ç»å¤±è´¥ï¼Œé‚£ä¹ˆæ‰§è¡Œ onRejected, å¹¶å°† promise å¤±è´¥çš„åŸå› ä½œä¸ºå‚æ•°ä¼ é€’è¿›å»ï¼›å¦‚æœ promise çš„çŠ¶æ€æ˜¯ pendingï¼Œéœ€è¦å°† onFulfilled å’Œ onRejected å‡½æ•°å­˜æ”¾èµ·æ¥ï¼Œç­‰å¾…çŠ¶æ€ç¡®å®šåï¼Œå†ä¾æ¬¡å°†å¯¹åº”çš„å‡½æ•°æ‰§è¡Œï¼ˆå‘å¸ƒè®¢é˜…ï¼‰ then çš„å‚æ•° onFulfilled å’Œ onRejected å¯ä»¥ç¼ºçœ promise å¯ä»¥ then å¤šæ¬¡ï¼Œpromise çš„ then æ–¹æ³•è¿”å›ä¸€ä¸ª promise å¦‚æœ then è¿”å›çš„æ˜¯ä¸€ä¸ªç»“æœï¼Œé‚£ä¹ˆå°±ä¼šæŠŠè¿™ä¸ªç»“æœä½œä¸ºå‚æ•°ï¼Œä¼ é€’ç»™ä¸‹ä¸€ä¸ª then çš„æˆåŠŸçš„å›è°ƒ(onFulfilled) å¦‚æœ then ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œé‚£ä¹ˆå°±ä¼šæŠŠè¿™ä¸ªå¼‚å¸¸ä½œä¸ºå‚æ•°ï¼Œä¼ é€’ç»™ä¸‹ä¸€ä¸ª then çš„å¤±è´¥çš„å›è°ƒ(onRejected) å¦‚æœ then è¿”å›çš„æ˜¯ä¸€ä¸ª promiseï¼Œé‚£ä¹ˆä¼šç­‰è¿™ä¸ª promise æ‰§è¡Œå®Œï¼Œpromise å¦‚æœæˆåŠŸï¼Œå°±èµ°ä¸‹ä¸€ä¸ª then çš„æˆåŠŸï¼Œå¦‚æœå¤±è´¥ï¼Œå°±èµ°ä¸‹ä¸€ä¸ª then çš„å¤±è´¥ Promise å…¶ä»–æ–¹æ³•è™½ç„¶æˆ‘ä»¬å·²ç»å®ç°äº†ä¸€ä¸ª Promise/A+ è§„èŒƒçš„ Promiseï¼Œä½†æ˜¯ç›¸æ¯”åŸç”Ÿçš„ Promise è¿˜ç¼ºå°‘ä¸€äº›æ–¹æ³•: Promise.prototype.catch() Promise.prototype.finally() Promise.resolve() Promise.reject() Promise.all() Promise.race() ä¸‹é¢ï¼Œæˆ‘ä»¬å°†é€ä¸€å®ç°ï¼š Promise.prototype.catchç”¨äºæŒ‡å®šå‡ºé”™æ—¶çš„å›è°ƒï¼Œæ˜¯ç‰¹æ®Šçš„ then æ–¹æ³•ï¼Œcatch ä¹‹åï¼Œå¯ä»¥ç»§ç»­ thenã€‚ 123Promise.prototype.catch = function (onRejected) &#123; return this.then(null, onRejected);&#125; Promise.prototype.finallyä¸ç®¡æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½ä¼šèµ°åˆ° finally ä¸­ï¼Œå¹¶ä¸” finally ä¹‹åï¼Œè¿˜å¯ä»¥ç»§ç»­ thenã€‚å¹¶ä¸”å°†å€¼åŸå°ä¸åŠ¨çš„ä¼ é€’ç»™åé¢çš„ thenã€‚ 1234567891011Promise.prototype.finally = function (callback) &#123; return this.then((value) =&gt; &#123; return Promise.resolve(callback()).then(() =&gt; &#123; return value; &#125;); &#125;, (err) =&gt; &#123; return Promise.resolve(callback()).then(() =&gt; &#123; throw err; &#125;); &#125;);&#125; Promise.resolvePromise.resolve(value) è¿”å›ä¸€ä¸ªä»¥ç»™å®šå€¼è§£æåçš„ promise å¯¹è±¡. å¦‚æœ value æ˜¯ä¸ª thenable å¯¹è±¡ï¼Œè¿”å›çš„ promise ä¼šè·Ÿéšè¿™ä¸ª thenable çš„å¯¹è±¡ï¼Œé‡‡ç”¨å®ƒçš„æœ€ç»ˆçŠ¶æ€ å¦‚æœä¼ å…¥çš„ value æœ¬èº«å°±æ˜¯ promise å¯¹è±¡ï¼Œé‚£ä¹ˆ Promise.resolve å°†ä¸åšä»»ä½•ä¿®æ”¹ã€åŸå°ä¸åŠ¨åœ°è¿”å›è¿™ä¸ª promise å¯¹è±¡ å…¶ä»–æƒ…å†µï¼Œç›´æ¥è¿”å›ä»¥è¯¥å€¼ä¸ºæˆåŠŸçŠ¶æ€çš„ promise å¯¹è±¡ 123456789101112131415Promise.resolve = function (param) &#123; if (param instanceof Promise) &#123; return param; &#125; return new Promise((resolve, reject) =&gt; &#123; if (param &amp;&amp; param.then &amp;&amp; typeof param.then === 'function') &#123; // ä¸ºä¿æŒä¸åŸç”Ÿ Promise å¯¹è±¡æ‰§è¡Œé¡ºåºä¸€è‡´ï¼Œæ¨¡æ‹Ÿä½¿ç”¨ setTimeout setTimeout(() =&gt; &#123; param.then(resolve, reject); &#125;); &#125; else &#123; resolve(param); &#125; &#125;);&#125; Promise.rejectPromise.reject æ–¹æ³•å’Œ Promise.resolve ä¸åŒï¼ŒPromise.reject() æ–¹æ³•çš„å‚æ•°ä¼šåŸå°ä¸åŠ¨åœ°ä½œä¸º reject çš„ç†ç”±ï¼Œå˜æˆåç»­æ–¹æ³•çš„å‚æ•°ã€‚ 12345Promise.reject = function (reason) &#123; return new Promise((resolve, reject) =&gt; &#123; reject(reason); &#125;);&#125; Promise.allPromise.all(promises) è¿”å›ä¸€ä¸ª promise å¯¹è±¡ã€‚ å¦‚æœä¼ å…¥çš„å‚æ•°æ˜¯ä¸€ä¸ªç©ºçš„å¯è¿­ä»£å¯¹è±¡ï¼Œé‚£ä¹ˆæ­¤ promise å¯¹è±¡å›è°ƒå®Œæˆ resolveï¼Œåªæœ‰æ­¤æƒ…å†µï¼Œæ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼Œå…¶å®ƒéƒ½æ˜¯å¼‚æ­¥è¿”å›çš„ å¦‚æœä¼ å…¥çš„å‚æ•°ä¸åŒ…å«ä»»ä½• promiseï¼Œåˆ™è¿”å›ä¸€ä¸ªå¼‚æ­¥å®Œæˆ ç­‰å¾… promises ä¸­æ‰€æœ‰çš„ promise æ‰§è¡Œå®Œæ¯• å¦‚æœå‚æ•°ä¸­æœ‰ä¸€ä¸ª promise å¤±è´¥ï¼Œé‚£ä¹ˆ Promise.all è¿”å›çš„ promise å¯¹è±¡å¤±è´¥ åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼ŒPromise.all è¿”å›çš„ promise å®ŒæˆçŠ¶æ€çš„ç»“æœéƒ½æ˜¯ä¸€ä¸ªæ•°ç»„ 12345678910111213141516171819202122232425Promise.all = function (promises) &#123; return new Promise((resolve, reject) =&gt; &#123; let index = 0; let result = []; if (promises.length === 0) &#123; resolve(result); &#125; else &#123; function processValue(i, data) &#123; result[i] = data; if (++index === promises.length) &#123; resolve(result); &#125; &#125; for (let i = 0; i &lt; promises.length; i++) &#123; //promises[i] å¯èƒ½æ˜¯æ™®é€šå€¼ Promise.resolve(promises[i]).then((data) =&gt; &#123; processValue(i, data); &#125;, (err) =&gt; &#123; reject(err); return; &#125;); &#125; &#125; &#125;);&#125; Promise.allSettledä¸åŒäº Promise.allï¼Œä¸€æ—¦æœ‰ä¸€ä¸ª promise æ‰§è¡Œå¤±è´¥ï¼Œå°±æ— æ³•è·å¾—å…¶ä»–æˆåŠŸ promise è¿”å›ã€‚Promise.allSettled æ–¹æ³•ä¸‹æ— è®ºæŸä¸ª promise æˆåŠŸä¸å¦ï¼Œæ‰€æœ‰çš„ promise æ€»æ˜¯è¢« resolve çš„ï¼Œå¹¶ä¸”å€¼æ˜¯æ‰€æœ‰ promise æ‰§è¡Œç»“æœçš„æè¿°ã€‚ 123456789101112131415161718192021222324Promise.allSettled = function (promises) &#123; return new Promise((resolve, reject) =&gt; &#123; let index = 0; let result = []; if (promises.length === 0) &#123; resolve(result); &#125; else &#123; function processValue(i, data) &#123; result[i] = data; if (++index === promises.length) &#123; resolve(result); &#125; &#125; for (let i = 0; i &lt; promises.length; i++) &#123; //promises[i] å¯èƒ½æ˜¯æ™®é€šå€¼ Promise.resolve(promises[i]).then((data) =&gt; &#123; processValue(i, &#123; status: 'fulfilled', value: data &#125;); &#125;, (err) =&gt; &#123; processValue(i, &#123; status: 'rejected', reason: err &#125;) &#125;); &#125; &#125; &#125;);&#125; Promise.raceé¡¾åæ€ä¹‰ï¼ŒPromse.race å°±æ˜¯èµ›è·‘çš„æ„æ€ã€‚æ„æ€å°±æ˜¯è¯´ï¼ŒPromise.race([p1, p2, p3]) é‡Œé¢å“ªä¸ªç»“æœè·å¾—çš„å¿«ï¼Œå°±è¿”å›é‚£ä¸ªç»“æœï¼Œä¸ç®¡ç»“æœæœ¬èº«æ˜¯æˆåŠŸçŠ¶æ€è¿˜æ˜¯å¤±è´¥çŠ¶æ€ã€‚ å¦‚æœä¼ çš„å‚æ•°æ•°ç»„æ˜¯ç©ºï¼Œåˆ™è¿”å›çš„ promise å°†æ°¸è¿œç­‰å¾… å¦‚æœè¿­ä»£åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªéæ‰¿è¯ºå€¼å’Œ/æˆ–å·²è§£å†³/æ‹’ç»çš„æ‰¿è¯ºï¼Œåˆ™ Promise.race å°†è§£æä¸ºè¿­ä»£ä¸­æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªå€¼ 1234567891011121314151617Promise.race = function (promises) &#123; return new Promise((resolve, reject) =&gt; &#123; if (promises.length === 0) &#123; return; &#125; else &#123; for (let i = 0; i &lt; promises.length; i++) &#123; Promise.resolve(promises[i]).then((data) =&gt; &#123; resolve(data); return; &#125;, (err) =&gt; &#123; reject(err); return; &#125;); &#125; &#125; &#125;);&#125; è¯¦ç»†ä»£ç ï¼ŒåŒæ­¥ github","tags":[{"name":"javascript","slug":"javascript","permalink":"http://xyue.me/tags/javascript/"},{"name":"promise","slug":"promise","permalink":"http://xyue.me/tags/promise/"}]},{"title":"ä»å¤šçº¿ç¨‹åˆ° Event Loop","date":"2020-03-21T05:45:07.000Z","path":"2020/03/21/event-loop/","text":"åœ¨æˆ‘ä»¬çš„è®¤çŸ¥ä¸­ï¼Œjavascript æ˜¯å•çº¿ç¨‹çš„ï¼Œä½†å®ƒåˆæ˜¯å¦‚ä½•å®Œæˆè¯¸å¦‚å¼‚æ­¥è¯·æ±‚è¿™ç§å¤šçº¿ç¨‹æ“ä½œçš„å‘¢ï¼Ÿæˆ‘ä»¬å…ˆä»è¿›ç¨‹ã€çº¿ç¨‹çš„è§’åº¦æ¥äº†è§£è¿™ä¸ªé—®é¢˜ã€‚ è¿›ç¨‹ä¸çº¿ç¨‹ è¿›ç¨‹ æ˜¯ cpu èµ„æºåˆ†é…çš„æœ€å°å•ä½ï¼ˆæ˜¯èƒ½æ‹¥æœ‰èµ„æºå’Œç‹¬ç«‹è¿è¡Œçš„æœ€å°å•ä½ï¼‰ çº¿ç¨‹ æ˜¯ cpu è°ƒåº¦çš„æœ€å°å•ä½ï¼ˆçº¿ç¨‹æ˜¯å»ºç«‹åœ¨è¿›ç¨‹çš„åŸºç¡€ä¸Šçš„ä¸€æ¬¡ç¨‹åºè¿è¡Œå•ä½ï¼Œä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼‰ ä¸åŒè¿›ç¨‹ä¹‹é—´ä¹Ÿå¯ä»¥é€šä¿¡ï¼Œä»£ä»·è¾ƒå¤§ ç®€å•ç†è§£ï¼Œæˆ‘ä»¬æŠŠ cpu æ¯”ä½œå·¥å‚ï¼Œå·¥å‚æœ‰å¤šä¸ªè½¦é—´ï¼Œä½†å·¥å‚çš„ç”µåŠ›æœ‰é™ï¼Œæ¯æ¬¡åªèƒ½ä¾›ç»™ä¸€ä¸ªè½¦é—´ä½¿ç”¨ï¼ˆå•ä¸ª cpu ä¸€æ¬¡åªèƒ½è¿è¡Œä¸€ä¸ªä»»åŠ¡ï¼‰ã€‚è¿›ç¨‹ å°±å¥½æ¯”å·¥å‚çš„è½¦é—´ï¼Œå®ƒä»£è¡¨ cpu æ‰€èƒ½å¤„ç†çš„å•ä¸ªä»»åŠ¡, è¿›ç¨‹ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œä»»ä¸€æ—¶åˆ»ï¼Œcpu æ€»æ˜¯è¿è¡Œä¸€ä¸ªè¿›ç¨‹ï¼Œå…¶ä»–è¿›ç¨‹å¤„äºéè¿è¡ŒçŠ¶æ€ã€‚ cpu ä½¿ç”¨æ—¶é—´ç‰‡è½®è½¬è¿›åº¦ç®—æ³•æ¥å®ç°åŒæ—¶è¿è¡Œå¤šä¸ªè¿›ç¨‹ã€‚çº¿ç¨‹ å°±å¥½æ¯”è½¦é—´é‡Œçš„å·¥äººï¼Œä¸€ä¸ªè½¦é—´é‡Œï¼Œå¯ä»¥æœ‰å¾ˆå¤šå·¥äººï¼Œå…±äº«è½¦é—´æ‰€æœ‰çš„èµ„æºï¼Œä»–ä»¬ååŒå®Œæˆä¸€ä¸ªä»»åŠ¡ã€‚ ä¸€ä¸ª è¿›ç¨‹ å¯ä»¥åŒ…æ‹¬å¤šä¸ª çº¿ç¨‹ï¼Œå¤šä¸ª çº¿ç¨‹ å…±äº« è¿›ç¨‹ èµ„æºã€‚ æµè§ˆå™¨åŒ…å«äº†å“ªäº›è¿›ç¨‹ ä¸»è¿›ç¨‹ åè°ƒæ§åˆ¶å…¶ä»–å­è¿›ç¨‹ï¼ˆåˆ›å»ºã€é”€æ¯ï¼‰ æµè§ˆå™¨ç•Œé¢æ˜¾ç¤ºï¼Œç”¨æˆ·äº¤äº’ï¼Œå‰è¿›ã€åé€€ã€æ”¶è— å°†æ¸²æŸ“è¿›ç¨‹å¾—åˆ°çš„å†…å­˜ä¸­çš„ Bitmapï¼Œç»˜åˆ¶åˆ°ç”¨æˆ·ç•Œé¢ä¸Š å¤„ç†ä¸å¯è§æ“ä½œï¼Œç½‘ç»œè¯·æ±‚ï¼Œæ–‡ä»¶è®¿é—®ç­‰ ç¬¬ä¸‰æ–¹æ’ä»¶è¿›ç¨‹ æ¯ç§ç±»å‹çš„æ’ä»¶å¯¹åº”ä¸€ä¸ªè¿›ç¨‹ï¼Œä»…å½“ä½¿ç”¨è¯¥æ’ä»¶æ—¶æ‰åˆ›å»º GPUè¿›ç¨‹ ç”¨äº3Dç»˜åˆ¶ç­‰ æ¸²æŸ“è¿›ç¨‹ï¼Œå°±æ˜¯æˆ‘ä»¬è¯´çš„æµè§ˆå™¨å†…æ ¸ è´Ÿè´£é¡µé¢æ¸²æŸ“ï¼Œè„šæœ¬æ‰§è¡Œï¼Œäº‹ä»¶å¤„ç†ç­‰ æ¯ä¸ªtabé¡µä¸€ä¸ªæ¸²æŸ“è¿›ç¨‹ äº†è§£åˆ°æµè§ˆå™¨æ‰€åŒ…å«çš„è¿›ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œæ¸²æŸ“è¿›ç¨‹æ˜¯å‰ç«¯æ“ä½œæœ€é‡è¦çš„ä¸€ç¯ã€‚ æ¸²æŸ“è¿›ç¨‹æˆ‘ä»¬çŸ¥é“ï¼Œè¿›ç¨‹å’Œçº¿ç¨‹æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªè¿›ç¨‹åŒ…å«äº†å¤šæ¡çº¿ç¨‹ã€‚ å¯¹äº æ¸²æŸ“è¿›ç¨‹ è€Œè¨€ï¼Œå®ƒä¹Ÿæ˜¯å¤šçº¿ç¨‹çš„ï¼ŒåŒ…å«ï¼š GUI æ¸²æŸ“çº¿ç¨‹ è´Ÿè´£æ¸²æŸ“é¡µé¢ï¼Œå¸ƒå±€å’Œç»˜åˆ¶ é¡µé¢éœ€è¦é‡ç»˜å’Œå›æµæ—¶ï¼Œè¯¥çº¿ç¨‹å°±ä¼šæ‰§è¡Œ ä¸ JS å¼•æ“çº¿ç¨‹äº’æ–¥ï¼Œé˜²æ­¢æ¸²æŸ“ç»“æœä¸å¯é¢„æœŸ JS å¼•æ“çº¿ç¨‹ è´Ÿè´£å¤„ç†è§£æå’Œæ‰§è¡Œ javascript è„šæœ¬ç¨‹åº åªæœ‰ä¸€ä¸ª JS å¼•æ“çº¿ç¨‹ï¼ˆå•çº¿ç¨‹ï¼‰ ä¸ GUI æ¸²æŸ“çº¿ç¨‹äº’æ–¥ï¼Œé˜²æ­¢æ¸²æŸ“ç»“æœä¸å¯é¢„æœŸ äº‹ä»¶è§¦å‘çº¿ç¨‹ ç”¨æ¥æ§åˆ¶äº‹ä»¶å¾ªç¯ï¼ˆé¼ æ ‡ç‚¹å‡»ã€setTimeoutã€ajax ç­‰ï¼‰ å½“äº‹ä»¶æ»¡è¶³è§¦å‘æ¡ä»¶æ—¶ï¼Œå°†äº‹ä»¶æ”¾å…¥åˆ°JSå¼•æ“æ‰€åœ¨çš„æ‰§è¡Œé˜Ÿåˆ—ä¸­ å®šæ—¶è§¦å‘å™¨çº¿ç¨‹ setInterval ä¸ setTimeout æ‰€åœ¨çš„çº¿ç¨‹ å®šæ—¶ä»»åŠ¡å¹¶ä¸æ˜¯ç”± JS å¼•æ“è®¡æ—¶çš„ï¼Œæ˜¯ç”±å®šæ—¶è§¦å‘çº¿ç¨‹æ¥è®¡æ—¶çš„ è®¡æ—¶å®Œæ¯•åï¼Œé€šçŸ¥äº‹ä»¶è§¦å‘çº¿ç¨‹ å¼‚æ­¥ http è¯·æ±‚çº¿ç¨‹ æµè§ˆå™¨æœ‰ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ç”¨äºå¤„ç† ajax è¯·æ±‚ å½“è¯·æ±‚å®Œæˆæ—¶ï¼Œè‹¥æœ‰å›è°ƒå‡½æ•°ï¼Œé€šçŸ¥äº‹ä»¶è§¦å‘çº¿ç¨‹ å½“æˆ‘ä»¬äº†è§£äº†æ¸²æŸ“è¿›ç¨‹åŒ…å«çš„çº¿ç¨‹åï¼Œæˆ‘ä»¬æ€è€ƒä¸ºä»€ä¹ˆ javascript æ˜¯å•çº¿ç¨‹çš„ã€‚ ä¸ºä»€ä¹ˆæ˜¯å•çº¿ç¨‹å› ä¸ºå¤šçº¿ç¨‹çš„å¤æ‚æ€§ï¼Œå¤šçº¿ç¨‹æ“ä½œéœ€è¦åŠ é”ï¼Œç¼–ç çš„å¤æ‚æ€§ä¼šå¢é«˜ã€‚å¦‚æœåŒæ—¶æ“ä½œ DOM ï¼Œåœ¨å¤šçº¿ç¨‹ä¸åŠ é”çš„æƒ…å†µä¸‹ï¼Œæœ€ç»ˆä¼šå¯¼è‡´ DOM æ¸²æŸ“çš„ç»“æœä¸å¯é¢„æœŸã€‚ ä» event loop çœ‹ JS è¿è¡Œæœºåˆ¶åˆ°äº†è¿™é‡Œï¼Œç»ˆäºè¦è¿›å…¥æˆ‘ä»¬çš„ä¸»é¢˜ï¼Œä»€ä¹ˆæ˜¯ event loopã€‚ å…ˆç†è§£ä¸€äº›æ¦‚å¿µï¼š JS åˆ†ä¸ºåŒæ­¥ä»»åŠ¡å’Œå¼‚æ­¥ä»»åŠ¡ åŒæ­¥ä»»åŠ¡éƒ½åœ¨ JS å¼•æ“çº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œå½¢æˆä¸€ä¸ªæ‰§è¡Œæ ˆ äº‹ä»¶è§¦å‘çº¿ç¨‹ç®¡ç†ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼Œå¼‚æ­¥ä»»åŠ¡è§¦å‘æ¡ä»¶è¾¾æˆï¼Œå°†å›è°ƒäº‹ä»¶æ”¾åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ æ‰§è¡Œæ ˆä¸­æ‰€æœ‰åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œæ­¤æ—¶ JS å¼•æ“çº¿ç¨‹ç©ºé—²ï¼Œç³»ç»Ÿä¼šè¯»å–ä»»åŠ¡é˜Ÿåˆ—ï¼Œå°†å¯è¿è¡Œçš„å¼‚æ­¥ä»»åŠ¡å›è°ƒäº‹ä»¶æ·»åŠ åˆ°æ‰§è¡Œæ ˆä¸­ï¼Œå¼€å§‹æ‰§è¡Œ åœ¨å‰ç«¯å¼€å‘ä¸­æˆ‘ä»¬ä¼šé€šè¿‡ setTimeoutã€setInterval æ¥æŒ‡å®šå®šæ—¶ä»»åŠ¡ï¼Œé€šè¿‡ xhrã€fetch å‘é€ç½‘ç»œè¯·æ±‚ã€‚ æˆ‘ä»¬çŸ¥é“ï¼Œä¸ç®¡æ˜¯è¿™äº›å®šæ—¶ä»»åŠ¡æˆ–è€…ç½‘ç»œè¯·æ±‚ï¼Œè¿™äº›ä»£ç åœ¨æ‰§è¡Œï¼Œæœ¬èº«æ˜¯åŒæ­¥ä»»åŠ¡çš„ï¼Œè€Œå…¶ä¸­çš„å›è°ƒå‡½æ•°æ‰æ˜¯å¼‚æ­¥ä»»åŠ¡ã€‚ å½“ä»£ç æ‰§è¡Œåˆ° setTimeoutã€setInterval æ—¶ï¼Œå®é™…ä¸Šæ˜¯ JSå¼•æ“çº¿ç¨‹ é€šçŸ¥ å®šæ—¶è§¦å‘å™¨çº¿ç¨‹ï¼Œåœ¨é—´éš”æŒ‡å®šæ—¶é—´åï¼Œä¼šè§¦å‘ä¸€ä¸ªå›è°ƒäº‹ä»¶ï¼Œ è€Œ å®šæ—¶è§¦å‘å™¨çº¿ç¨‹ åœ¨æ¥æ”¶åˆ°è¿™ä¸ªæ¶ˆæ¯åï¼Œä¼šåœ¨ç­‰å¾…çš„æ—¶é—´åï¼Œå°†å›è°ƒäº‹ä»¶æ”¾å…¥åˆ°ç”± äº‹ä»¶è§¦å‘çº¿ç¨‹ æ‰€ç®¡ç†çš„äº‹ä»¶é˜Ÿåˆ—ä¸­ã€‚ å½“ä»£ç æ‰§è¡Œåˆ° xhrã€fetch æ—¶ï¼Œå®é™…ä¸Šæ˜¯ JSå¼•æ“çº¿ç¨‹ é€šçŸ¥ å¼‚æ­¥httpè¯·æ±‚çº¿ç¨‹ï¼Œå‘é€ä¸€ä¸ªç½‘ç»œè¯·æ±‚ï¼Œå¹¶åˆ¶å®šè¯·æ±‚å®Œæˆåçš„å›è°ƒäº‹ä»¶ï¼Œ è€Œ å¼‚æ­¥httpè¯·æ±‚çº¿ç¨‹ åœ¨æ¥æ”¶åˆ°è¿™ä¸ªæ¶ˆæ¯åï¼Œä¼šåœ¨è¯·æ±‚æˆåŠŸåï¼Œå°†å›è°ƒäº‹ä»¶æ”¾å…¥åˆ°ç”±äº‹ä»¶è§¦å‘çº¿ç¨‹ æ‰€ç®¡ç†çš„äº‹ä»¶é˜Ÿåˆ—ä¸­ã€‚ å½“æˆ‘ä»¬çš„åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œï¼ŒJSå¼•æ“çº¿ç¨‹ ä¼šè¯¢é—® äº‹ä»¶è§¦å‘çº¿ç¨‹ï¼Œåœ¨äº‹ä»¶é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰å¾…æ‰§è¡Œçš„å›è°ƒå‡½æ•°ï¼Œå¦‚æœæœ‰å°±ä¼šåŠ å…¥åˆ°æ‰§è¡Œæ ˆä¸­äº¤ç»™ JSå¼•æ“çº¿ç¨‹ æ‰§è¡Œã€‚ ç”¨ä¸€å¼ å›¾æ¥è§£é‡Šï¼š æ€»ç»“ï¼š JS å¼•æ“çº¿ç¨‹æ‰§è¡Œæ‰§è¡Œæ ˆä¸­çš„äº‹ä»¶ æ‰§è¡Œæ ˆä¸­çš„äº‹ä»¶æ‰§è¡Œå®Œæ¯•ï¼Œå°±å¼€å§‹è¯»å–äº‹ä»¶é˜Ÿåˆ—ä¸­çš„äº‹ä»¶ äº‹ä»¶é˜Ÿåˆ—ä¸­çš„å›è°ƒäº‹ä»¶åŠ å…¥åˆ°æ‰§è¡Œæ ˆä¾æ¬¡æ‰§è¡Œ 2,3 é‡å¤å¾ªç¯ å®ä»»åŠ¡ã€å¾®ä»»åŠ¡å½“æˆ‘ä»¬åŸºæœ¬äº†è§£äº†ä»€ä¹ˆæ˜¯æ‰§è¡Œæ ˆï¼Œä»€ä¹ˆæ˜¯äº‹ä»¶é˜Ÿåˆ—ä¹‹åï¼Œæˆ‘ä»¬æ·±å…¥äº†è§£ä¸€ä¸‹äº‹ä»¶å¾ªç¯ä¸­ å®ä»»åŠ¡ã€å¾®ä»»åŠ¡ã€‚ å®ä»»åŠ¡æˆ‘ä»¬å¯ä»¥å°†æ¯æ¬¡æ‰§è¡Œæ ˆæ‰§è¡Œçš„ä»£ç å½“åšæ˜¯ä¸€ä¸ªå®ä»»åŠ¡ï¼ˆåŒ…æ‹¬æ¯æ¬¡ä»äº‹ä»¶é˜Ÿåˆ—ä¸­è·å–ä¸€ä¸ªäº‹ä»¶å›è°ƒå¹¶æ”¾åˆ°æ‰§è¡Œæ ˆä¸­æ‰§è¡Œï¼‰ï¼Œæ¯ä¸€ä¸ªå®ä»»åŠ¡ä¼šä»å¤´åˆ°å°¾æ‰§è¡Œå®Œæ¯•ï¼Œä¸ä¼šæ‰§è¡Œå…¶ä»–ã€‚æˆ‘ä»¬å‰æ–‡æåˆ°è¿‡ JSå¼•æ“çº¿ç¨‹ å’Œ GUIæ¸²æŸ“çº¿ç¨‹ æ˜¯äº’æ–¥çš„å…³ç³»ï¼Œæµè§ˆå™¨ä¸ºäº†èƒ½å¤Ÿä½¿å®ä»»åŠ¡å’Œ DOM ä»»åŠ¡æœ‰åºçš„è¿›è¡Œï¼Œä¼šåœ¨ä¸€ä¸ªå®ä»»åŠ¡æ‰§è¡Œç»“æœåï¼Œåœ¨ä¸‹ä¸€ä¸ªå®ä»»åŠ¡æ‰§è¡Œå‰ï¼ŒGUI æ¸²æŸ“çº¿ç¨‹ å¼€å§‹å·¥ä½œï¼Œå¯¹é¡µé¢è¿›è¡Œæ¸²æŸ“ã€‚ 1// å®ä»»åŠ¡--&gt;æ¸²æŸ“--&gt;å®ä»»åŠ¡--&gt;æ¸²æŸ“--&gt;ï¼ï¼ï¼ scriptï¼ˆä¸»ä»£ç å—ï¼‰ï¼ŒsetTimeoutï¼ŒsetIntervalã€I/O(ajax),setImmedidate(node)ï¼Œéƒ½å±äºå®ä»»åŠ¡ã€‚ ä¸¾ä¸ªä¾‹å­ğŸŒ°ï¼š 1234document.body.style = 'background:black';document.body.style = 'background:red';document.body.style = 'background:blue';document.body.style = 'background:grey'; æˆ‘ä»¬å°†è¿™æ®µä»£ç æ”¾åˆ°æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œä¸€ä¸‹ï¼Œçœ‹ä¸€ä¸‹æ•ˆæœï¼š æˆ‘ä»¬çœ‹åˆ°ï¼Œé¡µé¢èƒŒæ™¯ä¼šåœ¨ç¬é—´å˜æˆç°è‰²ã€‚è¿™æ˜¯å› ä¸ºä»¥ä¸Šä»£ç å±äºåŒä¸€æ¬¡å®ä»»åŠ¡ï¼Œæ‰€ä»¥å…¨éƒ¨æ‰§è¡Œå®Œæ‰è§¦å‘é¡µé¢æ¸²æŸ“ï¼Œæ¸²æŸ“æ—¶GUI æ¸²æŸ“çº¿ç¨‹ä¼šå°†æ‰€æœ‰ UI æ”¹åŠ¨åˆå¹¶ä¼˜åŒ–ï¼Œæ‰€ä»¥åœ¨è§†è§‰æ•ˆæœä¸Šï¼Œåªä¼šçœ‹åˆ°é¡µé¢å˜æˆç°è‰²ã€‚ å†æ¥ä¸ªä¾‹å­ğŸŒ°ğŸŒ°ï¼š 1234document.body.style = 'background:blue';setTimeout(function() &#123; document.body.style = 'background:black'&#125;, 0); æ‰§è¡Œä¸€ä¸‹ï¼Œçœ‹ä¸‹æ•ˆæœï¼š æˆ‘ä»¬çœ‹åˆ°ï¼Œé¡µé¢å…ˆæ˜¾ç¤ºæˆè“è‰²èƒŒæ™¯ï¼Œç„¶ååˆå˜æˆäº†é»‘è‰²èƒŒæ™¯ï¼Œè¿™æ˜¯å› ä¸ºä»¥ä¸Šä»£ç å±äºä¸¤æ¬¡ å®ä»»åŠ¡ï¼Œç¬¬ä¸€æ¬¡ å®ä»»åŠ¡ æ‰§è¡Œçš„ä»£ç æ˜¯å°†èƒŒæ™¯å˜æˆè“è‰²ï¼Œç„¶åè§¦å‘æ¸²æŸ“ï¼Œå°†é¡µé¢å˜æˆè“è‰²ï¼Œå†è§¦å‘ç¬¬äºŒæ¬¡ å®ä»»åŠ¡ å°†èƒŒæ™¯å˜æˆé»‘è‰²ã€‚ å¾®ä»»åŠ¡æˆ‘ä»¬å·²ç»çŸ¥é“ å®ä»»åŠ¡ ç»“æŸåï¼Œä¼šæ‰§è¡Œæ¸²æŸ“ï¼Œç„¶åæ‰§è¡Œä¸‹ä¸€ä¸ª å®ä»»åŠ¡ï¼Œ è€Œ å¾®ä»»åŠ¡ å¯ä»¥ç†è§£æˆåœ¨å½“å‰ å®ä»»åŠ¡ æ‰§è¡Œåç«‹å³æ‰§è¡Œçš„ä»»åŠ¡ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ å®ä»»åŠ¡ æ‰§è¡Œå®Œï¼Œä¼šåœ¨æ¸²æŸ“å‰ï¼Œå°†æ‰§è¡ŒæœŸé—´æ‰€äº§ç”Ÿçš„æ‰€æœ‰ å¾®ä»»åŠ¡ éƒ½æ‰§è¡Œå®Œã€‚ 1// å®ä»»åŠ¡--&gt;å¾®ä»»åŠ¡--&gt;æ¸²æŸ“--&gt;å®ä»»åŠ¡--&gt;å¾®ä»»åŠ¡--&gt;æ¸²æŸ“--&gt;ï¼ï¼ï¼ process.nextTick(node)ï¼ŒPromiseï¼ŒMutationObserver å±äºå¾®ä»»åŠ¡ã€‚ process.nextTick æ˜¯æœ‰ä¸€ä¸ªæ’é˜Ÿæ“ä½œçš„ï¼Œå°±æ˜¯è¯´ä»–è¿›å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—æ—¶ï¼Œä¼šæ’åˆ°é™¤äº† process.nextTick å…¶ä»–çš„å¾®ä»»åŠ¡å‰é¢ã€‚ ä¸¾ä¸ªä¾‹å­ğŸŒ°ï¼š 1234567document.body.style = 'background:blue'console.log(1);Promise.resolve().then(()=&gt;&#123; console.log(2); document.body.style = 'background:black'&#125;);console.log(3); æ‰§è¡Œä¸€ä¸‹ï¼Œçœ‹ä¸‹æ•ˆæœï¼š æ§åˆ¶å°è¾“å‡º 1 3 2 , æ˜¯å› ä¸º promise å¯¹è±¡çš„ then æ–¹æ³•çš„å›è°ƒå‡½æ•°æ˜¯å¼‚æ­¥æ‰§è¡Œï¼Œæ‰€ä»¥ 2 æœ€åè¾“å‡ºé¡µé¢çš„èƒŒæ™¯è‰²ç›´æ¥å˜æˆé»‘è‰²ï¼Œæ²¡æœ‰ç»è¿‡è“è‰²çš„é˜¶æ®µï¼Œæ˜¯å› ä¸ºï¼Œæˆ‘ä»¬åœ¨å®ä»»åŠ¡ä¸­å°†èƒŒæ™¯è®¾ç½®ä¸ºè“è‰²ï¼Œä½†åœ¨è¿›è¡Œæ¸²æŸ“å‰æ‰§è¡Œäº†å¾®ä»»åŠ¡ï¼Œåœ¨å¾®ä»»åŠ¡ä¸­å°†èƒŒæ™¯å˜æˆäº†é»‘è‰²ï¼Œç„¶åæ‰æ‰§è¡Œçš„æ¸²æŸ“ã€‚ å†æ¯”å¦‚è¯´ï¼š 12345678setTimeout(() =&gt; &#123; console.log(1); Promise.resolve(3).then(data =&gt; console.log(data));&#125;, 0);setTimeout(() =&gt; &#123; console.log(2)&#125;, 0);// 1 3 2 ä¸Šé¢ä»£ç å…±åŒ…å«ä¸¤ä¸ª setTimeoutï¼Œä¹Ÿå°±æ˜¯è¯´é™¤ä¸»ä»£ç å—å¤–ï¼Œè¿˜æœ‰ä¸¤ä¸ª å®ä»»åŠ¡ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ª å®ä»»åŠ¡ æ‰§è¡Œä¸­ï¼Œè¾“å‡º 1ï¼Œå¹¶ä¸”åˆ›å»ºäº† å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œæ‰€ä»¥åœ¨ä¸‹ä¸€ä¸ª å®ä»»åŠ¡é˜Ÿåˆ— æ‰§è¡Œå‰ï¼Œå…ˆæ‰§è¡Œ å¾®ä»»åŠ¡ï¼Œåœ¨ å¾®ä»»åŠ¡ æ‰§è¡Œä¸­ï¼Œè¾“å‡º 3 ï¼Œå¾®ä»»åŠ¡ æ‰§è¡Œåï¼Œæ‰§è¡Œä¸‹ä¸€æ¬¡ å®ä»»åŠ¡ï¼Œæ‰§è¡Œä¸­è¾“å‡º 2ã€‚ æ€»ç»“ æ‰§è¡Œä¸€ä¸ªå®ä»»åŠ¡ ï¼ˆæ ˆä¸­æ²¡æœ‰å°±ä» äº‹ä»¶é˜Ÿåˆ— ä¸­è·å–ï¼‰ æ‰§è¡Œè¿‡ç¨‹ä¸­å¦‚æœé‡åˆ° å¾®ä»»åŠ¡ï¼Œå°±å°†å®ƒæ·»åŠ åˆ° å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­ å®ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åï¼Œç«‹å³æ‰§è¡Œå½“å‰ å¾®ä»»åŠ¡é˜Ÿåˆ— ä¸­çš„æ‰€æœ‰ å¾®ä»»åŠ¡ ï¼ˆä¾æ¬¡æ‰§è¡Œï¼‰ å½“å‰ å®ä»»åŠ¡ æ‰§è¡Œå®Œæ¯•ï¼Œå¼€å§‹æ£€æŸ¥æ¸²æŸ“ï¼Œç„¶å GUI æ¸²æŸ“çº¿ç¨‹ æ¥ç®¡æ¸²æŸ“ æ¸²æŸ“å®Œæ¯•åï¼ŒJSå¼•æ“çº¿ç¨‹ ç»§ç»­æ¥ç®¡ï¼Œå¼€å§‹ä¸‹ä¸€ä¸ª å®ä»»åŠ¡ï¼ˆä»äº‹ä»¶é˜Ÿåˆ—ä¸­è·å–ï¼‰ é¢˜å¤–è¯123setTimeout(()=&gt;console.log(3), 2);setTimeout(()=&gt;console.log(2), 1);setTimeout(()=&gt;console.log(1), 0); æ²¡æœ‰æ·±å…¥æ¥è§¦è¿‡ timer çš„åŒå­¦å¦‚æœç›´æ¥ä»ä»£ç ä¸­çš„å»¶æ—¶è®¾ç½®æ¥çœ‹ï¼Œä¼šå›ç­”ï¼š1ã€2ã€3ã€‚ è€Œå¦ä¸€äº›æœ‰ä¸€å®šç»éªŒçš„åŒå­¦å¯èƒ½ä¼šå›ç­”ï¼š3ã€2ã€1ã€‚å› ä¸º MDN çš„ setTimeout æ–‡æ¡£ä¸­æåˆ° HTML è§„èŒƒæœ€ä½å»¶æ—¶ä¸º 4msï¼š (è¡¥å……è¯´æ˜ï¼šæœ€ä½å»¶æ—¶çš„è®¾ç½®æ˜¯ä¸ºäº†ç»™CPUç•™ä¸‹ä¼‘æ¯æ—¶é—´ï¼‰ In fact, 4ms is specified by the HTML5 spec and is consistent across browsers released in 2010 and onward. Prior to (Firefox 5.0 / Thunderbird 5.0 / SeaMonkey 2.2), the minimum timeout value for nested timeouts was 10 ms. è€ŒçœŸæ­£ç—›è¿‡çš„åŒå­¦ä¼šå‘Šè¯‰ä½ ï¼Œç­”æ¡ˆæ˜¯ï¼š1ã€0ã€2ã€‚ æˆ‘ä»¬å‘ç° 0ms å’Œ 1ms çš„å»¶æ—¶æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œé€šè¿‡èµ„æ–™æˆ‘ä»¬å‘ç°ï¼š åœ¨ chrome ä¸­12// https://chromium.googlesource.com/chromium/blink/+/master/Source/core/frame/DOMTimer.cpp#93double intervalMilliseconds = std::max(oneMillisecond, interval * oneMillisecond); è¿™é‡Œ interval å°±æ˜¯ä¼ å…¥çš„æ•°å€¼ï¼Œå¯ä»¥çœ‹å‡ºä¼ å…¥ 0 å’Œä¼ å…¥ 1 ç»“æœéƒ½æ˜¯ oneMillisecondï¼Œå³ 1msã€‚ è¿™æ ·è§£é‡Šäº†ä¸ºä½• 1ms å’Œ 0ms è¡Œä¸ºæ˜¯ä¸€è‡´çš„ï¼Œé‚£ 4ms åˆ°åº•æ˜¯æ€ä¹ˆå›äº‹ï¼ŸæŸ¥é˜… HTML è§„èŒƒï¼Œå‘ç°è™½ç„¶æœ‰ 4ms çš„é™åˆ¶ï¼Œä½†æ˜¯æ˜¯å­˜åœ¨æ¡ä»¶çš„ï¼Œè¯¦è§è§„èŒƒç¬¬ 11 ç‚¹ï¼š If nesting level is greater than 5, and timeout is less than 4, then set timeout to 4. åœ¨ node ä¸­123// https://github.com/nodejs/node/blob/v8.9.4/lib/timers.js#L456if (!(after &gt;= 1 &amp;&amp; after &lt;= TIMEOUT_MAX)) after = 1; // schedule on next tick, follows browser behavior ä»£ç ä¸­çš„æ³¨é‡Šç›´æ¥è¯´æ˜äº†ï¼Œè®¾ç½®æœ€ä½ 1ms çš„è¡Œä¸ºæ˜¯ä¸ºäº†å‘æµè§ˆå™¨è¡Œä¸ºçœ‹é½ã€‚","tags":[{"name":"javascript","slug":"javascript","permalink":"http://xyue.me/tags/javascript/"}]},{"title":"thisã€callã€applyã€bind","date":"2020-03-18T07:16:37.000Z","path":"2020/03/18/this-call-apply-bind/","text":"thisé¢å‘å¯¹è±¡è¯­è¨€ä¸­ this è¡¨ç¤ºå½“å‰å¯¹è±¡çš„ä¸€ä¸ªå¼•ç”¨ã€‚ä½†åœ¨ JavaScript ä¸­ this ä¸æ˜¯å›ºå®šä¸å˜çš„ï¼Œå®ƒä¼šéšç€æ‰§è¡Œç¯å¢ƒçš„æ”¹å˜è€Œæ”¹å˜ã€‚ æ™®é€šå‡½æ•°æŒ‡å‘å‡½æ•°çš„è°ƒç”¨è€…é»˜è®¤ç»‘å®š12345var a = 'xyue';function foo() &#123; console.log(this.a);&#125;foo(); // xyue foo() ç›´æ¥è°ƒç”¨ï¼Œéä¸¥æ ¼æ¨¡å¼ä¸‹ this æŒ‡å‘ window ï¼Œä¸¥æ ¼æ¨¡å¼ä¸‹ this æŒ‡å‘ undefined; éšå¼ç»‘å®š12345678910var a = 'xyue1';var obj = &#123; a: 'xyue2', foo() &#123; console.log(this.a); &#125;&#125;obj.foo(); // xyue2var bar = obj.foo; bar(); // xyue1 obj.foo() æ˜¯ obj é€šè¿‡ . è¿ç®—ç¬¦è°ƒç”¨äº† foo()ï¼Œæ‰€ä»¥ this æŒ‡å‘ objï¼›bar() å®é™…ä¸Šæ˜¯æŠŠ foo å‡½æ•°èµ‹å€¼ç»™äº† barï¼Œæ²¡æœ‰è°ƒç”¨è€…ï¼Œæ‰€ä»¥ä½¿ç”¨çš„æ˜¯é»˜è®¤ç»‘å®šè§„åˆ™ï¼Œè¿™é‡Œçš„ this æŒ‡å‘ windowã€‚ æ˜¾å¼ç»‘å®š12345678910var a = 'xyue1';var obj = &#123; a: 'xyue2', foo() &#123; console.log(this.a); &#125;&#125;var bar = obj.foo; bar(); // xyue1bar.call(obj) // xyue2 ä½¿ç”¨ callã€ apply ã€ bind å¯ä»¥æ˜¾å¼ä¿®æ”¹ this çš„æŒ‡å‘ã€‚ new ç»‘å®š12345function Foo(name) &#123; this.name = name;&#125;var foo = new Foo('xyue');foo.name; // xyue new å®ç°åŸç† ç®­å¤´å‡½æ•°æŒ‡å‘å‡½æ•°æ‰€åœ¨çš„æ‰€ç”¨åŸŸç®­å¤´å‡½æ•°ä¸­æ²¡æœ‰ this ç»‘å®šï¼Œåœ¨ç®­å¤´å‡½æ•°ä¸­ this å§‹ç»ˆæŒ‡å‘å‡½æ•°æ‰€åœ¨çš„æ‰€ç”¨åŸŸã€‚ï¼ˆç®­å¤´å‡½æ•°ä¸èƒ½ä½œä¸ºæ„é€ å‡½æ•°ï¼‰ 1234567891011const obj = &#123; name: 'xyue', getName1() &#123; console.log(this.name); &#125;, getName2: () =&gt; &#123; console.log(this.name); &#125;&#125;obj.getName1(); // xyueobj.getName2(); // undefined callã€applyã€bind å®ç°åœ¨ javascript ä¸­ï¼Œcallã€applyã€bind éƒ½æ˜¯ä¸ºäº†æ”¹å˜æŸä¸ªå‡½æ•°è¿è¡Œæ—¶çš„ä¸Šä¸‹æ–‡ï¼ˆcontextï¼‰è€Œå­˜åœ¨çš„ï¼Œæ¢å¥è¯è¯´ï¼Œå°±æ˜¯ä¸ºäº†æ”¹å˜å‡½æ•°ä½“å†…éƒ¨ this çš„æŒ‡å‘ã€‚ ç›¸åŒç‚¹ å‡å¯ä»¥æ”¹å˜ this æŒ‡å‘ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸º thisçš„æŒ‡å‘å¯¹è±¡ ä¸åŒç‚¹ å‡½æ•°è°ƒç”¨ callã€apply æ—¶ï¼Œç›´æ¥è°ƒç”¨å‡½æ•°ï¼Œè€Œ bind è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•° callã€bind æ¥æ”¶åºåˆ—å‚æ•°ï¼Œapply æ¥æ”¶å‚æ•°æ•°ç»„ callä¸¾ä¸ªä¾‹å­ 1234567var foo = &#123; value: 1&#125;;function bar() &#123; console.log(this.value);&#125;bar.call(foo); // 1 æ³¨æ„ä¸¤ç‚¹ï¼š call æ”¹å˜äº† this çš„æŒ‡å‘ï¼ŒæŒ‡å‘åˆ° foo bar å‡½æ•°æ‰§è¡Œäº† é‚£ä¹ˆæˆ‘ä»¬è¯¥æ€ä¹ˆå®ç°è¿™ä¸¤ä¸ªæ•ˆæœå‘¢ï¼Ÿ è¯•æƒ³å½“è°ƒç”¨ call çš„æ—¶å€™ï¼ŒæŠŠ foo å¯¹è±¡æ”¹é€ æˆå¦‚ä¸‹ï¼š 1234567var foo = &#123; value: 1, bar: function() &#123; console.log(this.value) &#125;&#125;;foo.bar(); // 1 è¿™ä¸ªæ—¶å€™ this å°±æŒ‡å‘äº† fooã€‚ æ‰€ä»¥æˆ‘ä»¬å®ç°çš„æ­¥éª¤å¯ä»¥åˆ†ä¸ºï¼š å°†å‡½æ•°è®¾ä¸ºå¯¹è±¡çš„å±æ€§ æ‰§è¡Œè¯¥å‡½æ•° åˆ é™¤è¯¥å‡½æ•° 12345678910111213141516Function.prototype.myCall = function(context) &#123; var context = context || window; context.fn = this; var args = []; for(var i = 1, len = arguments.length; i &lt; len; i++) &#123; args.push(arguments[i]); &#125; var result; if(args.length &gt; 0)&#123; result = eval('context.fn(' + args +')'); &#125;else &#123; result = context.fn(); &#125; delete context.fn; return result;&#125; æˆ–è€…ä½¿ç”¨ ES6 æ‰©å±•è¿ç®—ç¬¦ï¼Œè§£æ„èµ‹å€¼ 12345678Function.prototype.myCall = function() &#123; var [context, ...args] = arguments; var context = context || window; context.fn = this; var result = context.fn(...args); delete context.fn; return result;&#125; applyapply çš„å®ç°è·Ÿ call ç±»ä¼¼ï¼Œå·®å¼‚åœ¨ä¸å‚æ•°çš„ä¼ é€’ä¸Šï¼š 123456789Function.prototype.myApply = function() &#123; // args ç¬¬äºŒä¸ªå‚æ•°ä¸ºæ•°ç»„ var [context, args] = arguments; var context = context || window; context.fn = this; var result = context.fn(...args); delete context.fn; return result;&#125; bind bind() æ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ªæ–°å‡½æ•°ã€‚å½“è¿™ä¸ªæ–°å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œbind() çš„ç¬¬ä¸€ä¸ªå‚æ•°å°†ä½œä¸ºå®ƒè¿è¡Œæ—¶çš„ thisï¼Œä¹‹åçš„ä¸€åºåˆ—å‚æ•°å°†ä¼šåœ¨ä¼ é€’çš„å®å‚å‰ä¼ å…¥ä½œä¸ºå®ƒçš„å‚æ•°ã€‚(æ¥è‡ªäº MDN ) å¯ä»¥çœ‹å‡º bind çš„ 2 ä¸ªç‰¹ç‚¹ï¼š è¿”å›ä¸€ä¸ªå‡½æ•° å¯ä»¥ä¼ å…¥å‚æ•° 12345678Function.prototype.myBind = function(context) &#123; var self = this; var args = Array.prototype.slice.call(arguments, 1); return function () &#123; var bindArgs = Array.prototype.slice.call(arguments); return self.apply(context, args.concat(bindArgs)); &#125;&#125; ä½†è¿™æ ·è¿˜å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä¸‹ 1234567891011121314151617181920212223242526var foo = &#123; value: 1&#125;;function Bar(name,age) &#123; this.hobby = 'sing'; console.log(this.value); console.log(name); console.log(age);&#125;Bar.prototype.friend = 'xyue';var bindFoo1 = Bar.bind(foo, 'fuzy');var obj1 = new bindFoo1('18');// undefined// fuzy// 18console.log(obj1.hobby); // singconsole.log(obj1.friend); // xyuevar bindFoo2 = Bar.myBind(foo, 'fuzy');var obj2 = new bindFoo2('18');// 1// fuzy// 18console.log(obj2.hobby); // undefinedconsole.log(obj2.friend); // undefined ä¸€ä¸ªç»‘å®šå‡½æ•°ä¹Ÿèƒ½ä½¿ç”¨ new æ“ä½œç¬¦åˆ›å»ºå¯¹è±¡ï¼šè¿™ç§è¡Œä¸ºå°±åƒæŠŠåŸå‡½æ•°å½“æˆæ„é€ å™¨ã€‚æä¾›çš„ this å€¼è¢«å¿½ç•¥ï¼ŒåŒæ—¶è°ƒç”¨æ—¶çš„å‚æ•°è¢«æä¾›ç»™æ¨¡æ‹Ÿå‡½æ•°ã€‚ æˆ‘ä»¬çœ‹åˆ°ï¼Œå½“ bind è¿”å›çš„å‡½æ•°ä½œä¸ºæ„é€ å‡½æ•°çš„æ—¶å€™ï¼Œbind æ—¶æŒ‡å®šçš„ this å€¼ä¼šå¤±æ•ˆï¼Œä½†ä¼ å…¥çš„å‚æ•°ä¾ç„¶ç”Ÿæ•ˆã€‚ æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹è¿”å›çš„å‡½æ•°çš„åŸå‹æ¥å®ç°ï¼š 12345678910Function.prototype.myBind = function(context) &#123; var self = this; var args = Array.prototype.slice.call(arguments, 1); var fBound = function () &#123; var bindArgs = Array.prototype.slice.call(arguments); return self.apply(this instanceof fBound ? this : context, args.concat(bindArgs)); &#125;; fBound.prototype = this.prototype; return fBound;&#125; ä½†æ˜¯åœ¨è¿™ä¸ªå†™æ³•ä¸­ï¼Œæˆ‘ä»¬ç›´æ¥å°† fBound.prototype = this.prototypeï¼Œæˆ‘ä»¬ç›´æ¥ä¿®æ”¹ fBound.prototype çš„æ—¶å€™ï¼Œä¹Ÿä¼šç›´æ¥ä¿®æ”¹ç»‘å®šå‡½æ•°çš„ prototypeã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªç©ºå‡½æ•°æ¥è¿›è¡Œä¸­è½¬ï¼š 123456789101112Function.prototype.myBind = function(context) &#123; var self = this; var args = Array.prototype.slice.call(arguments, 1); var fNOP = function () &#123;&#125;; var fBound = function () &#123; var bindArgs = Array.prototype.slice.call(arguments); return self.apply(this instanceof fNOP ? this : context, args.concat(bindArgs)); &#125;; fNOP.prototype = this.prototype; fBound.prototype = new fNOP(); return fBound;&#125; è¯´åˆ°è¿™ï¼Œé¡ºä¾¿è¯´ä¸€ä¸‹ Object.createï¼Œè¯¥æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œä½¿ç”¨ç°æœ‰çš„å¯¹è±¡æ¥æä¾›æ–°åˆ›å»ºçš„å¯¹è±¡çš„ __proto__ã€‚ä¸è€ƒè™‘ç¬¬äºŒä¸ªå‚æ•°ï¼Œå¯¹å…¶ä¸»è¦åŠŸèƒ½åšç®€å•å®ç°ï¼š 12345Object.create = function(obj) &#123; function f() &#123;&#125;; f.prototype = obj; return new f;&#125;; å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œè¿™ä¸å°±æ˜¯åˆ›å»ºä¸€ä¸ªç©ºå‡½æ•°è¿›è¡Œä¸­è½¬ä¹ˆï¼Œæ‰€ä»¥æˆ‘ä»¬çš„å®ç°ä»£ç å¦‚ä¸‹ï¼š 12345678910Function.prototype.myBind = function(context) &#123; var self = this; var args = Array.prototype.slice.call(arguments, 1); var fBound = function () &#123; var bindArgs = Array.prototype.slice.call(arguments); return self.apply(this instanceof fBound ? this : context, args.concat(bindArgs)); &#125;; fBound.prototype = Object.create(this.prototype); return fBound;&#125; å½“ç„¶è¿™éƒ½æ˜¯æ¨¡æ‹Ÿå®ç°ï¼Œå¹¶ä¸æ˜¯å®Œç¾çš„ï¼Œæ¯”å¦‚ï¼š 123456789101112131415var foo = &#123; value: 1&#125;;function Bar(name,age) &#123; this.hobby = 'sing'; console.log(this.value); console.log(name); console.log(age);&#125;Bar.prototype.friend = 'xyue';var bindFoo1 = Bar.bind(foo, 'fuzy');var bindFoo2 = Bar.myBind(foo, 'fuzy');console.log(bindFoo1.prototype); // undefinedconsole.log(bindFoo2.prototype); // Bar &#123;&#125; æˆ‘ä»¬çœ‹åˆ°åŸç”Ÿçš„ bind è¿”å›çš„å‡½æ•°æ˜¯æ²¡æœ‰ prototype å±æ€§çš„ã€‚æ­£å¦‚åŸç”Ÿçš„ bind æ–¹æ³•çš„ç‰¹æ€§å®šä¹‰çš„é‚£æ ·ã€‚ bindæ–¹æ³•æ‰€è¿”å›çš„å‡½æ•°å¹¶ä¸åŒ…å« prototype å±æ€§ï¼Œå¹¶ä¸”å°†è¿™äº›ç»‘å®šçš„å‡½æ•°ç”¨ä½œæ„é€ å‡½æ•°æ‰€åˆ›å»ºçš„å¯¹è±¡ä»åŸå§‹çš„æœªç»‘å®šçš„æ„é€ å‡½æ•°ä¸­ç»§æ‰¿ prototype æ‰€ä»¥æˆ‘ä»¬ç”¨ es6 æ–¹æ³•å®ç°åšä¸€äº›è¡¥å……ï¼š 123456789101112Function.prototype.myBind = function(context, ...args) &#123; var self = this; var Fn = function(...bindArgs) &#123; var allArgs = args.concat(bindArgs); if(this instanceof Fn) &#123; return new self(...allArgs); &#125; return self.apply(context, allArgs); &#125; delete Fn.prototype; return Fn;&#125; è¿™æ ·ä¸åŸç”Ÿçš„ bind è¡¨ç°å°±å¤§è‡´ä¸€æ ·äº†ã€‚","tags":[{"name":"javascript","slug":"javascript","permalink":"http://xyue.me/tags/javascript/"}]},{"title":"javascript new åŸç†","date":"2020-03-17T10:12:26.000Z","path":"2020/03/17/what-did-new-do/","text":"new çš„ä½œç”¨æˆ‘ä»¬å…ˆé€šè¿‡ç®€å•çš„ä¾‹å­æ¥äº†è§£ä¸‹ new çš„ä½œç”¨å§ã€‚ 12345678910function Person(name) &#123; this.name = name;&#125;Person.prototype.getName = function () &#123; console.log(this.name);&#125;var person = new Person('xyue');console.log(person); // Person &#123;name: \"xyue\"&#125;console.log(person.name); // xyueconsole.log(person.getName()); // xyue ä»ä¸Šè¾¹ä¾‹å­ä¸­æˆ‘ä»¬å¯ä»¥å¾—åˆ°ç»“è®ºï¼š é€šè¿‡ new æ„é€ å‡½æ•° Person åˆ›å»ºå‡ºæ¥çš„å®ä¾‹å¯ä»¥è®¿é—®åˆ°æ„é€ å‡½æ•°ä¸­çš„å±æ€§ é€šè¿‡ new æ„é€ å‡½æ•° Person åˆ›å»ºå‡ºæ¥çš„å®ä¾‹å¯ä»¥è®¿é—®åˆ°æ„é€ å‡½æ•°åŸå‹é“¾ä¸­çš„å±æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´é€šè¿‡ new æ“ä½œç¬¦ï¼Œå®ä¾‹ä¸æ„é€ å‡½æ•°é€šè¿‡åŸå‹é“¾è¿æ¥äº†èµ·æ¥ ä½†æ˜¯å½“å‰çš„æ„é€ å‡½æ•° Person å¹¶æ²¡æœ‰ return ä»»ä½•å€¼ï¼Œå¦‚æœæˆ‘ä»¬è®©å®ƒè¿”å›å€¼ä¼šå‘ç”Ÿä»€ä¹ˆäº‹æƒ…å‘¢ï¼Ÿ 1234567function Person(name) &#123; this.name = name; return 1;&#125;var person = new Person('xyue');console.log(person); // Person &#123;name: \"xyue\"&#125;console.log(person.name); // xyue è™½ç„¶åœ¨æ„é€ å‡½æ•°ä¸­è¿”å›äº† 1ï¼Œä½†æ˜¯è¿™ä¸ªè¿”å›å€¼ï¼ˆåŸå§‹å€¼ï¼‰å¹¶æ²¡æœ‰ä»»ä½•ç”¨å¤„ï¼Œå¾—åˆ°çš„ç»“æœå®Œå…¨ä¸€æ ·ã€‚æ‰€ä»¥é€šè¿‡è¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºå¦å¤–ä¸€ä¸ªç»“è®ºï¼š æ„é€ å‡½æ•°å¦‚æœè¿”å›åŸå§‹å€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªè¿”å›å€¼æ²¡æœ‰æ„ä¹‰ è¯•å®Œäº†è¿”å›åŸå§‹å€¼ï¼Œæˆ‘ä»¬å†æ¥è¯•è¯•è¿”å›å¯¹è±¡ä¼šå‘ç”Ÿä»€ä¹ˆäº‹æƒ…å§ï¼š 12345678function Person(name) &#123; this.name = name; console.log(this); // Person &#123;name: \"xyue\"&#125; return &#123; age: 18 &#125;;&#125;var person = new Person('xyue');console.log(person); // &#123;age: 18&#125;console.log(person.name); // undefined é€šè¿‡è¿™ä¸ªä¾‹å­æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå½“æ„é€ å‡½æ•°è¿”å›å€¼ä¸ºå¯¹è±¡æ—¶ï¼Œå†…éƒ¨çš„ this è™½ç„¶æ­£å¸¸å·¥ä½œï¼Œä½†æ˜¯è¿™ä¸ªè¿”å›å€¼ä¼šè¢«æ­£å¸¸çš„è¿”å›å‡ºå»ã€‚é€šè¿‡è¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å†æ¬¡å¾—åˆ°ä¸€ä¸ªç»“è®ºï¼š æ„é€ å‡½æ•°å¦‚æœè¿”å›å€¼ä¸ºå¯¹è±¡ï¼Œé‚£ä¹ˆè¿™ä¸ªè¿”å›å€¼ä¼šè¢«æ­£å¸¸ä½¿ç”¨ å®ç°é€šè¿‡ä»¥ä¸Šå‡ ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¤§è‡´äº†è§£äº† new æ“ä½œç¬¦çš„å‡ ä¸ªä½œç”¨ã€‚ new è¿ç®—ç¬¦ åˆ›å»ºä¸€ä¸ªç”¨æˆ·å®šä¹‰çš„å¯¹è±¡ç±»å‹çš„å®ä¾‹æˆ–å…·æœ‰æ„é€ å‡½æ•°çš„å†…ç½®å¯¹è±¡çš„å®ä¾‹ã€‚new å…³é”®å­—ä¼šè¿›è¡Œå¦‚ä¸‹çš„æ“ä½œï¼š åˆ›å»ºä¸€ä¸ªç©ºçš„ç®€å• JavaScript å¯¹è±¡ï¼ˆå³{}ï¼‰ é“¾æ¥è¯¥å¯¹è±¡ï¼ˆå³è®¾ç½®è¯¥å¯¹è±¡çš„æ„é€ å‡½æ•°ï¼‰åˆ°å¦ä¸€ä¸ªå¯¹è±¡ å°†æ­¥éª¤ 1 æ–°åˆ›å»ºçš„å¯¹è±¡ä½œä¸º this çš„ä¸Šä¸‹æ–‡ å¦‚æœè¯¥å‡½æ•°æ²¡æœ‰è¿”å›å¯¹è±¡ï¼Œåˆ™è¿”å› this 1234567891011121314function _new() &#123; // åˆ›å»ºçš„æ–°å¯¹è±¡ var obj = &#123;&#125;; // ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ„é€ å‡½æ•° var [constructor, ...args] = [...arguments]; // å°†æ–°å¯¹è±¡çš„çš„åŸå‹æŒ‡å‘å½“å‰æ„é€ å‡½æ•°çš„åŸå‹ obj.__proto__ = constructor.prototype; // æ‰§è¡Œæ„é€ å‡½æ•°ï¼Œå°†å±æ€§æˆ–æ–¹æ³•æ·»åŠ åˆ°åˆ›å»ºçš„ç©ºå¯¹è±¡ä¸Š var result = constructor.apply(obj, args); // å¦‚æœæ²¡æœ‰è¿”å›å…¶ä»–å¯¹è±¡ï¼Œå°±è¿”å› objï¼Œå¦åˆ™è¿”å›å…¶ä»–å¯¹è±¡ return typeof result === 'object' ? result : obj;&#125;_new(Person,'xyue'); // Person &#123;name: \"xyue\"&#125; é€šè¿‡ new æ“ä½œç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºåŸå¯¹è±¡çš„ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œè€Œè¿™ä¸ªå®ä¾‹å¯¹è±¡ç»§æ‰¿äº†åŸå¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•ï¼Œæ‰€ä»¥ new å­˜åœ¨çš„æ„ä¹‰åœ¨äºå®ƒå®ç°äº† javascript ä¸­çš„ç»§æ‰¿ï¼Œè€Œä¸ä»…ä»…æ˜¯å®ä¾‹åŒ–äº†ä¸€ä¸ªå¯¹è±¡ã€‚","tags":[{"name":"javascript","slug":"javascript","permalink":"http://xyue.me/tags/javascript/"}]},{"title":"CSS ä»£ç ä¹¦å†™è§„èŒƒ","date":"2018-08-28T03:43:43.000Z","path":"2018/08/28/css-code-writing-standard/","text":"æ–‡ä»¶åœ¨æ ·å¼æ–‡ä»¶çš„ç¬¬ä¸€è¡Œé¦–ä¸ªå­—ç¬¦ä½ç½®å†™ä¸Š @charset è§„åˆ™ï¼Œç¼–ç åç”¨ â€œUTF-8â€ã€‚ 123@charset \"UTF-8\";.xyue&#123;&#125; æ ¼å¼åŒ–æ ·å¼ä¹¦å†™ä¸€èˆ¬æœ‰ä¸¤ç§ï¼š å±•å¼€æ ¼å¼ (Expanded) 1234.xyue &#123; display: block; width: 100px;&#125; ç´§å‡‘æ ¼å¼ (Compact) 1.xyue &#123;display: block;width: 100px;&#125; ä½¿ç”¨å±•å¼€æ ¼å¼ä¹¦å†™æ ·å¼ å¤§å°å†™æ ·å¼é€‰æ‹©å™¨ï¼Œå±æ€§åï¼Œå±æ€§å€¼å…³é”®å­—å‡ä½¿ç”¨å°å†™å­—æ¯ä¹¦å†™ï¼Œå±æ€§å­—ç¬¦ä¸²å…è®¸ä½¿ç”¨å¤§å°å†™ã€‚ 123456789/* YES */ .xyue &#123; font-family: 'Microsoft YaHei UI';&#125;/* NO */.XYUE &#123; DISPLAY: BLOCK;&#125; é€‰æ‹©å™¨ å°½é‡å°‘ç”¨é€šç”¨é€‰æ‹©å™¨ * ä¸ä½¿ç”¨ ID é€‰æ‹©å™¨ ä¸ä½¿ç”¨æ— å…·ä½“è¯­ä¹‰å®šä¹‰çš„æ ‡ç­¾é€‰æ‹©å™¨ 123456789/* YES */.xyue &#123;&#125;.xyue li &#123;&#125;.xyue li p&#123;&#125;/* NO */*&#123;&#125;#xyue &#123;&#125;.xyue div&#123;&#125; ä»£ç æ˜“è¯»æ€§æ¯ä¸ªå±æ€§å£°æ˜æœ«å°¾éƒ½è¦åŠ åˆ†å·123456789/* YES */.xyue &#123; width: 100%; &#125;/* NO */.xyue&#123; width: 100%&#125; å·¦æ‹¬å·ä¸ç±»åä¹‹é—´ä¸€ä¸ªç©ºæ ¼ï¼Œå†’å·ä¸å±æ€§å€¼ä¹‹é—´ä¸€ä¸ªç©ºæ ¼123456789/* YES */.xyue &#123; width: 100%; &#125;/* NO */.xyue&#123; width:100%;&#125; é€—å·åˆ†éš”çš„å–å€¼ï¼Œé€—å·ä¹‹åä¸€ä¸ªç©ºæ ¼123456789/* YES */.xyue &#123; box-shadow: 1px 1px 1px #000, 2px 2px 2px #999;&#125;/* NO */.xyue &#123; box-shadow: 1px 1px 1px #000,2px 2px 2px #999;&#125; ä¸ºå•ä¸ªcssé€‰æ‹©å™¨æˆ–æ–°ç”³æ˜å¼€å¯æ–°è¡Œ12345678910111213141516/* YES */.xyue, .xyue_logo, .xyue_hd &#123; color: #ff0;&#125;.nav&#123; color: #fff;&#125;/* NO */.xyue,.xyue_logo,.xyue_hd &#123; color: #ff0;&#125;.nav&#123; color: #fff;&#125; é¢œè‰²å€¼ rgb() rgba() hsl() hsla() rect() ä¸­ä¸éœ€æœ‰ç©ºæ ¼ï¼Œä¸”å–å€¼ä¸è¦å¸¦æœ‰ä¸å¿…è¦çš„ 0123456789/* YES */.xyue &#123; color: rgba(255,255,255,.5);&#125;/* NO */.xyue &#123; color: rgba( 255, 255, 255, 0.5 );&#125; å±æ€§å€¼åå…­è¿›åˆ¶æ•°å€¼èƒ½ç”¨ç®€å†™çš„å°½é‡ç”¨ç®€å†™123456789/* YES */.xyue &#123; color: #fff;&#125;/* NO */.xyue &#123; color: #ffffff;&#125; ä¸è¦ä¸º 0 æŒ‡æ˜å•ä½123456789/* YES */.xyue &#123; margin: 0 10px;&#125;/* NO */.xyue &#123; margin: 0px 10px;&#125; å±æ€§å€¼å¼•å·123456789/* YES */.xyue &#123; font-family: 'Microsoft YaHei UI';&#125;/* NO */.xyue &#123; font-family: \"Microsoft YaHei UI\";&#125; å±æ€§ä¹¦å†™é¡ºåºéµå¾ªä»¥ä¸‹é¡ºåºï¼š å¸ƒå±€å®šä½å±æ€§ï¼šdisplay / position / float / clear / visibility / overflow è‡ªèº«å±æ€§ï¼šwidth / height / margin / padding / border / background æ–‡æœ¬å±æ€§ï¼šcolor / font / text-decoration / text-align / vertical-align / white- space / break-word å…¶ä»–å±æ€§ï¼ˆCSS3ï¼‰ï¼šcontent / cursor / border-radius / box-shadow / text-shadow / background:linear-gradient â€¦ 1234567891011121314151617.xyue &#123; display: block; position: relative; float: left; width: 100px; height: 100px; margin: 0 10px; padding: 20px 0; font-family: Arial, 'Helvetica Neue', Helvetica, sans-serif; color: #333; background: rgba(0,0,0,.5); -webkit-border-radius: 10px; -moz-border-radius: 10px; -ms-border-radius: 10px; -o-border-radius: 10px; border-radius: 10px;&#125; CSS3 æµè§ˆå™¨ç§æœ‰å‰ç¼€åœ¨å‰ï¼Œæ ‡å‡†å‰ç¼€åœ¨å","tags":[{"name":"css","slug":"css","permalink":"http://xyue.me/tags/css/"}]},{"title":"JS æ˜“æ··æ·†çš„æ–¹æ³•æ•´ç†","date":"2018-02-23T06:12:58.000Z","path":"2018/02/23/js-easy-to-confuse-methods/","text":"jsçš„å­—ç¬¦ä¸²æ–¹æ³•å¦‚substrã€substringï¼Œæ•°ç»„æ–¹æ³•å¦‚sliceã€spliceç­‰åå­—ç›¸è¿‘ï¼Œç”¨æ³•ç¨æœ‰ä¸åŒï¼Œè®©å¼€å‘è€…åœ¨å¼€å‘è¿‡ç¨‹ä¸­æ€»æ˜¯è®°ä¸èµ·å…¶ç”¨æ³•ï¼Œéœ€è¦æŸ¥èµ„æ–™ã€‚ç°æ•´ç†ä¸€ä¸‹ï¼Œå¸Œæœ›æœ‰åŠ©å¤§å®¶è®°å¿†ã€‚ String å¯¹è±¡slice stringObject.slice(start, end) 123456var a = 'Hello world!';var b = a.slice(2);var c = a.slice(-4, -2);// a: 'Hello world!'// b: 'llo world!'// c: 'rl'ï¼Œå‚æ•°å¯ä¸ºè´Ÿ substr stringObject.substr(start, length) 123456var a = 'Hello world!';var b = a.substr(0, 4);var c = a.substr(-5, 2);// a: 'Hello world!'// b: 'Hell'// c: 'or'ï¼Œå‚æ•°å¯ä¸ºè´Ÿ substring stringObject.substring(start, stop) 12345678var a = 'Hello world!';var b = a.substring(0, 4);var c = a.substring(3, 2);var d = a.substring(0, -1);// a: 'Hello world!'// b: 'Hell'// c: 'l'ï¼Œstartæ¯”stopå°ï¼Œäº¤æ¢è¿™ä¸¤ä¸ªå‚æ•°// d: ''ï¼Œå‚æ•°ä¸ºè´Ÿï¼Œè¿”å›ç©ºå­—ç¬¦ä¸² sliceã€substrã€substringéƒ½æ˜¯å­—ç¬¦ä¸²çš„åˆ‡å‰²æ–¹æ³•ï¼Œä¸‰è€…ä¹‹é—´æœ‰ç»†å¾®çš„åŒºåˆ«ï¼Œæ ¹æ®ä¸åŒçš„ä½¿ç”¨åœºæ™¯å¯ä»¥çµæ´»ä½¿ç”¨ã€‚ä¸‰ç§æ–¹æ³•éƒ½æ˜¯ç”Ÿæˆæ–°çš„å­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯ä¿®æ”¹åŸstringã€‚ Arrayå¯¹è±¡concat arrayObject.concat(arrayX, arrayX, â€¦, arrayX) å‚æ•°å¯ä»¥ä¸ºå…·ä½“çš„å€¼ï¼Œä¹Ÿå¯ä»¥ä¸ºæ•°ç»„å¯¹è±¡ï¼Œå¯ä»¥ä»»æ„å¤šä¸ªã€‚ä¸æ”¹å˜ç°æœ‰çš„æ•°ç»„ï¼Œè¿”å›è¢«è¿æ¥æ•°ç»„çš„ä¸€ä¸ªå‰¯æœ¬ã€‚ 123456var a = [1, 2, 3];var b = a.concat(4, 5);var c = a.concat([4, 5]);// a: [1, 2, 3]// b: [1, 2, 3, 4, 5]// c: [1, 2, 3, 4, 5] pop arrayObject.pop() åˆ é™¤ arrayObject çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼ŒæŠŠæ•°ç»„é•¿åº¦å‡ 1ï¼Œå¹¶ä¸”è¿”å›å®ƒåˆ é™¤çš„å…ƒç´ çš„å€¼ã€‚å¦‚æœæ•°ç»„å·²ç»ä¸ºç©ºï¼Œåˆ™ pop() ä¸æ”¹å˜æ•°ç»„ï¼Œå¹¶è¿”å› undefined å€¼ã€‚è¯¥æ–¹æ³•ä¼šæ”¹å˜åŸæ•°ç»„ã€‚ 1234var a = [1, 2, 3];var b = a.pop();// a: [1, 2]ï¼Œä¿®æ”¹äº†åŸæ•°ç»„// b: 3ï¼Œè¿”å›åˆ é™¤å…ƒç´ çš„å€¼ push arrayObject.push(newelement1,newelement2,â€¦,newelementX)\\ å‚æ•°é¡ºåºæ·»åŠ åˆ° arrayObject çš„å°¾éƒ¨ï¼Œç›´æ¥ä¿®æ”¹ arrayObjectã€‚ 1234var a = [1, 2, 3];var b = a.push(4, 5);// a: [1, 2, 3, 4, 5]ï¼Œä¿®æ”¹äº†åŸæ•°ç»„// b: 5ï¼Œè¿”å›ä¿®æ”¹åçš„æ•°ç»„çš„é•¿åº¦ shift arrayObject.shift() æŠŠæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä»å…¶ä¸­åˆ é™¤ï¼Œå¹¶è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ çš„å€¼ã€‚å¦‚æœæ•°ç»„æ˜¯ç©ºçš„ï¼Œé‚£ä¹ˆ shift() æ–¹æ³•å°†ä¸è¿›è¡Œä»»ä½•æ“ä½œï¼Œè¿”å› undefined å€¼ã€‚è¯¥æ–¹æ³•ä¼šæ”¹å˜åŸæ•°ç»„ã€‚ç±»æ¯”popæ–¹æ³•ã€‚ 1234var a = [1, 2, 3];var b = a.shift();// a: [2, 3]ï¼Œä¿®æ”¹äº†åŸæ•°ç»„// b: 1ï¼Œè¿”å›åˆ é™¤å…ƒç´ çš„å€¼ unshift arrayObject.unshift(newelement1, newelement2, â€¦., newelementX) å‘æ•°ç»„çš„å¼€å¤´æ·»åŠ ä¸€ä¸ªæˆ–æ›´å¤šå…ƒç´ ï¼Œå¹¶è¿”å›æ–°çš„é•¿åº¦ã€‚è¯¥æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°å°†æˆä¸ºæ•°ç»„çš„æ–°å…ƒç´  0ï¼Œå¦‚æœè¿˜æœ‰ç¬¬äºŒä¸ªå‚æ•°ï¼Œå®ƒå°†æˆä¸ºæ–°çš„å…ƒç´  1ï¼Œä»¥æ­¤ç±»æ¨ã€‚ 1234var a = [1, 2, 3];var b = a.unshift(4, 5);// a: [ 4, 5, 1, 2, 3 ]ï¼Œä¿®æ”¹äº†åŸæ•°ç»„// b: 5ï¼Œè¿”å›ä¿®æ”¹åçš„æ•°ç»„çš„é•¿åº¦ slice arrayObject.slice(start, end) è¿”å›ä¸€ä¸ªæ–°çš„æ•°ç»„ï¼ŒåŒ…å«ä» start åˆ° end ï¼ˆä¸åŒ…æ‹¬è¯¥å…ƒç´ ï¼‰çš„ arrayObject ä¸­çš„å…ƒç´ ã€‚è¯¥æ–¹æ³•ä¸ä¼šä¿®æ”¹åŸæ•°ç»„ã€‚ 123456789var a = [1, 2, 3, 4, 5];var b = a.slice(2);// a: [1, 2, 3, 4, 5]ï¼Œä¸ä¿®æ”¹åŸæ•°ç»„// b: [3, 4, 5]ï¼Œè¿”å›æ–°æ•°ç»„var c = [1, 2, 3, 4, 5];var d = c.slice(2, -1);// c: [1, 2, 3, 4, 5]ï¼Œä¸ä¿®æ”¹åŸæ•°ç»„// d: [3, 4]ï¼Œè¿”å›æ–°æ•°ç»„ splice arrayObject.splice(index, howmany, item1, â€¦, itemX) å¯åˆ é™¤ä» index å¤„å¼€å§‹çš„é›¶ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼Œå¹¶ä¸”ç”¨å‚æ•°åˆ—è¡¨ä¸­å£°æ˜çš„ä¸€ä¸ªæˆ–å¤šä¸ªå€¼æ¥æ›¿æ¢é‚£äº›è¢«åˆ é™¤çš„å…ƒç´ ã€‚å¦‚æœä» arrayObject ä¸­åˆ é™¤äº†å…ƒç´ ï¼Œåˆ™è¿”å›çš„æ˜¯å«æœ‰è¢«åˆ é™¤çš„å…ƒç´ çš„æ•°ç»„ã€‚ 12345678910111213141516171819var a = [1, 2, 3, 4, 5];var b = a.splice(1, 1);// a: [1, 3, 4, 5]ï¼Œä¿®æ”¹äº†åŸæ•°ç»„// b: [2]ï¼Œè¿”å›æ–°æ•°ç»„var c = [1, 2, 3, 4, 5];var d = c.splice(-1, 1);// c: [1, 2, 3, 4]ï¼Œä¿®æ”¹äº†åŸæ•°ç»„// d: [5]ï¼Œè¿”å›æ–°æ•°ç»„var e = [1, 2, 3, 4, 5];var f = e.splice(1, 1, 6, 7);// e: [ 1, 6, 7, 3, 4, 5 ]ï¼Œä¿®æ”¹äº†åŸæ•°ç»„// f: [2]ï¼Œè¿”å›æ–°æ•°ç»„var g = [1, 2, 3, 4, 5];var h = g.splice(1, 0, 8);// g: [ 1, 8, 2, 3, 4, 5 ]ï¼Œä¿®æ”¹äº†åŸæ•°ç»„// h: []ï¼Œæ²¡æœ‰åˆ é™¤å€¼ï¼Œè¿”å›ç©ºæ•°ç»„ sort arrayObject.sort(sortBy) æ— å‚æ•°æ—¶ï¼Œå°†æŒ‰å­—æ¯é¡ºåºå¯¹æ•°ç»„ä¸­çš„å…ƒç´ è¿›è¡Œæ’åºã€‚å‚æ•°ä¸ºæ¯”è¾ƒå‡½æ•°æ—¶ï¼Œå¦‚æœè¦äº¤æ¢ prev å’Œ next çš„å€¼ï¼Œè¿”å›å¤§äº 0 çš„å€¼ã€‚ 123456var a = [1, 10, 8, 6, 9];var b = a.sort(function (prev, next) &#123; return prev - next;&#125;);// a: [1, 6, 8, 9, 10]ï¼Œä¿®æ”¹äº†åŸæ•°ç»„// b: [1, 6, 8, 9, 10]ï¼Œè¿”å›ä¿®æ”¹åçš„æ•°ç»„ reverse arrayObject.reverse() ç”¨äºé¢ å€’æ•°ç»„ä¸­å…ƒç´ çš„é¡ºåºã€‚ä¼šæ”¹å˜åŸæ•°ç»„ã€‚ 1234var a = [1, 2, 3];var b = a.reverse();// a: [3, 2, 1]ï¼Œä¿®æ”¹äº†åŸæ•°ç»„// b: [3, 2, 1]ï¼Œè¿”å›ä¿®æ”¹åçš„æ•°ç»„ map arrayObject.map(function(currentValue, index, arrayObject) {}) å¯¹æ•°ç»„çš„æ¯ä¸€é¡¹è¿›è¡Œå¤„ç†ï¼Œè¿”å›æ–°æ•°ç»„ã€‚ 1234var a = [1, 2, 3];var b = a.map((curVal) =&gt; curVal * 2);// a: [1, 2, 3]ï¼Œä¸ä¿®æ”¹åŸæ•°ç»„// b: [2, 4, 6]ï¼Œè¿”å›æ–°æ•°ç»„ forEach arrayObject.forEach(function(currentValue, index, arrayObject) {}) æ•°ç»„çš„æ¯ä¸ªå…ƒç´ æ‰§è¡Œä¸€æ¬¡æä¾›çš„å‡½æ•°ã€‚ä¸€èˆ¬æ¥è¯´ä¸ä¿®æ”¹åŸæ•°ç»„ï¼Œä½†ä¹Ÿå¯ä»¥é€šè¿‡å¤„ç†å‡½æ•°ä¿®æ”¹åŸæ•°ç»„ã€‚è¯¥æ–¹æ³•å¾ˆçµæ´»ï¼Œå¯ç±»æ¯”for...ofã€‚ 123456var a = [1, 2, 3];var sum = 0;var b = a.forEach((curVal) =&gt; sum += curVal);// a: [1, 2, 3]ï¼Œä¸ä¿®æ”¹åŸæ•°ç»„// b: undefinedï¼ŒforEachä¸è¿”å›å€¼// sum: 6 find arrayObject.find(function(currentValue, index, arrayObject) {}) è¿”å›æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªæ»¡è¶³æµ‹è¯•æ¡ä»¶ï¼ˆè¿”å› true ï¼‰çš„å…ƒç´ ã€‚å¦‚æœä¸å­˜åœ¨è¿™æ ·çš„å…ƒç´ ï¼Œè¿”å›undefinedã€‚findIndexç±»ä¼¼ï¼Œåªä¸è¿‡è¿”å›çš„æ˜¯ç¬¬ä¸€ä¸ªæ»¡è¶³æµ‹è¯•æ¡ä»¶çš„å…ƒç´ çš„indexã€‚ 123456var a = [1, 2, 3];var b = a.find((curVal) =&gt; curVal === 1);var c = a.find((curVal) =&gt; curVal === 4);// a: [1, 2, 3]ï¼Œä¸ä¿®æ”¹åŸæ•°ç»„// b: 1// c: undefined filter arrayObject.filter(function(currentValue, index, arrayObject) {}) è¿”å›æ•°ç»„ä¸­æ‰€æœ‰æ»¡è¶³æµ‹è¯•æ¡ä»¶ï¼ˆè¿”å› true ï¼‰çš„å…ƒç´ ç»„æˆçš„æ•°ç»„ã€‚å¦‚æœä¸å­˜åœ¨è¿™æ ·çš„å…ƒç´ ï¼Œè¿”å›[]ã€‚ 123456var a = [1, 2, 3];var b = a.filter((curVal) =&gt; curVal &gt; 1);var c = a.filter((curVal) =&gt; curVal &gt; 3);// a: [1, 2, 3]ï¼Œä¸ä¿®æ”¹åŸæ•°ç»„// b: [2, 3]// c: [] reduce arrayObject.filter(function(previousValue, currentValue, currentIndex, arrayObject) {}, initialValue) æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºç´¯åŠ å™¨ï¼ˆaccumulatorï¼‰ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸ªå€¼ï¼ˆä»å·¦åˆ°å³ï¼‰å¼€å§‹ç¼©å‡ï¼Œæœ€ç»ˆä¸ºä¸€ä¸ªå€¼ã€‚ å¦‚æœæ²¡æœ‰ initialValue å‚æ•°, reduce ä» index ä¸º 1 å¼€å§‹æ‰§è¡Œå›è°ƒå‡½æ•°,è·³è¿‡ç¬¬ä¸€ä¸ª indexã€‚å¦‚æœæœ‰ initialValue å‚æ•°, reduce å°†ä» index ä¸º 0 å¼€å§‹æ‰§è¡Œå›è°ƒã€‚å¦‚æœæ•°ç»„æ˜¯ç©ºçš„å¹¶ä¸”æ²¡æœ‰ initialValue å‚æ•°,å°†ä¼šæŠ›å‡º TypeError é”™è¯¯ã€‚å¦‚æœæ•°ç»„åªæœ‰ä¸€ä¸ªå…ƒç´ å¹¶ä¸”æ²¡æœ‰åˆå§‹å€¼ initialValue ,æˆ–è€…æœ‰ initialValue ä½†æ•°ç»„æ˜¯ç©ºçš„, è¿™ä¸ªå”¯ä¸€çš„å€¼ç›´æ¥è¢«è¿”å›è€Œä¸ä¼šè°ƒç”¨å›è°ƒå‡½æ•°ã€‚ 1234var a = [1, 2, 3];var b = a.reduce((prevResult, curItem) =&gt; prevResult + curItem);// a: [1, 2, 3]ï¼Œä¸ä¿®æ”¹åŸæ•°ç»„// b: 6 é™¤äº† Array çš„popã€pushã€shiftã€unshiftã€spliceã€sortã€reverse è¿™ 7 ä¸ªæ–¹æ³•ä¼šä¿®æ”¹åŸæ•°ç»„ï¼Œå…¶ä»–æ–¹æ³•å‡ä¸ä¼šä¿®æ”¹åŸæ•°ç»„ã€‚ æŸ¥çœ‹åŸæ–‡","tags":[{"name":"javascript","slug":"javascript","permalink":"http://xyue.me/tags/javascript/"},{"name":"å¤‡å¿˜","slug":"å¤‡å¿˜","permalink":"http://xyue.me/tags/å¤‡å¿˜/"}]},{"title":"Git å¤‡å¿˜å½•","date":"2018-02-22T01:03:55.000Z","path":"2018/02/22/git-memo/","text":"Git çš„ä¸€äº›å¸¸ç”¨æ“ä½œå¤‡å¿˜ã€‚ é…ç½®å®‰è£…å¥½ Git ä¹‹åï¼Œé…ç½®ä½ çš„èµ„æ–™: 1234# é…ç½®ç”¨æˆ·ågit config --global user.name# é…ç½®é‚®ç®±åœ°å€git config --global user.email ç”Ÿæˆ SSH å¯†é’¥1ssh-keygen -C 'your@email.address' -t rsa åˆå§‹åŒ–é¡¹ç›®1234567# åˆå§‹åŒ– git é¡¹ç›®git init# æ·»åŠ ä¸€ä¸ªå« origin çš„æº# ä½¿ç”¨ ssh åœ°å€git remote add origin git@github.com:username/reponame.git# ä½¿ç”¨ username/password ç™»å½• https åœ°å€git remote add origin https://username@password:github.com/username/reponame.git æ¨é€åˆ°æœåŠ¡å™¨123456# è®°å½•æ‰€æœ‰æ–°å¢å’Œåˆ é™¤çš„æ–‡ä»¶git add -A# æäº¤git commit -m \"message\"# æ¨é€åˆ°æœåŠ¡å™¨ç«¯git push origin master æ›´æ–°åˆ°æœ¬åœ°12# æº + åˆ†æ”¯ågit pull origin master å…‹éš†é¡¹ç›®1234# å…‹éš†åˆ°ä»¥è¿™ä¸ªé¡¹ç›®åå‘½åçš„æ–‡ä»¶å¤¹git clone https://github.com/username/reponame.git# å…‹éš†åˆ°ä½ è‡ªå®šä¹‰çš„æ–‡ä»¶å¤¹git clone https://github.com/username/reponame.git name gh-pages12# å°† dist ç›®å½•æ¨é€åˆ° gh-pages åˆ†æ”¯git subtree push --prefix dist origin gh-pages To be continuedâ€¦","tags":[{"name":"git","slug":"git","permalink":"http://xyue.me/tags/git/"},{"name":"å¤‡å¿˜","slug":"å¤‡å¿˜","permalink":"http://xyue.me/tags/å¤‡å¿˜/"}]},{"title":"Material Design æ¶Ÿæ¼ªæ•ˆæœ","date":"2018-01-26T07:39:35.000Z","path":"2018/01/26/material-design-ripple-effect/","text":"è®¾è®¡æ€è·¯ç»“æ„åˆ†æ Material Design çš„ Button Ripple Effect ä¸éš¾å‘ç°ï¼Œæ¶Ÿæ¼ªçš„æ‰©æ•£æ˜¯åœ¨ Button çš„å†…éƒ¨è¿›è¡Œçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨è§¦å‘çš„æ—¶å€™å‘å…¶å†…éƒ¨åŠ å…¥spanï¼ˆè‡ªå®šä¹‰ï¼‰ã€‚ æ‰©æ•£åŠå¾„spanæ˜¯ä»¥åœ†å‘å››å‘¨æ‰©æ•£ï¼Œä¸ºå®Œå…¨æ‰©æ•£åˆ°buttonè¾¹ç¼˜ï¼Œspançš„ç›´å¾„åº”æ˜¯buttonå®½é«˜æœ€é•¿é‚£ä¸€è¾¹çš„ 2 å€ã€‚ æ‰©æ•£ä¸­å¿ƒç‚¹æ‰©æ•£æ˜¯ä»¥é¼ æ ‡ç‚¹å‡»ä¸ºä¸­å¿ƒï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è·å–åˆ°é¼ æ ‡ç‚¹å‡»ç›¸å¯¹buttonçš„ä½ç½®ï¼Œä½†è¿™è¿˜ä¸å¤Ÿï¼Œå› ä¸ºæ‰©æ•£æ˜¯ä»ä¸­å¿ƒå¼€å§‹çš„ï¼Œæ‰€ä»¥è¿˜è¦å‡å»spançš„åŠå¾„é•¿åº¦ï¼Œå¦‚ä¸‹å›¾ï¼š left = clentX - button.left - ç›´å¾„ / 2 top = clentX - button.top - ç›´å¾„ / 2 ç¤ºä¾‹ å®é™…åº”è¯¥åœ¨buttonå†…éƒ¨æ‰©å……ä¸€ä¸ªspanå¡«æ»¡æ•´ä¸ªbuttonï¼Œå†èµ‹äºˆè¿™ä¸ªspanæ·»åŠ æ¶Ÿæ¼ªçš„ç‚¹å‡»æ•ˆæœï¼Œè¿™æ ·buttonå°±ä¸ä¼šå› ä¸ºå¿…é¡»æ·»åŠ  position: relative;overflow: hidden; è€Œå½±å“å¸ƒå±€äº†ï¼Œå°ä¼™ä¼´èµ¶å¿«å»è¯•è¯•å§ï¼ğŸ˜‰ å‚è€ƒMaterial Design æ°´æ³¢çº¹ç‚¹æŒ‰æ•ˆæœ","tags":[{"name":"javascript","slug":"javascript","permalink":"http://xyue.me/tags/javascript/"},{"name":"css","slug":"css","permalink":"http://xyue.me/tags/css/"},{"name":"html","slug":"html","permalink":"http://xyue.me/tags/html/"}]},{"title":"CSS é»‘é­”æ³•å°æŠ€å·§ [ing...]","date":"2017-12-15T09:09:01.000Z","path":"2017/12/15/css-magic-skill/","text":"åˆ©ç”¨ content å±æ€§ attr æŠ“å–èµ„æ–™ é¼ æ ‡æ‚¬æµ®æç¤ºæ–‡å­—ï¼Œç±»ä¼¼ github çš„è¿™ç§ï¼Œå¦‚å›¾ï¼š ç›¸ä¿¡å¤§å®¶ç¬¬ä¸€æƒ³åˆ°çš„å°±æ˜¯ä¼ªå…ƒç´ â€”â€”afterã€beforeï¼Œåˆ©ç”¨ content æ¥æ˜¾ç¤ºä¸åŒçš„æç¤ºæ–‡å­—ï¼Œä½†ä¸åŒå…ƒç´ æç¤ºæ–‡å­—ä¸ä¸€å®šç›¸åŒã€‚åœ¨ä¸èƒ½ä½¿ç”¨ javascript çš„å‰ææ¡ä»¶ä¸‹ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•å»æ§åˆ¶ content çš„å†…å®¹å‘¢ï¼Ÿ åˆ©ç”¨ content å±æ€§attræŠ“å–èµ„æ–™ã€‚åœ¨ attr é‡Œé¢å†™å…¥ html ä¸­å±æ€§åç§°ï¼Œè¿™æ ·ä¼ªå…ƒç´  (:after) å°±èƒ½è·å–åˆ°è¯¥å±æ€§çš„å€¼ã€‚ 1&lt;div data-msg=\"Open this file in Github Desktop\"&gt;hover&lt;/div&gt; 123456789101112131415161718div&#123; width:50px; position:relative; cursor: pointer; &#125;div:hover:after&#123; content:attr(data-msg); position:absolute; left:0; top:25px; width:400%; text-align:center; font-size: 12px; line-height:30px; color: #fff; background: #1b1f23; border-radius: 3px;&#125; æ•ˆæœï¼Œå¦‚å›¾ï¼š é™¤æ­¤ä¹‹å¤–ï¼Œä½ è¿˜å¯ä»¥ç»“åˆå…¶ä»–é€‰æ‹©å™¨ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼šä½¿ç”¨å±æ€§é€‰æ‹©å™¨é€‰æ‹©ç©ºé“¾æ¥ æ˜¾ç¤ºæ²¡æœ‰æ–‡æœ¬å€¼ä½†æ˜¯hrefå±æ€§å…·æœ‰é“¾æ¥çš„aå…ƒç´ çš„é“¾æ¥ï¼š 123a[href^=\"http\"]:empty::before &#123; content: attr(href);&#125; tab åˆ‡æ¢å®ç° Tab åˆ‡æ¢çš„éš¾ç‚¹åœ¨äºå¦‚ä½•ä½¿ç”¨ CSS æ¥æ”¶åˆ°ç”¨æˆ·çš„ç‚¹å‡»äº‹æƒ…å¹¶å¯¹ç›¸å…³çš„èŠ‚ç‚¹è¿›è¡Œæ“ä½œã€‚å³ï¼š å¦‚ä½•æ¥æ”¶ç‚¹å‡»äº‹ä»¶ å¦‚ä½•æ“ä½œç›¸å…³DOM è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨:targetä¼ªç±»æ¥æ”¶ç‚¹å‡»äº‹ä»¶ã€‚ URL å¸¦æœ‰åé¢è·Ÿæœ‰é”šåç§° #ï¼ŒæŒ‡å‘æ–‡æ¡£å†…æŸä¸ªå…·ä½“çš„å…ƒç´ ã€‚è¿™ä¸ªè¢«é“¾æ¥çš„å…ƒç´ å°±æ˜¯ç›®æ ‡å…ƒç´ (target element)ã€‚:targeté€‰æ‹©å™¨å¯ç”¨äºé€‰å–å½“å‰æ´»åŠ¨çš„ç›®æ ‡å…ƒç´ ã€‚ åœ¨ :target è§¦å‘çš„æ—¶å€™åˆ†åˆ«å»æ“ä½œç›¸å…³ DOMã€‚ 123456&lt;ul class=\"nav\"&gt; &lt;li&gt;&lt;a href=\"#tab1\"&gt;tab1&lt;/a&gt;&lt;/li&gt; &lt;li&gt;&lt;a href=\"#tab2\"&gt;tab2&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;div id=\"tab1\"&gt;111111111111&lt;/div&gt;&lt;div id=\"tab2\"&gt;222222222222&lt;/div&gt; 123456#tab1,#tab2&#123; display: none;&#125;#tab1:target,#tab2:target&#123; display: block;&#125; è‡³æ­¤ï¼Œä¸¤ä¸ªé—®é¢˜éƒ½å·²ç»è§£å†³ï¼Œå‰©ä¸‹çš„å°±æ˜¯ä¸€äº›æ ·å¼çš„ä¿®è¡¥å·¥ä½œã€‚ è‡ªå®šä¹‰æ–‡å­—ä¸‹åˆ’çº¿ä½¿ç”¨linear-gradientå®šä¹‰ä¸‹åˆ’çº¿ 12&lt;span class=\"wave\"&gt;å—æœˆå‡¡æ­†&lt;/span&gt;&lt;span class=\"dashed\"&gt;å—æœˆå‡¡æ­†&lt;/span&gt; 1234567891011121314151617181920212223242526span&#123; position: relative; display: inline-block;&#125;span:after&#123; content: ''; display: block; position: absolute; top: 110%; width: 100%; height: 3px;&#125;/** * æ³¢æµªçº¿ï¼Œæ¸å˜æ„é€ 'X'ï¼Œæˆªå–ä¸ŠåŠéƒ¨åˆ†ï¼Œå¾—åˆ°ä¸€ä¸ª'V',ä»è€Œç»“åˆ repeat å½¢æˆæ³¢æµªçº¿ */span.wave:after &#123; background: linear-gradient(135deg, transparent, transparent 45%, red, transparent 55%, transparent 100%), linear-gradient(45deg, transparent, transparent 45%, red, transparent 55%, transparent 100%); background-size: 6px 6px;&#125;span.dashed:after &#123; background: linear-gradient(90deg,#03A9F4 50%,transparent 0); background-size: 6px 6px;&#125; åˆ©ç”¨ pointer-events ç¦ç”¨äº‹ä»¶æ•ˆæœpointer-eventsï¼šå­—é¢ç†è§£æ˜¯é¼ æ ‡äº‹ä»¶ã€‚ å½“ä½¿ç”¨ pointer-events:none æ—¶ï¼Œè¡¨ç¤ºå®ƒå°†æ•è·ä¸åˆ°ä»»ä½•äº‹ä»¶ï¼Œè€Œåªæ˜¯è®©äº‹ä»¶ç©¿é€åˆ°å®ƒçš„ä¸‹é¢ã€‚ åœºæ™¯ï¼šåœ¨åštabåˆ‡æ¢çš„æ—¶å€™ï¼Œå½“é€‰ä¸­å½“å‰é¡¹ï¼Œç¦ç”¨å½“å‰æ ‡ç­¾çš„äº‹ä»¶ï¼Œåªæœ‰åˆ‡æ¢å…¶ä»–tabçš„æ—¶å€™ï¼Œæ‰é‡æ–°è¯·æ±‚æ–°çš„æ•°æ®ã€‚ 1234567891011&lt;ul&gt; &lt;li&gt; &lt;a class=\"tab active\" href=\"https://google.com\"&gt;google&lt;/a&gt; &lt;/li&gt; &lt;li&gt; &lt;a class=\"tab\" href=\"https://facebook.com\"&gt;facebook&lt;/a&gt; &lt;/li&gt; &lt;li&gt; &lt;a class=\"tab\" href=\"https://stackoverflow.com\"&gt;stackoverflow&lt;/a&gt; &lt;/li&gt;&lt;/ul&gt; 123.active&#123; pointer-events: none;&#125; é€‚åˆ pointer-events çš„åœºæ™¯æœ‰å¾ˆå¤šã€‚ç¦ç”¨äº‹ä»¶ï¼›ä½œä¸ºè¦†ç›–ç‰©ä¸å½±å“ä¸‹å±‚æ“ä½œï¼Œé‡åˆ°è¿™ç±»æƒ…å†µéƒ½å¯ä»¥è€ƒè™‘å–²ã€‚ rem å¸ƒå±€ç§»åŠ¨ç«¯ç”¨ rem å¸ƒå±€æ—¶å€™ï¼Œæ ¹æ®ä¸åŒçš„å±å¹•å®½åº¦è¦è®¾ç½®ä¸åŒçš„ font-size æ¥åšåˆ°é€‚é…ã€‚ ä¾‹å¦‚ï¼šä»¥750pxè®¾è®¡ç¨¿ä½œä¸ºåŸºå‡†ï¼Œæ ¹èŠ‚ç‚¹è®¾ç½® font-size ä¸º 100pxï¼Œåªè€ƒè™‘ DPR ä¸º 2 çš„æœ€ç®€æƒ…å†µã€‚ 1document.querySelector('html').style.fontSize = `$&#123;window.innerWidth / 7.5 &#125;px`; ç­‰åŒä¸ 123html&#123;font-size: calc(100vw / 7.5)&#125; ä¸‰è§’å½¢åœ¨ä¸ä½¿ç”¨å›¾ç‰‡çš„æƒ…å†µï¼Œå®ç°ä¸€ä¸ªç®€å•çš„ä¸‰è§’å½¢ç®­å¤´ 1&lt;div id=\"triangle-top\"&gt;&lt;/div&gt; 1234567#triangle-top &#123; width: 0; height: 0; border-left: 30px solid transparent; border-right: 30px solid transparent; border-bottom: 60px solid red;&#125; æ–‡æœ¬æº¢å‡ºçœç•¥æœ‰æ—¶æˆ‘ä»¬ä¼šé‡åˆ°è¿™æ ·çš„éœ€æ±‚ï¼Œå°†ä¸€æ®µæ–‡å­—å•è¡Œï¼Œæˆ–è€…å¤šè¡Œæ˜¾ç¤ºï¼Œè¶…å‡ºçš„éƒ¨åˆ†ç”¨çœç•¥å·ä»£æ›¿ã€‚ç›¸ä¿¡å¾ˆå¤šåŒå­¦éƒ½æ›¾ç”¨ javascript æˆªå–å­—ç¬¦ä¸²æ‹¼æ¥çœç•¥å·ä»¥è¾¾åˆ°è¿™æ ·çš„æ•ˆæœï¼Œä½†ç”±äºæ¯ä¸ªå­—å®é™…è¡¨ç°å®½åº¦çš„ä¸ä¸€è‡´ï¼Œå¾€å¾€éœ€è¦å»å•ç‹¬çš„æ§åˆ¶æˆªå–é•¿åº¦ã€‚ ä½†å…¶å®ï¼Œç”¨ css å°±èƒ½å®Œç¾çš„è§£å†³ã€‚ 1&lt;div&gt;å€Ÿä¸€ç›åˆå¤œè¡—å¤´ æ˜é»„ç¯å…‰ ç…§äº®é‚£åå·è·¯ä¸Šäººå½±ä¸€åŒ å€Ÿä¸€å¯¸ä¸‰ä¹å¤©é‡Œ å†½å†½æš–é˜³ èè¿™èŒ«èŒ«äººé—´åˆºéª¨å‡‰&lt;/div&gt; å•è¡Œæ–‡æœ¬123456div&#123; width: 300px; overflow : hidden; text-overflow: ellipsis; white-space: nowrap;&#125; å¤šè¡Œæ–‡æœ¬12345678div&#123; width: 300px; overflow : hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;&#125;","tags":[{"name":"css","slug":"css","permalink":"http://xyue.me/tags/css/"}]},{"title":"æ·±åº¦å‰–æï¼šå¦‚ä½•å®ç°ä¸€ä¸ª Virtual DOM ç®—æ³•","date":"2017-12-08T06:45:15.000Z","path":"2017/12/08/virtual-dom/","text":"è½½è‡ª ã€Šæ·±åº¦å‰–æï¼šå¦‚ä½•å®ç°ä¸€ä¸ª Virtual DOM ç®—æ³•ã€‹ â€”â€” Livoras å‰è¨€æœ¬æ–‡ä¼šåœ¨æ•™ä½ æ€ä¹ˆç”¨ 300~400 è¡Œä»£ç å®ç°ä¸€ä¸ªåŸºæœ¬çš„ Virtual DOM ç®—æ³•ï¼Œå¹¶ä¸”å°è¯•å°½é‡æŠŠ Virtual DOM çš„ç®—æ³•æ€è·¯é˜è¿°æ¸…æ¥šã€‚å¸Œæœ›åœ¨é˜…è¯»æœ¬æ–‡åï¼Œèƒ½è®©ä½ æ·±å…¥ç†è§£ Virtual DOM ç®—æ³•ï¼Œç»™ä½ ç°æœ‰å‰ç«¯çš„ç¼–ç¨‹æä¾›ä¸€äº›æ–°çš„æ€è€ƒã€‚ æœ¬æ–‡æ‰€å®ç°çš„å®Œæ•´ä»£ç å­˜æ”¾åœ¨ Githubã€‚ å¯¹å‰ç«¯åº”ç”¨çŠ¶æ€ç®¡ç†çš„æ€è€ƒå‡å¦‚ç°åœ¨ä½ éœ€è¦å†™ä¸€ä¸ªåƒä¸‹é¢ä¸€æ ·çš„è¡¨æ ¼çš„åº”ç”¨ç¨‹åºï¼Œè¿™ä¸ªè¡¨æ ¼å¯ä»¥æ ¹æ®ä¸åŒçš„å­—æ®µè¿›è¡Œå‡åºæˆ–è€…é™åºçš„å±•ç¤ºã€‚ sort-table.png è¿™ä¸ªåº”ç”¨ç¨‹åºçœ‹èµ·æ¥å¾ˆç®€å•ï¼Œä½ å¯ä»¥æƒ³å‡ºå¥½å‡ ç§ä¸åŒçš„æ–¹å¼æ¥å†™ã€‚æœ€å®¹æ˜“æƒ³åˆ°çš„å¯èƒ½æ˜¯ï¼Œåœ¨ä½ çš„ JavaScript ä»£ç é‡Œé¢å­˜å‚¨è¿™æ ·çš„æ•°æ®ï¼š 123var sortKey = \"new\" // æ’åºçš„å­—æ®µï¼Œæ–°å¢ï¼ˆnewï¼‰ã€å–æ¶ˆï¼ˆcancelï¼‰ã€å‡€å…³æ³¨ï¼ˆgainï¼‰ã€ç´¯ç§¯ï¼ˆcumulateï¼‰äººæ•°var sortType = 1 // å‡åºè¿˜æ˜¯é€†åºvar data = [&#123;...&#125;, &#123;...&#125;, &#123;..&#125;, ..] // è¡¨æ ¼æ•°æ® ç”¨ä¸‰ä¸ªå­—æ®µåˆ†åˆ«å­˜å‚¨å½“å‰æ’åºçš„å­—æ®µã€æ’åºæ–¹å‘ã€è¿˜æœ‰è¡¨æ ¼æ•°æ®ï¼›ç„¶åç»™è¡¨æ ¼å¤´éƒ¨åŠ ç‚¹å‡»äº‹ä»¶ï¼šå½“ç”¨æˆ·ç‚¹å‡»ç‰¹å®šçš„å­—æ®µçš„æ—¶å€™ï¼Œæ ¹æ®ä¸Šé¢å‡ ä¸ªå­—æ®µå­˜å‚¨çš„å†…å®¹æ¥å¯¹å†…å®¹è¿›è¡Œæ’åºï¼Œç„¶åç”¨ JS æˆ–è€… jQuery æ“ä½œ DOMï¼Œæ›´æ–°é¡µé¢çš„æ’åºçŠ¶æ€ï¼ˆè¡¨å¤´çš„é‚£å‡ ä¸ªç®­å¤´è¡¨ç¤ºå½“å‰æ’åºçŠ¶æ€ï¼Œä¹Ÿéœ€è¦æ›´æ–°ï¼‰å’Œè¡¨æ ¼å†…å®¹ã€‚ è¿™æ ·åšä¼šå¯¼è‡´çš„åæœå°±æ˜¯ï¼Œéšç€åº”ç”¨ç¨‹åºè¶Šæ¥è¶Šå¤æ‚ï¼Œéœ€è¦åœ¨ JS é‡Œé¢ç»´æŠ¤çš„å­—æ®µä¹Ÿè¶Šæ¥è¶Šå¤šï¼Œéœ€è¦ç›‘å¬äº‹ä»¶å’Œåœ¨äº‹ä»¶å›è°ƒç”¨æ›´æ–°é¡µé¢çš„ DOM æ“ä½œä¹Ÿè¶Šæ¥è¶Šå¤šï¼Œåº”ç”¨ç¨‹åºä¼šå˜å¾—éå¸¸éš¾ç»´æŠ¤ã€‚åæ¥äººä»¬ä½¿ç”¨äº† MVCã€MVP çš„æ¶æ„æ¨¡å¼ï¼Œå¸Œæœ›èƒ½ä»ä»£ç ç»„ç»‡æ–¹å¼æ¥é™ä½ç»´æŠ¤è¿™ç§å¤æ‚åº”ç”¨ç¨‹åºçš„éš¾åº¦ã€‚ä½†æ˜¯ MVC æ¶æ„æ²¡åŠæ³•å‡å°‘ä½ æ‰€ç»´æŠ¤çš„çŠ¶æ€ï¼Œä¹Ÿæ²¡æœ‰é™ä½çŠ¶æ€æ›´æ–°ä½ éœ€è¦å¯¹é¡µé¢çš„æ›´æ–°æ“ä½œï¼ˆå‰ç«¯æ¥è¯´å°±æ˜¯ DOM æ“ä½œï¼‰ï¼Œä½ éœ€è¦æ“ä½œçš„ DOM è¿˜æ˜¯éœ€è¦æ“ä½œï¼Œåªæ˜¯æ¢äº†ä¸ªåœ°æ–¹ã€‚ æ—¢ç„¶çŠ¶æ€æ”¹å˜äº†è¦æ“ä½œç›¸åº”çš„DOMå…ƒç´ ï¼Œä¸ºä»€ä¹ˆä¸åšä¸€ä¸ªä¸œè¥¿å¯ä»¥è®©è§†å›¾å’ŒçŠ¶æ€è¿›è¡Œç»‘å®šï¼ŒçŠ¶æ€å˜æ›´äº†è§†å›¾è‡ªåŠ¨å˜æ›´ï¼Œå°±ä¸ç”¨æ‰‹åŠ¨æ›´æ–°é¡µé¢äº†ã€‚è¿™å°±æ˜¯åæ¥äººä»¬æƒ³å‡ºäº† MVVM æ¨¡å¼ï¼Œåªè¦åœ¨æ¨¡ç‰ˆä¸­å£°æ˜è§†å›¾ç»„ä»¶æ˜¯å’Œä»€ä¹ˆçŠ¶æ€è¿›è¡Œç»‘å®šçš„ï¼ŒåŒå‘ç»‘å®šå¼•æ“å°±ä¼šåœ¨çŠ¶æ€æ›´æ–°çš„æ—¶å€™è‡ªåŠ¨æ›´æ–°è§†å›¾ï¼ˆå…³äºMV*æ¨¡å¼çš„å†…å®¹ï¼Œå¯ä»¥çœ‹è¿™ç¯‡ä»‹ç»ï¼‰ã€‚ MVVM å¯ä»¥å¾ˆå¥½çš„é™ä½æˆ‘ä»¬ç»´æŠ¤çŠ¶æ€ -&gt; è§†å›¾çš„å¤æ‚ç¨‹åº¦ï¼ˆå¤§å¤§å‡å°‘ä»£ç ä¸­çš„è§†å›¾æ›´æ–°é€»è¾‘ï¼‰ã€‚ä½†æ˜¯è¿™ä¸æ˜¯å”¯ä¸€çš„åŠæ³•ï¼Œè¿˜æœ‰ä¸€ä¸ªéå¸¸ç›´è§‚çš„æ–¹æ³•ï¼Œå¯ä»¥å¤§å¤§é™ä½è§†å›¾æ›´æ–°çš„æ“ä½œï¼šä¸€æ—¦çŠ¶æ€å‘ç”Ÿäº†å˜åŒ–ï¼Œå°±ç”¨æ¨¡ç‰ˆå¼•æ“é‡æ–°æ¸²æŸ“æ•´ä¸ªè§†å›¾ï¼Œç„¶åç”¨æ–°çš„è§†å›¾æ›´æ¢æ‰æ—§çš„è§†å›¾ã€‚å°±åƒä¸Šé¢çš„è¡¨æ ¼ï¼Œå½“ç”¨æˆ·ç‚¹å‡»çš„æ—¶å€™ï¼Œè¿˜æ˜¯åœ¨ JS é‡Œé¢æ›´æ–°çŠ¶æ€ï¼Œä½†æ˜¯é¡µé¢æ›´æ–°å°±ä¸ç”¨æ‰‹åŠ¨æ“ä½œ DOM äº†ï¼Œç›´æ¥æŠŠæ•´ä¸ªè¡¨æ ¼ç”¨æ¨¡ç‰ˆå¼•æ“é‡æ–°æ¸²æŸ“ä¸€éï¼Œç„¶åè®¾ç½®ä¸€ä¸‹innerHTMLå°±å®Œäº‹äº†ã€‚ å¬åˆ°è¿™æ ·çš„åšæ³•ï¼Œç»éªŒä¸°å¯Œçš„ä½ ä¸€å®šç¬¬ä¸€æ—¶é—´æ„è¯†è¿™æ ·çš„åšæ³•ä¼šå¯¼è‡´å¾ˆå¤šçš„é—®é¢˜ã€‚æœ€å¤§çš„é—®é¢˜å°±æ˜¯è¿™æ ·åšä¼šå¾ˆæ…¢ï¼Œå› ä¸ºå³ä½¿ä¸€ä¸ªå°å°çš„çŠ¶æ€å˜æ›´éƒ½è¦é‡æ–°æ„é€ æ•´æ£µ DOMï¼Œæ€§ä»·æ¯”å¤ªä½ï¼›è€Œä¸”è¿™æ ·åšçš„è¯ï¼Œinputå’Œtextareaçš„ä¼šå¤±å»åŸæœ‰çš„ç„¦ç‚¹ã€‚æœ€åçš„ç»“è®ºä¼šæ˜¯ï¼šå¯¹äºå±€éƒ¨çš„å°è§†å›¾çš„æ›´æ–°ï¼Œæ²¡æœ‰é—®é¢˜ï¼ˆ Backbone å°±æ˜¯è¿™ä¹ˆå¹²çš„ï¼‰ï¼›ä½†æ˜¯å¯¹äºå¤§å‹è§†å›¾ï¼Œå¦‚å…¨å±€åº”ç”¨çŠ¶æ€å˜æ›´çš„æ—¶å€™ï¼Œéœ€è¦æ›´æ–°é¡µé¢è¾ƒå¤šå±€éƒ¨è§†å›¾çš„æ—¶å€™ï¼Œè¿™æ ·çš„åšæ³•ä¸å¯å–ã€‚ ä½†æ˜¯è¿™é‡Œè¦æ˜ç™½å’Œè®°ä½è¿™ç§åšæ³•ï¼Œå› ä¸ºåé¢ä½ ä¼šå‘ç°ï¼Œå…¶å® Virtual DOM å°±æ˜¯è¿™ä¹ˆåšçš„ï¼Œåªæ˜¯åŠ äº†ä¸€äº›ç‰¹åˆ«çš„æ­¥éª¤æ¥é¿å…äº†æ•´æ£µ DOM æ ‘å˜æ›´ã€‚ å¦å¤–ä¸€ç‚¹éœ€è¦æ³¨æ„çš„å°±æ˜¯ï¼Œä¸Šé¢æä¾›çš„å‡ ç§æ–¹æ³•ï¼Œå…¶å®éƒ½åœ¨è§£å†³åŒä¸€ä¸ªé—®é¢˜ï¼šç»´æŠ¤çŠ¶æ€ï¼Œæ›´æ–°è§†å›¾ã€‚åœ¨ä¸€èˆ¬çš„åº”ç”¨å½“ä¸­ï¼Œå¦‚æœèƒ½å¤Ÿå¾ˆå¥½æ–¹æ¡ˆæ¥åº”å¯¹è¿™ä¸ªé—®é¢˜ï¼Œé‚£ä¹ˆå°±å‡ ä¹é™ä½äº†å¤§éƒ¨åˆ†å¤æ‚æ€§ã€‚ Virtual DOMç®—æ³•DOMæ˜¯å¾ˆæ…¢çš„ã€‚å¦‚æœæˆ‘ä»¬æŠŠä¸€ä¸ªç®€å•çš„divå…ƒç´ çš„å±æ€§éƒ½æ‰“å°å‡ºæ¥ï¼Œä½ ä¼šçœ‹åˆ°ï¼š dom-attributes è€Œè¿™ä»…ä»…æ˜¯ç¬¬ä¸€å±‚ã€‚çœŸæ­£çš„ DOM å…ƒç´ éå¸¸åºå¤§ï¼Œè¿™æ˜¯å› ä¸ºæ ‡å‡†å°±æ˜¯è¿™ä¹ˆè®¾è®¡çš„ã€‚è€Œä¸”æ“ä½œå®ƒä»¬çš„æ—¶å€™ä½ è¦å°å¿ƒç¿¼ç¿¼ï¼Œè½»å¾®çš„è§¦ç¢°å¯èƒ½å°±ä¼šå¯¼è‡´é¡µé¢é‡æ’ï¼Œè¿™å¯æ˜¯æ€æ­»æ€§èƒ½çš„ç½ªé­ç¥¸é¦–ã€‚ ç›¸å¯¹äº DOM å¯¹è±¡ï¼ŒåŸç”Ÿçš„ JavaScript å¯¹è±¡å¤„ç†èµ·æ¥æ›´å¿«ï¼Œè€Œä¸”æ›´ç®€å•ã€‚DOM æ ‘ä¸Šçš„ç»“æ„ã€å±æ€§ä¿¡æ¯æˆ‘ä»¬éƒ½å¯ä»¥å¾ˆå®¹æ˜“åœ°ç”¨ JavaScript å¯¹è±¡è¡¨ç¤ºå‡ºæ¥ï¼š 1234567891011var element = &#123; tagName: 'ul', // èŠ‚ç‚¹æ ‡ç­¾å props: &#123; // DOMçš„å±æ€§ï¼Œç”¨ä¸€ä¸ªå¯¹è±¡å­˜å‚¨é”®å€¼å¯¹ id: 'list' &#125;, children: [ // è¯¥èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ &#123;tagName: 'li', props: &#123;class: 'item'&#125;, children: [\"Item 1\"]&#125;, &#123;tagName: 'li', props: &#123;class: 'item'&#125;, children: [\"Item 2\"]&#125;, &#123;tagName: 'li', props: &#123;class: 'item'&#125;, children: [\"Item 3\"]&#125;, ]&#125; ä¸Šé¢å¯¹åº”çš„HTMLå†™æ³•æ˜¯ï¼š 12345&lt;ul id='list'&gt; &lt;li class='item'&gt;Item 1&lt;/li&gt; &lt;li class='item'&gt;Item 2&lt;/li&gt; &lt;li class='item'&gt;Item 3&lt;/li&gt;&lt;/ul&gt; æ—¢ç„¶åŸæ¥ DOM æ ‘çš„ä¿¡æ¯éƒ½å¯ä»¥ç”¨ JavaScript å¯¹è±¡æ¥è¡¨ç¤ºï¼Œåè¿‡æ¥ï¼Œä½ å°±å¯ä»¥æ ¹æ®è¿™ä¸ªç”¨ JavaScript å¯¹è±¡è¡¨ç¤ºçš„æ ‘ç»“æ„æ¥æ„å»ºä¸€æ£µçœŸæ­£çš„ DOM æ ‘ã€‚ ä¹‹å‰çš„ç« èŠ‚æ‰€è¯´çš„ï¼ŒçŠ¶æ€å˜æ›´-&gt;é‡æ–°æ¸²æŸ“æ•´ä¸ªè§†å›¾çš„æ–¹å¼å¯ä»¥ç¨å¾®ä¿®æ”¹ä¸€ä¸‹ï¼šç”¨ JavaScript å¯¹è±¡è¡¨ç¤º DOM ä¿¡æ¯å’Œç»“æ„ï¼Œå½“çŠ¶æ€å˜æ›´çš„æ—¶å€™ï¼Œé‡æ–°æ¸²æŸ“è¿™ä¸ª JavaScript çš„å¯¹è±¡ç»“æ„ã€‚å½“ç„¶è¿™æ ·åšå…¶å®æ²¡ä»€ä¹ˆåµç”¨ï¼Œå› ä¸ºçœŸæ­£çš„é¡µé¢å…¶å®æ²¡æœ‰æ”¹å˜ã€‚ ä½†æ˜¯å¯ä»¥ç”¨æ–°æ¸²æŸ“çš„å¯¹è±¡æ ‘å»å’Œæ—§çš„æ ‘è¿›è¡Œå¯¹æ¯”ï¼Œè®°å½•è¿™ä¸¤æ£µæ ‘å·®å¼‚ã€‚è®°å½•ä¸‹æ¥çš„ä¸åŒå°±æ˜¯æˆ‘ä»¬éœ€è¦å¯¹é¡µé¢çœŸæ­£çš„ DOM æ“ä½œï¼Œç„¶åæŠŠå®ƒä»¬åº”ç”¨åœ¨çœŸæ­£çš„ DOM æ ‘ä¸Šï¼Œé¡µé¢å°±å˜æ›´äº†ã€‚è¿™æ ·å°±å¯ä»¥åšåˆ°ï¼šè§†å›¾çš„ç»“æ„ç¡®å®æ˜¯æ•´ä¸ªå…¨æ–°æ¸²æŸ“äº†ï¼Œä½†æ˜¯æœ€åæ“ä½œDOMçš„æ—¶å€™ç¡®å®åªå˜æ›´æœ‰ä¸åŒçš„åœ°æ–¹ã€‚ è¿™å°±æ˜¯æ‰€è°“çš„ Virtual DOM ç®—æ³•ã€‚åŒ…æ‹¬å‡ ä¸ªæ­¥éª¤ï¼š ç”¨ JavaScript å¯¹è±¡ç»“æ„è¡¨ç¤º DOM æ ‘çš„ç»“æ„ï¼›ç„¶åç”¨è¿™ä¸ªæ ‘æ„å»ºä¸€ä¸ªçœŸæ­£çš„ DOM æ ‘ï¼Œæ’åˆ°æ–‡æ¡£å½“ä¸­ å½“çŠ¶æ€å˜æ›´çš„æ—¶å€™ï¼Œé‡æ–°æ„é€ ä¸€æ£µæ–°çš„å¯¹è±¡æ ‘ã€‚ç„¶åç”¨æ–°çš„æ ‘å’Œæ—§çš„æ ‘è¿›è¡Œæ¯”è¾ƒï¼Œè®°å½•ä¸¤æ£µæ ‘å·®å¼‚ æŠŠ2æ‰€è®°å½•çš„å·®å¼‚åº”ç”¨åˆ°æ­¥éª¤1æ‰€æ„å»ºçš„çœŸæ­£çš„ DOM æ ‘ä¸Šï¼Œè§†å›¾å°±æ›´æ–°äº† Virtual DOM æœ¬è´¨ä¸Šå°±æ˜¯åœ¨ JS å’Œ DOM ä¹‹é—´åšäº†ä¸€ä¸ªç¼“å­˜ã€‚å¯ä»¥ç±»æ¯” CPU å’Œç¡¬ç›˜ï¼Œæ—¢ç„¶ç¡¬ç›˜è¿™ä¹ˆæ…¢ï¼Œæˆ‘ä»¬å°±åœ¨å®ƒä»¬ä¹‹é—´åŠ ä¸ªç¼“å­˜ï¼šæ—¢ç„¶ DOM è¿™ä¹ˆæ…¢ï¼Œæˆ‘ä»¬å°±åœ¨å®ƒä»¬ JS å’Œ DOM ä¹‹é—´åŠ ä¸ªç¼“å­˜ã€‚CPUï¼ˆJSï¼‰åªæ“ä½œå†…å­˜ï¼ˆVirtual DOMï¼‰ï¼Œæœ€åçš„æ—¶å€™å†æŠŠå˜æ›´å†™å…¥ç¡¬ç›˜ï¼ˆDOMï¼‰ã€‚ ç®—æ³•å®ç°æ­¥éª¤ä¸€ï¼šç”¨JSå¯¹è±¡æ¨¡æ‹ŸDOMæ ‘ç”¨ JavaScript æ¥è¡¨ç¤ºä¸€ä¸ª DOM èŠ‚ç‚¹æ˜¯å¾ˆç®€å•çš„äº‹æƒ…ï¼Œä½ åªéœ€è¦è®°å½•å®ƒçš„èŠ‚ç‚¹ç±»å‹ã€å±æ€§ï¼Œè¿˜æœ‰å­èŠ‚ç‚¹ï¼š element.js 123456789function Element (tagName, props, children) &#123; this.tagName = tagName this.props = props this.children = children&#125;module.exports = function (tagName, props, children) &#123; return new Element(tagName, props, children)&#125; ä¾‹å¦‚ä¸Šé¢çš„ DOM ç»“æ„å°±å¯ä»¥ç®€å•çš„è¡¨ç¤ºï¼š 1234567var el = require('./element')var ul = el('ul', &#123;id: 'list'&#125;, [ el('li', &#123;class: 'item'&#125;, ['Item 1']), el('li', &#123;class: 'item'&#125;, ['Item 2']), el('li', &#123;class: 'item'&#125;, ['Item 3'])]) ç°åœ¨ulåªæ˜¯ä¸€ä¸ª JavaScript å¯¹è±¡è¡¨ç¤ºçš„ DOM ç»“æ„ï¼Œé¡µé¢ä¸Šå¹¶æ²¡æœ‰è¿™ä¸ªç»“æ„ã€‚æˆ‘ä»¬å¯ä»¥æ ¹æ®è¿™ä¸ªulæ„å»ºçœŸæ­£çš„&lt;ul&gt;ï¼š 1234567891011121314151617181920Element.prototype.render = function () &#123; var el = document.createElement(this.tagName) // æ ¹æ®tagNameæ„å»º var props = this.props for (var propName in props) &#123; // è®¾ç½®èŠ‚ç‚¹çš„DOMå±æ€§ var propValue = props[propName] el.setAttribute(propName, propValue) &#125; var children = this.children || [] children.forEach(function (child) &#123; var childEl = (child instanceof Element) ? child.render() // å¦‚æœå­èŠ‚ç‚¹ä¹Ÿæ˜¯è™šæ‹ŸDOMï¼Œé€’å½’æ„å»ºDOMèŠ‚ç‚¹ : document.createTextNode(child) // å¦‚æœå­—ç¬¦ä¸²ï¼Œåªæ„å»ºæ–‡æœ¬èŠ‚ç‚¹ el.appendChild(childEl) &#125;) return el&#125; renderæ–¹æ³•ä¼šæ ¹æ®tagNameæ„å»ºä¸€ä¸ªçœŸæ­£çš„ DOM èŠ‚ç‚¹ï¼Œç„¶åè®¾ç½®è¿™ä¸ªèŠ‚ç‚¹çš„å±æ€§ï¼Œæœ€åé€’å½’åœ°æŠŠè‡ªå·±çš„å­èŠ‚ç‚¹ä¹Ÿæ„å»ºèµ·æ¥ã€‚æ‰€ä»¥åªéœ€è¦ï¼š 12var ulRoot = ul.render()document.body.appendChild(ulRoot) ä¸Šé¢çš„ulRootæ˜¯çœŸæ­£çš„ DOM èŠ‚ç‚¹ï¼ŒæŠŠå®ƒå¡å…¥æ–‡æ¡£ä¸­ï¼Œè¿™æ ·bodyé‡Œé¢å°±æœ‰äº†çœŸæ­£çš„&lt;ul&gt; çš„DOMç»“æ„ï¼š 12345&lt;ul id='list'&gt; &lt;li class='item'&gt;Item 1&lt;/li&gt; &lt;li class='item'&gt;Item 2&lt;/li&gt; &lt;li class='item'&gt;Item 3&lt;/li&gt;&lt;/ul&gt; å®Œæ•´ä»£ç å¯è§ element.jsã€‚ æ­¥éª¤äºŒï¼šæ¯”è¾ƒä¸¤æ£µè™šæ‹ŸDOMæ ‘çš„å·®å¼‚æ­£å¦‚ä½ æ‰€é¢„æ–™çš„ï¼Œæ¯”è¾ƒä¸¤æ£µDOMæ ‘çš„å·®å¼‚æ˜¯ Virtual DOM ç®—æ³•æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œè¿™ä¹Ÿæ˜¯æ‰€è°“çš„ Virtual DOM çš„ diff ç®—æ³•ã€‚ä¸¤ä¸ªæ ‘çš„å®Œå…¨çš„ diff ç®—æ³•æ˜¯ä¸€ä¸ªæ—¶é—´å¤æ‚åº¦ä¸º O(n^3) çš„é—®é¢˜ã€‚ä½†æ˜¯åœ¨å‰ç«¯å½“ä¸­ï¼Œä½ å¾ˆå°‘ä¼šè·¨è¶Šå±‚çº§åœ°ç§»åŠ¨ DOM å…ƒç´ ã€‚æ‰€ä»¥ Virtual DOM åªä¼šå¯¹åŒä¸€ä¸ªå±‚çº§çš„å…ƒç´ è¿›è¡Œå¯¹æ¯”ï¼š compare-in-level ä¸Šé¢çš„divåªä¼šå’ŒåŒä¸€å±‚çº§çš„divå¯¹æ¯”ï¼Œç¬¬äºŒå±‚çº§çš„åªä¼šè·Ÿç¬¬äºŒå±‚çº§å¯¹æ¯”ã€‚è¿™æ ·ç®—æ³•å¤æ‚åº¦å°±å¯ä»¥è¾¾åˆ° O(n)ã€‚ æ·±åº¦ä¼˜å…ˆéå†ï¼Œè®°å½•å·®å¼‚åœ¨å®é™…çš„ä»£ç ä¸­ï¼Œä¼šå¯¹æ–°æ—§ä¸¤æ£µæ ‘è¿›è¡Œä¸€ä¸ªæ·±åº¦ä¼˜å…ˆçš„éå†ï¼Œè¿™æ ·æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šæœ‰ä¸€ä¸ªå”¯ä¸€çš„æ ‡è®°ï¼š dfs-walk åœ¨æ·±åº¦ä¼˜å…ˆéå†çš„æ—¶å€™ï¼Œæ¯éå†åˆ°ä¸€ä¸ªèŠ‚ç‚¹å°±æŠŠè¯¥èŠ‚ç‚¹å’Œæ–°çš„çš„æ ‘è¿›è¡Œå¯¹æ¯”ã€‚å¦‚æœæœ‰å·®å¼‚çš„è¯å°±è®°å½•åˆ°ä¸€ä¸ªå¯¹è±¡é‡Œé¢ã€‚ 1234567891011121314151617181920212223242526272829// diff å‡½æ•°ï¼Œå¯¹æ¯”ä¸¤æ£µæ ‘function diff (oldTree, newTree) &#123; var index = 0 // å½“å‰èŠ‚ç‚¹çš„æ ‡å¿— var patches = &#123;&#125; // ç”¨æ¥è®°å½•æ¯ä¸ªèŠ‚ç‚¹å·®å¼‚çš„å¯¹è±¡ dfsWalk(oldTree, newTree, index, patches) return patches&#125;// å¯¹ä¸¤æ£µæ ‘è¿›è¡Œæ·±åº¦ä¼˜å…ˆéå†function dfsWalk (oldNode, newNode, index, patches) &#123; // å¯¹æ¯”oldNodeå’ŒnewNodeçš„ä¸åŒï¼Œè®°å½•ä¸‹æ¥ patches[index] = [...] diffChildren(oldNode.children, newNode.children, index, patches)&#125;// éå†å­èŠ‚ç‚¹function diffChildren (oldChildren, newChildren, index, patches) &#123; var leftNode = null var currentNodeIndex = index oldChildren.forEach(function (child, i) &#123; var newChild = newChildren[i] currentNodeIndex = (leftNode &amp;&amp; leftNode.count) // è®¡ç®—èŠ‚ç‚¹çš„æ ‡è¯† ? currentNodeIndex + leftNode.count + 1 : currentNodeIndex + 1 dfsWalk(child, newChild, currentNodeIndex, patches) // æ·±åº¦éå†å­èŠ‚ç‚¹ leftNode = child &#125;)&#125; ä¾‹å¦‚ï¼Œä¸Šé¢çš„divå’Œæ–°çš„divæœ‰å·®å¼‚ï¼Œå½“å‰çš„æ ‡è®°æ˜¯ 0ï¼Œé‚£ä¹ˆï¼š 1patches[0] = [&#123;difference&#125;, &#123;difference&#125;, ...] // ç”¨æ•°ç»„å­˜å‚¨æ–°æ—§èŠ‚ç‚¹çš„ä¸åŒ åŒç†pæ˜¯patches[1]ï¼Œulæ˜¯patches[3]ï¼Œç±»æ¨ã€‚ å·®å¼‚ç±»å‹ä¸Šé¢è¯´çš„èŠ‚ç‚¹çš„å·®å¼‚æŒ‡çš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå¯¹ DOM æ“ä½œå¯èƒ½ä¼šï¼š æ›¿æ¢æ‰åŸæ¥çš„èŠ‚ç‚¹ï¼Œä¾‹å¦‚æŠŠä¸Šé¢çš„divæ¢æˆäº†section ç§»åŠ¨ã€åˆ é™¤ã€æ–°å¢å­èŠ‚ç‚¹ï¼Œä¾‹å¦‚ä¸Šé¢divçš„å­èŠ‚ç‚¹ï¼ŒæŠŠpå’Œulé¡ºåºäº’æ¢ ä¿®æ”¹äº†èŠ‚ç‚¹çš„å±æ€§ å¯¹äºæ–‡æœ¬èŠ‚ç‚¹ï¼Œæ–‡æœ¬å†…å®¹å¯èƒ½ä¼šæ”¹å˜ã€‚ä¾‹å¦‚ä¿®æ”¹ä¸Šé¢çš„æ–‡æœ¬èŠ‚ç‚¹ 2 å†…å®¹ä¸ºVirtual DOM 2ã€‚ æ‰€ä»¥æˆ‘ä»¬å®šä¹‰äº†å‡ ç§å·®å¼‚ç±»å‹ï¼š 1234var REPLACE = 0var REORDER = 1var PROPS = 2var TEXT = 3 å¯¹äºèŠ‚ç‚¹æ›¿æ¢ï¼Œå¾ˆç®€å•ã€‚åˆ¤æ–­æ–°æ—§èŠ‚ç‚¹çš„tagNameå’Œæ˜¯ä¸æ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœä¸ä¸€æ ·çš„è¯´æ˜éœ€è¦æ›¿æ¢æ‰ã€‚å¦‚divæ¢æˆsectionï¼Œå°±è®°å½•ä¸‹ï¼š 1234patches[0] = [&#123; type: REPALCE, node: newNode // el('section', props, children)&#125;] å¦‚æœç»™divæ–°å¢äº†å±æ€§idä¸ºcontainerï¼Œå°±è®°å½•ä¸‹ï¼š 123456789patches[0] = [&#123; type: REPALCE, node: newNode // el('section', props, children)&#125;, &#123; type: PROPS, props: &#123; id: \"container\" &#125;&#125;] å¦‚æœæ˜¯æ–‡æœ¬èŠ‚ç‚¹ï¼Œå¦‚ä¸Šé¢çš„æ–‡æœ¬èŠ‚ç‚¹2ï¼Œå°±è®°å½•ä¸‹ï¼š 1234patches[2] = [&#123; type: TEXT, content: \"Virtual DOM2\"&#125;] é‚£å¦‚æœæŠŠæˆ‘divçš„å­èŠ‚ç‚¹é‡æ–°æ’åºå‘¢ï¼Ÿä¾‹å¦‚p,ul,divçš„é¡ºåºæ¢æˆäº†div,p,ulã€‚è¿™ä¸ªè¯¥æ€ä¹ˆå¯¹æ¯”ï¼Ÿå¦‚æœæŒ‰ç…§åŒå±‚çº§è¿›è¡Œé¡ºåºå¯¹æ¯”çš„è¯ï¼Œå®ƒä»¬éƒ½ä¼šè¢«æ›¿æ¢æ‰ã€‚å¦‚ på’Œdivçš„tagNameä¸åŒï¼Œpä¼šè¢«divæ‰€æ›¿ä»£ã€‚æœ€ç»ˆï¼Œä¸‰ä¸ªèŠ‚ç‚¹éƒ½ä¼šè¢«æ›¿æ¢ï¼Œè¿™æ ·DOMå¼€é”€å°±éå¸¸å¤§ã€‚è€Œå®é™…ä¸Šæ˜¯ä¸éœ€è¦æ›¿æ¢èŠ‚ç‚¹ï¼Œè€Œåªéœ€è¦ç»è¿‡èŠ‚ç‚¹ç§»åŠ¨å°±å¯ä»¥è¾¾åˆ°ï¼Œæˆ‘ä»¬åªéœ€çŸ¥é“æ€ä¹ˆè¿›è¡Œç§»åŠ¨ã€‚ è¿™ç‰µæ¶‰åˆ°ä¸¤ä¸ªåˆ—è¡¨çš„å¯¹æ¯”ç®—æ³•ï¼Œéœ€è¦å¦å¤–èµ·ä¸€ä¸ªå°èŠ‚æ¥è®¨è®ºã€‚ åˆ—è¡¨å¯¹æ¯”ç®—æ³•å‡è®¾ç°åœ¨å¯ä»¥è‹±æ–‡å­—æ¯å”¯ä¸€åœ°æ ‡è¯†æ¯ä¸€ä¸ªå­èŠ‚ç‚¹ï¼š æ—§çš„èŠ‚ç‚¹é¡ºåºï¼š 1a b c d e f g h i ç°åœ¨å¯¹èŠ‚ç‚¹è¿›è¡Œäº†åˆ é™¤ã€æ’å…¥ã€ç§»åŠ¨çš„æ“ä½œã€‚æ–°å¢jèŠ‚ç‚¹ï¼Œåˆ é™¤eèŠ‚ç‚¹ï¼Œç§»åŠ¨hèŠ‚ç‚¹ï¼š æ–°çš„èŠ‚ç‚¹é¡ºåºï¼š 1a b c h d f g i j ç°åœ¨çŸ¥é“äº†æ–°æ—§çš„é¡ºåºï¼Œæ±‚æœ€å°çš„æ’å…¥ã€åˆ é™¤æ“ä½œï¼ˆç§»åŠ¨å¯ä»¥çœ‹æˆæ˜¯åˆ é™¤å’Œæ’å…¥æ“ä½œçš„ç»“åˆï¼‰ã€‚è¿™ä¸ªé—®é¢˜æŠ½è±¡å‡ºæ¥å…¶å®æ˜¯å­—ç¬¦ä¸²çš„æœ€å°ç¼–è¾‘è·ç¦»é—®é¢˜ï¼ˆEdition Distanceï¼‰ï¼Œæœ€å¸¸è§çš„è§£å†³ç®—æ³•æ˜¯ Levenshtein Distanceï¼Œé€šè¿‡åŠ¨æ€è§„åˆ’æ±‚è§£ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(M * N)ã€‚ä½†æ˜¯æˆ‘ä»¬å¹¶ä¸éœ€è¦çœŸçš„è¾¾åˆ°æœ€å°çš„æ“ä½œï¼Œæˆ‘ä»¬åªéœ€è¦ä¼˜åŒ–ä¸€äº›æ¯”è¾ƒå¸¸è§çš„ç§»åŠ¨æƒ…å†µï¼Œç‰ºç‰²ä¸€å®š DOM æ“ä½œï¼Œè®©ç®—æ³•æ—¶é—´å¤æ‚åº¦è¾¾åˆ°çº¿æ€§çš„ï¼ˆO(max(M, N))ã€‚å…·ä½“ç®—æ³•ç»†èŠ‚æ¯”è¾ƒå¤šï¼Œè¿™é‡Œä¸ç´¯è¿°ï¼Œæœ‰å…´è¶£å¯ä»¥å‚è€ƒä»£ç ã€‚ æˆ‘ä»¬èƒ½å¤Ÿè·å–åˆ°æŸä¸ªçˆ¶èŠ‚ç‚¹çš„å­èŠ‚ç‚¹çš„æ“ä½œï¼Œå°±å¯ä»¥è®°å½•ä¸‹æ¥ï¼š 1234patches[0] = [&#123; type: REORDER, moves: [&#123;remove or insert&#125;, &#123;remove or insert&#125;, ...]&#125;] ä½†æ˜¯è¦æ³¨æ„çš„æ˜¯ï¼Œå› ä¸ºtagNameæ˜¯å¯é‡å¤çš„ï¼Œä¸èƒ½ç”¨è¿™ä¸ªæ¥è¿›è¡Œå¯¹æ¯”ã€‚æ‰€ä»¥éœ€è¦ç»™å­èŠ‚ç‚¹åŠ ä¸Šå”¯ä¸€æ ‡è¯†keyï¼Œåˆ—è¡¨å¯¹æ¯”çš„æ—¶å€™ï¼Œä½¿ç”¨keyè¿›è¡Œå¯¹æ¯”ï¼Œè¿™æ ·æ‰èƒ½å¤ç”¨è€çš„ DOM æ ‘ä¸Šçš„èŠ‚ç‚¹ã€‚ è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æ·±åº¦ä¼˜å…ˆéå†ä¸¤æ£µæ ‘ï¼Œæ¯å±‚çš„èŠ‚ç‚¹è¿›è¡Œå¯¹æ¯”ï¼Œè®°å½•ä¸‹æ¯ä¸ªèŠ‚ç‚¹çš„å·®å¼‚äº†ã€‚å®Œæ•´ diff ç®—æ³•ä»£ç å¯è§ diff.jsã€‚ æ­¥éª¤ä¸‰ï¼šæŠŠå·®å¼‚åº”ç”¨åˆ°çœŸæ­£çš„DOMæ ‘ä¸Šå› ä¸ºæ­¥éª¤ä¸€æ‰€æ„å»ºçš„ JavaScript å¯¹è±¡æ ‘å’Œrenderå‡ºæ¥çœŸæ­£çš„DOMæ ‘çš„ä¿¡æ¯ã€ç»“æ„æ˜¯ä¸€æ ·çš„ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¯¹é‚£æ£µDOMæ ‘ä¹Ÿè¿›è¡Œæ·±åº¦ä¼˜å…ˆçš„éå†ï¼Œéå†çš„æ—¶å€™ä»æ­¥éª¤äºŒç”Ÿæˆçš„patcheså¯¹è±¡ä¸­æ‰¾å‡ºå½“å‰éå†çš„èŠ‚ç‚¹å·®å¼‚ï¼Œç„¶åè¿›è¡Œ DOM æ“ä½œã€‚ 123456789101112131415161718192021function patch (node, patches) &#123; var walker = &#123;index: 0&#125; dfsWalk(node, walker, patches)&#125;function dfsWalk (node, walker, patches) &#123; var currentPatches = patches[walker.index] // ä»patchesæ‹¿å‡ºå½“å‰èŠ‚ç‚¹çš„å·®å¼‚ var len = node.childNodes ? node.childNodes.length : 0 for (var i = 0; i &lt; len; i++) &#123; // æ·±åº¦éå†å­èŠ‚ç‚¹ var child = node.childNodes[i] walker.index++ dfsWalk(child, walker, patches) &#125; if (currentPatches) &#123; applyPatches(node, currentPatches) // å¯¹å½“å‰èŠ‚ç‚¹è¿›è¡ŒDOMæ“ä½œ &#125;&#125; applyPatchesï¼Œæ ¹æ®ä¸åŒç±»å‹çš„å·®å¼‚å¯¹å½“å‰èŠ‚ç‚¹è¿›è¡Œ DOM æ“ä½œï¼š 1234567891011121314151617181920function applyPatches (node, currentPatches) &#123; currentPatches.forEach(function (currentPatch) &#123; switch (currentPatch.type) &#123; case REPLACE: node.parentNode.replaceChild(currentPatch.node.render(), node) break case REORDER: reorderChildren(node, currentPatch.moves) break case PROPS: setProps(node, currentPatch.props) break case TEXT: node.textContent = currentPatch.content break default: throw new Error('Unknown patch type ' + currentPatch.type) &#125; &#125;)&#125; å®Œæ•´ä»£ç å¯è§ patch.jsã€‚ ç»“è¯­Virtual DOM ç®—æ³•ä¸»è¦æ˜¯å®ç°ä¸Šé¢æ­¥éª¤çš„ä¸‰ä¸ªå‡½æ•°ï¼šelementï¼Œdiffï¼Œpatchã€‚ç„¶åå°±å¯ä»¥å®é™…çš„è¿›è¡Œä½¿ç”¨ï¼š 1234567891011121314151617181920212223// 1. æ„å»ºè™šæ‹ŸDOMvar tree = el('div', &#123;'id': 'container'&#125;, [ el('h1', &#123;style: 'color: blue'&#125;, ['simple virtal dom']), el('p', ['Hello, virtual-dom']), el('ul', [el('li')])])// 2. é€šè¿‡è™šæ‹ŸDOMæ„å»ºçœŸæ­£çš„DOMvar root = tree.render()document.body.appendChild(root)// 3. ç”Ÿæˆæ–°çš„è™šæ‹ŸDOMvar newTree = el('div', &#123;'id': 'container'&#125;, [ el('h1', &#123;style: 'color: red'&#125;, ['simple virtal dom']), el('p', ['Hello, virtual-dom']), el('ul', [el('li'), el('li')])])// 4. æ¯”è¾ƒä¸¤æ£µè™šæ‹ŸDOMæ ‘çš„ä¸åŒvar patches = diff(tree, newTree)// 5. åœ¨çœŸæ­£çš„DOMå…ƒç´ ä¸Šåº”ç”¨å˜æ›´patch(root, patches) å½“ç„¶è¿™æ˜¯éå¸¸ç²—ç³™çš„å®è·µï¼Œå®é™…ä¸­è¿˜éœ€è¦å¤„ç†äº‹ä»¶ç›‘å¬ç­‰ï¼›ç”Ÿæˆè™šæ‹Ÿ DOM çš„æ—¶å€™ä¹Ÿå¯ä»¥åŠ å…¥ JSX è¯­æ³•ã€‚è¿™äº›äº‹æƒ…éƒ½åšäº†çš„è¯ï¼Œå°±å¯ä»¥æ„é€ ä¸€ä¸ªç®€å•çš„ReactJSäº†ã€‚ æœ¬æ–‡æ‰€å®ç°çš„å®Œæ•´ä»£ç å­˜æ”¾åœ¨ Githubï¼Œä»…ä¾›å­¦ä¹ ã€‚ Referenceshttps://github.com/Matt-Esch/virtual-dom/blob/master/vtree/diff.js","tags":[{"name":"javascript","slug":"javascript","permalink":"http://xyue.me/tags/javascript/"},{"name":"virtual-dom","slug":"virtual-dom","permalink":"http://xyue.me/tags/virtual-dom/"}]},{"title":"js ä»£ç é‡æ„ç»†èŠ‚","date":"2017-12-06T07:30:41.000Z","path":"2017/12/06/js-restructure-points/","text":"é‡æ„ï¼ˆåè¯ï¼‰ï¼šå¯¹è½¯ä»¶å†…éƒ¨ç»“æ„çš„ä¸€ç§è°ƒæ•´ï¼Œç›®çš„æ˜¯åœ¨ä¸æ”¹å˜è½¯ä»¶å¯è§‚å¯Ÿè¡Œä¸ºçš„å‰æä¸‹ï¼Œæé«˜å…¶å¯ç†è§£æ€§ï¼Œé™ä½å…¶ä¿®æ”¹æˆæœ¬ã€‚ ä¼´éšè½¯ä»¶çš„è¿­ä»£ï¼ŒåŠŸèƒ½çš„æ—¥ç›Šå¤æ‚ï¼Œç”±äºæ²¡æœ‰ç†è§£åŸæ¥ç¨‹åºçš„ç»“æ„å’Œè€ƒè™‘ä»£ç çš„æ‰©å±•æ€§ï¼Œç¨‹åºæ…¢æ…¢çš„å¤±å»äº†åŸæ¥çš„ç»“æ„ï¼Œä¹‹å‰çš„è®¾è®¡å˜å¾—é¢ç›®å…¨éã€‚å¦‚æœä¸è¿›è¡Œé‡æ„ï¼Œç¨‹åºå°±ä¼šè¶Šæ¥è¶Šéš¾ä»¥ç»´æŠ¤ã€‚ ä¸ºä½•é‡æ„ æ”¹è¿›è½¯ä»¶è®¾è®¡ â€”â€” åŸæ¥çš„è®¾è®¡æ²¡è€ƒè™‘åˆ°ä¸€äº›æœªçŸ¥çš„æƒ…å†µï¼Œå¯¼è‡´å…¶ååŠ å…¥çš„åŠŸèƒ½ç ´ååŸæœ‰è®¾è®¡ ä½¿è½¯ä»¶æ›´å®¹æ˜“ç†è§£ å¸®åŠ©æ‰¾åˆ°bug â€”â€” é‡æ„å¯ä»¥å¢åŠ å¯¹ä»£ç çš„ç†è§£ï¼Œä»è€Œæ›´å®¹æ˜“ æé«˜ç¼–ç¨‹é€Ÿåº¦ â€”â€” é‡æ„è™½ç„¶èŠ±è´¹æ—¶é—´ï¼Œä½†é‡æ„å¯ä»¥æ”¹å–„ç¨‹åºçš„è®¾è®¡ï¼Œä½¿æ·»åŠ æ–°ç‰¹æ€§æ›´å®¹æ˜“ ä½•æ—¶é‡æ„é‡æ„åº”è¯¥éšæ—¶è¿›è¡Œï¼Œå½“åŠ å…¥æ–°åŠŸèƒ½æ—¶ä¸æ˜¯ç‰¹åˆ«å®¹æ˜“æ—¶ï¼Œå¯ä»¥é€šè¿‡é‡æ„ä½¿æ·»åŠ æ–°ç‰¹æ€§æ›´å®¹æ˜“ï¼Œä¿®è¡¥é”™è¯¯æ—¶æ›´å®¹æ˜“å‘ç°Bugï¼Œå¤å®¡ä»£ç ä¹Ÿæ˜¯é‡æ„çš„å¥½æ—¶æœºã€‚ é‡æ„ç»†èŠ‚åœ¨å®é™…çš„é¡¹ç›®é‡æ„æœ‰ä¸€äº›å¸¸è§è€Œå®¹æ˜“å¿½ç•¥çš„ç»†èŠ‚ï¼Œè¿™äº›ç»†èŠ‚ä¹Ÿæ˜¯å¸®åŠ©æˆ‘ä»¬è¾¾åˆ°é‡æ„ç›®æ ‡çš„é‡è¦æ‰‹æ®µã€‚æœ‰ä¸€éƒ¨åˆ†æ€æƒ³æ¥è‡ª Martin Fowler çš„åè‘— ã€Šé‡æ„ï¼šæ”¹å–„æ—¢æœ‰ä»£ç çš„è®¾è®¡ã€‹ï¼Œè™½ç„¶è¯¥ä¹¦æ˜¯ä½¿ç”¨ Java è¯­è¨€å†™æˆçš„ï¼Œä½†è¿™äº›é‡æ„çš„æŠ€å·§ï¼Œæœ‰å¾ˆå¤§ä¸€éƒ¨åˆ†å¯ä»¥ä¸º JavaScript è¯­è¨€æ‰€å€Ÿé‰´ã€‚ æç‚¼å‡½æ•°å¦‚æœåœ¨å‡½æ•°ä¸­æœ‰ä¸€æ®µä»£ç å¯ä»¥è¢«ç‹¬ç«‹å‡ºæ¥ï¼Œé‚£æˆ‘ä»¬æœ€å¥½æŠŠè¿™äº›ä»£ç æ”¾è¿›å¦å¤–ä¸€ä¸ªç‹¬ç«‹çš„å‡½æ•°ä¸­ã€‚è¿™æ˜¯ä¸€ç§å¾ˆå¸¸è§çš„ä¼˜åŒ–å·¥ä½œï¼Œè¿™æ ·åšçš„å¥½å¤„ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹ã€‚ é¿å…å‡ºç°è¶…å¤§å‡½æ•° ç‹¬ç«‹å‡ºæ¥çš„å‡½æ•°æœ‰åŠ©äºä»£ç å¤ç”¨ ç‹¬ç«‹å‡ºæ¥çš„å‡½æ•°æ›´å®¹æ˜“è¢«è¦†å†™ ç‹¬ç«‹å‡ºæ¥çš„å‡½æ•°å¦‚æœæ‹¥æœ‰ä¸€ä¸ªè‰¯å¥½çš„å‘½åï¼Œå®ƒæœ¬èº«å°±èµ·åˆ°äº†æ³¨é‡Šçš„ä½œç”¨ 1234567var getUserInfo = function () &#123; ajax('http:// xxx.com/userInfo', function (data) &#123; console.log('userId: ' + data.userId); console.log('userName: ' + data.userName); console.log('nickName: ' + data.nickName); &#125;);&#125;; æ›´æ”¹ä¸ºâ†“ 12345678910var getUserInfo = function () &#123; ajax('http:// xxx.com/userInfo', function (data) &#123; printDetails(data); &#125;);&#125;;var printDetails = function (data) &#123; console.log('userId: ' + data.userId); console.log('userName: ' + data.userName); console.log('nickName: ' + data.nickName);&#125;; åˆå¹¶é‡å¤çš„æ¡ä»¶ç‰‡æ®µ1234567891011var paging = function (currPage) &#123; if (currPage &lt;= 0) &#123; currPage = 0; jump(currPage); // è·³è½¬ &#125; else if (currPage &gt;= totalPage) &#123; currPage = totalPage; jump(currPage); // è·³è½¬ &#125; else &#123; jump(currPage); // è·³è½¬ &#125;&#125;; æ›´æ”¹ä¸ºâ†“ 12345678var paging = function (currPage) &#123; if (currPage &lt;= 0) &#123; currPage = 0; &#125; else if (currPage &gt;= totalPage) &#123; currPage = totalPage; &#125; jump(currPage); // æŠŠ jump å‡½æ•°ç‹¬ç«‹å‡ºæ¥&#125;; æŠŠæ¡ä»¶åˆ†æ”¯è¯­å¥æç‚¼æˆå‡½æ•°1234567var getPrice = function (price) &#123; var date = new Date(); if (date.getMonth() &gt;= 6 &amp;&amp; date.getMonth() &lt;= 9) &#123; // å¤å¤© return price * 0.8; &#125; return price;&#125;; æ›´æ”¹ä¸ºâ†“ 12345678910var isSummer = function () &#123; var date = new Date(); return date.getMonth() &gt;= 6 &amp;&amp; date.getMonth() &lt;= 9;&#125;;var getPrice = function (price) &#123; if (isSummer()) &#123; // å¤å¤© return price * 0.8; &#125; return price;&#125;; åˆç†ä½¿ç”¨å¾ªç¯12345678910111213var createXHR = function () &#123; var xhr; try &#123; xhr = new ActiveXObject('MSXML2.XMLHttp.6.0'); &#125; catch (e) &#123; try &#123; xhr = new ActiveXObject('MSXML2.XMLHttp.3.0'); &#125; catch (e) &#123; xhr = new ActiveXObject('MSXML2.XMLHttp'); &#125; &#125; return xhr;&#125;; æ›´æ”¹ä¸ºâ†“ 123456789var createXHR = function () &#123; var versions = ['MSXML2.XMLHttp.6.0ddd', 'MSXML2.XMLHttp.3.0', 'MSXML2.XMLHttp']; for (var i = 0, version; version = versions[i++];) &#123; try &#123; return new ActiveXObject(version); &#125; catch (e) &#123; &#125; &#125;&#125;; æå‰è®©å‡½æ•°é€€å‡ºä»£æ›¿åµŒå¥—æ¡ä»¶åˆ†æ”¯1234567891011var del = function (obj) &#123; var ret; if (!obj.isReadOnly) &#123; // ä¸ä¸ºåªè¯»çš„æ‰èƒ½è¢«åˆ é™¤ if (obj.isFolder) &#123; // å¦‚æœæ˜¯æ–‡ä»¶å¤¹ ret = deleteFolder(obj); &#125; else if (obj.isFile) &#123; // å¦‚æœæ˜¯æ–‡ä»¶ ret = deleteFile(obj); &#125; &#125; return ret;&#125;; æ›´æ”¹ä¸ºâ†“ 1234567891011var del = function (obj) &#123; if (obj.isReadOnly) &#123; // åè½¬ if è¡¨è¾¾å¼ return; &#125; if (obj.isFolder) &#123; return deleteFolder(obj); &#125; if (obj.isFile) &#123; return deleteFile(obj); &#125;&#125;; ä¼ é€’å¯¹è±¡å‚æ•°ä»£æ›¿è¿‡é•¿çš„å‚æ•°åˆ—è¡¨12345678var setUserInfo = function (id, name, address, sex, mobile, qq) &#123; console.log('id= ' + id); console.log('name= ' + name); console.log('address= ' + address); console.log('sex= ' + sex); console.log('mobile= ' + mobile); console.log('qq= ' + qq);&#125;; æ›´æ”¹ä¸ºâ†“ 12345678var setUserInfo = function (obj) &#123; console.log('id= ' + obj.id); console.log('name= ' + obj.name); console.log('address= ' + obj.address); console.log('sex= ' + obj.sex); console.log('mobile= ' + obj.mobile); console.log('qq= ' + obj.qq);&#125;; å°½é‡å‡å°‘å‚æ•°æ•°é‡1var draw = function (width, height, square) &#123;&#125;; æ›´æ”¹ä¸ºâ†“ 123var draw = function (width, height) &#123; var square = width * height;&#125;; å°‘ç”¨ä¸‰ç›®è¿ç®—ç¬¦å¦‚æœæ¡ä»¶åˆ†æ”¯é€»è¾‘ç®€å•ä¸”æ¸…æ™°ï¼Œè¿™æ— ç¢æˆ‘ä»¬ä½¿ç”¨ä¸‰ç›®è¿ç®—ç¬¦ï¼š1var global = typeof window !== \"undefined\" ? window : this; ä½†å¦‚æœæ¡ä»¶åˆ†æ”¯é€»è¾‘éå¸¸å¤æ‚ï¼Œå¦‚ä¸‹æ®µä»£ç æ‰€ç¤ºï¼Œé‚£æˆ‘ä»¬æœ€å¥½çš„é€‰æ‹©è¿˜æ˜¯æŒ‰éƒ¨å°±ç­åœ°ç¼–å†™ ifã€ elseã€‚ ifã€ else è¯­å¥çš„å¥½å¤„å¾ˆå¤šï¼Œä¸€æ˜¯é˜…è¯»ç›¸å¯¹å®¹æ˜“ï¼ŒäºŒæ˜¯ä¿®æ”¹çš„æ—¶å€™æ¯”ä¿®æ”¹ä¸‰ç›®è¿ç®—ç¬¦å‘¨å›´çš„ä»£ç æ›´åŠ æ–¹ä¾¿ 123456789if ( !aup || !bup ) &#123; // å¤´ç—›å§ return a === doc ? -1 : b === doc ? 1 : aup ? -1 : bup ? 1 : sortInput ? ( indexOf.call( sortInput, a ) - indexOf.call( sortInput, b ) ) : 0;&#125; åˆç†ä½¿ç”¨é“¾å¼è°ƒç”¨12345678910111213var User = function () &#123; this.id = null; this.name = null;&#125;;User.prototype.setId = function (id) &#123; this.id = id; return this;&#125;;User.prototype.setName = function (name) &#123; this.name = name; return this;&#125;;console.log(new User().setId(1314).setName('sven')); æˆ–åˆ™â†“ 12345678910111213var User = &#123; id: null, name: null, setId: function (id) &#123; this.id = id; return this; &#125;, setName: function (name) &#123; this.name = name; return this; &#125;&#125;;console.log(User.setId(1314).setName('sven')); åˆ†è§£å¤§å‹ç±»12345678910111213var Spirit = function (name) &#123; this.name = name;&#125;;Spirit.prototype.attack = function (type) &#123; // æ”»å‡» if (type === 'waveBoxing') &#123; console.log(this.name + ': ä½¿ç”¨æ³¢åŠ¨æ‹³'); &#125; else if (type === 'whirlKick') &#123; console.log(this.name + ': ä½¿ç”¨æ—‹é£è…¿'); &#125;&#125;;var spirit = new Spirit('RYU');spirit.attack('waveBoxing'); // è¾“å‡ºï¼š RYU: ä½¿ç”¨æ³¢åŠ¨æ‹³spirit.attack('whirlKick'); // è¾“å‡ºï¼š RYU: ä½¿ç”¨æ—‹é£è…¿ æ›´æ”¹ä¸ºâ†“ 123456789101112131415161718192021222324var Attack = function (spirit) &#123; this.spirit = spirit;&#125;;Attack.prototype.start = function (type) &#123; return this.list[type].call(this);&#125;;Attack.prototype.list = &#123; waveBoxing: function () &#123; console.log(this.spirit.name + ': ä½¿ç”¨æ³¢åŠ¨æ‹³'); &#125;, whirlKick: function () &#123; console.log(this.spirit.name + ': ä½¿ç”¨æ—‹é£è…¿'); &#125;&#125;;var Spirit = function (name) &#123; this.name = name; this.attackObj = new Attack(this);&#125;;Spirit.prototype.attack = function (type) &#123; // æ”»å‡» this.attackObj.start(type);&#125;;var spirit = new Spirit('RYU');spirit.attack('waveBoxing'); // è¾“å‡ºï¼š RYU: ä½¿ç”¨æ³¢åŠ¨æ‹³spirit.attack('whirlKick'); // è¾“å‡ºï¼š RYU: ä½¿ç”¨æ—‹é£è…¿ ç”¨ return é€€å‡ºå¤šé‡å¾ªç¯123456789101112131415var func = function () &#123; var flag = false; for (var i = 0; i &lt; 10; i++) &#123; for (var j = 0; j &lt; 10; j++) &#123; if (i * j &gt; 30) &#123; flag = true; break; &#125; &#125; if (flag === true) &#123; break; &#125; &#125; console.log('....');&#125;; æ›´æ”¹ä¸ºâ†“ 12345678910var func = function () &#123; for (var i = 0; i &lt; 10; i++) &#123; for (var j = 0; j &lt; 10; j++) &#123; if (i * j &gt; 30) &#123; console.log('....'); // for å¾ªç¯åè¾¹çš„ä»£ç æå–åˆ° return ä¹‹å‰æ‰§è¡Œ return; &#125; &#125; &#125;&#125;; Referencesã€ŠJavaScriptè®¾è®¡æ¨¡å¼ä¸å¼€å‘å®è·µã€‹â€”â€”æ›¾æ¢","tags":[{"name":"javascript","slug":"javascript","permalink":"http://xyue.me/tags/javascript/"},{"name":"é‡æ„","slug":"é‡æ„","permalink":"http://xyue.me/tags/é‡æ„/"}]},{"title":"ionic3 å¯åŠ¨ç™½å±è§£å†³","date":"2017-11-27T09:25:06.000Z","path":"2017/11/27/ionic-start-white-screen/","text":"é—®é¢˜æè¿°APP å¯åŠ¨åï¼Œä¼šæœ‰ä¸€æ®µæ—¶é—´çš„ç™½å±ï¼Œå½±å“ä½“éªŒ è§£å†³ç¬¬ä¸€æ­¥å‘ config.xml é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ 1234&lt;preference name=\"AutoHideSplashScreen\" value=\"false\" /&gt; &lt;!-- ç¦æ­¢è‡ªåŠ¨éšè— --&gt;&lt;preference name=\"ShowSplashScreen\" value=\"true\" /&gt; &lt;!-- æ˜¾ç¤ºå¯åŠ¨ç”»é¢ --&gt;&lt;preference name=\"ShowSplashScreenSpinner\" value=\"true\" /&gt; &lt;!-- æ˜¾ç¤ºå¯åŠ¨åŠ è½½ç°åœˆ --&gt;&lt;preference name=\"FadeSplashScreen\" value=\"true\" /&gt; &lt;!-- å¯åŠ¨æ·¡å‡ºæ•ˆæœ --&gt; ç¬¬äºŒæ­¥å‘ /src/app/main.ts æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ 12import &#123; enableProdMode &#125; from '@angular/core';enableProdMode();// åŠ å¿«å¯åŠ¨é€Ÿåº¦ å®Œæˆä»¥ä¸Šæ­¥éª¤é‡æ–° build.","tags":[{"name":"ionic","slug":"ionic","permalink":"http://xyue.me/tags/ionic/"}]},{"title":"å…¨æ–‡æ£€ç´¢å¼•æ“ Solr æ­å»º","date":"2017-10-18T01:43:31.000Z","path":"2017/10/18/search-engine-solr-build/","text":"Solræ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ï¼Œé‡‡ç”¨Java5å¼€å‘ï¼ŒåŸºäºLuceneçš„å…¨æ–‡æœç´¢æœåŠ¡å™¨ã€‚åŒæ—¶å¯¹å…¶è¿›è¡Œäº†æ‰©å±•ï¼Œæä¾›äº†æ¯”Luceneæ›´ä¸ºä¸°å¯Œçš„æŸ¥è¯¢è¯­è¨€ï¼ŒåŒæ—¶å®ç°äº†å¯é…ç½®ã€å¯æ‰©å±•å¹¶å¯¹æŸ¥è¯¢æ€§èƒ½è¿›è¡Œäº†ä¼˜åŒ–ï¼Œå¹¶ä¸”æä¾›äº†ä¸€ä¸ªå®Œå–„çš„åŠŸèƒ½ç®¡ç†ç•Œé¢ï¼Œæ˜¯ä¸€æ¬¾éå¸¸ä¼˜ç§€çš„å…¨æ–‡æœç´¢å¼•æ“ã€‚ å‡†å¤‡é…ç½®ç¯å¢ƒ window JDK 1.8 Solr 7.0.1 oracle ç›®å½•è¯´æ˜ä¸‹è½½Solråè§£å‹å¾—åˆ°ç›®å½• 12345678910â”œâ”€bin // è„šæœ¬çš„å¯åŠ¨ç›®å½•â”œâ”€contrib // ç¬¬ä¸‰æ–¹ jar åŒ…å­˜æ”¾ç›®å½•â”œâ”€dist // ç¼–è¯‘æ‰“åŒ…åå­˜æ”¾ç›®å½•ï¼Œå³æ„å»ºåçš„è¾“å‡ºäº§ç‰©å­˜æ”¾ç›®å½•â”œâ”€docs // solr çš„ API æ–‡æ¡£æ–‡æ¡£å­˜æ”¾ç›®å½•â”œâ”€example // ç¤ºèŒƒä¾‹å­çš„å­˜æ”¾ç›®å½•ï¼Œexample-DIH ç›®å½•ä¸‹çš„æ˜¯ä¸€äº› solr ç´¢å¼• core æ ·ä¾‹â”œâ”€licenses // solr ç›¸å…³çš„ä¸€äº›è®¸å¯ä¿¡æ¯â””â”€server // solr æœåŠ¡ç«¯å·¥ä½œç›®å½•ï¼Œè‡ªå¸¦é›†æˆ jetty æ’ä»¶æ–¹å¼å¯åŠ¨ solr æœåŠ¡å™¨ â”‚ start.jar // æœåŠ¡ç«¯å¯åŠ¨ jar åŒ… â”œâ”€solr // solr æœç´¢å¼•æ“å·¥ä½œç›®å½•ï¼Œå³ SOLRHOME â””â”€solr-webapp // solr åå°ç®¡ç†é¡µé¢ webapp å¯åŠ¨è¿›å…¥ /bin ç›®å½•ï¼Œ æŒ‰ä½ shift + é¼ æ ‡å³é”®æ‰“å¼€å‘½ä»¤çª—å£ æ‰“å¼€å‘½ä»¤çª—å£ è¾“å…¥ 1solr start å¯åŠ¨ Solr æœåŠ¡ å¯åŠ¨ Solr æœåŠ¡ åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ localhost:8983 è®¿é—® Solr ç®¡ç†åå° ç®¡ç†åå° æ–°å»ºç´¢å¼•åº“coreè¾“å…¥ 1solr create -c my_core æ–°å»ºåä¸º my_core çš„ core create åˆ›å»ºæˆåŠŸåï¼Œåœ¨ç®¡ç†é¡µé¢é€‰æ‹© Core Admin å¯ä»¥çœ‹åˆ°åˆšåˆ›å»ºçš„ core åœ¨ SOLRHOME ï¼ˆç›®å½•è¯´æ˜ä¸­æœ‰æåˆ°ï¼‰ä¸‹ä¼šç”Ÿæˆ my_core ç›®å½• my_core 1234â”œâ”€conf // å­˜æ”¾coreçš„é…ç½®æ–‡ä»¶â”‚ solrconfig.xml // å®šä¹‰äº†è¿™ä¸ª core çš„é…ç½®ä¿¡æ¯â”‚ start.jar // å®šä¹‰ç´¢å¼•åº“çš„å­—æ®µåŠåˆ†è¯å™¨ç­‰ï¼Œè¿™ä¸ªé…ç½®æ–‡ä»¶æ˜¯æ ¸å¿ƒæ–‡ä»¶â””â”€data // å­˜æ”¾coreçš„æ•°æ®ï¼Œå³index-ç´¢å¼•æ–‡ä»¶å’Œlog-æ—¥å¿—è®°å½• å¯¼å…¥æ•°æ®å¯¼å…¥ oracle è¡¨ news ä¸­çš„æ•°æ® table_news åœ¨ %SOLRHOME%/my_core/conf ç›®å½•ä¸‹åˆ›å»º data-config.xml æ–‡ä»¶ï¼Œå¹¶å†™å…¥ä»¥ä¸‹å†…å®¹ 123456789101112131415&lt;dataConfig&gt; &lt;dataSource user=\"[user]\" password=\"[password]\" url=\"jdbc:oracle:thin:@[host]:[port]:[SID]\" driver=\"oracle.jdbc.driver.OracleDriver\"/&gt; &lt;document &gt; &lt;!-- è¡¨ä¸­å­—æ®µæ˜ å°„ pk: ä¸»é”® transformerï¼š clob è½¬æ¢ --&gt; &lt;entity name=\"news\" pk=\"ID\" query=\"select * from news\" transformer=\"ClobTransformer\"&gt; &lt;field name=\"id\" column=\"N_ID\"/&gt; &lt;field name=\"title\" column=\"N_TITLE\"/&gt; &lt;field name=\"content\" column=\"N_CONTENT\" clob=\"true\"/&gt; &lt;field name=\"time\" column=\"N_TIME\"/&gt; &lt;/entity&gt; &lt;/document&gt;&lt;/dataConfig&gt; åœ¨ %SOLRHOME%/my_core ä¸‹åˆ›å»º lib æ–‡ä»¶å¤¹ï¼Œå¹¶å°† oracle é©±åŠ¨åŒ… ojdbc6.jar æ”¾åˆ°è¯¥ç›®å½•ä¸‹æ­¤æ—¶ my_core æ–‡ä»¶ç»“æ„å¦‚ä¸‹ 123456789101112131415â”‚ core.propertiesâ”‚ â”œâ”€confâ”‚ â”‚ data-config.xmlâ”‚ â”‚ dataimport.propertiesâ”‚ â”‚ managed-schemaâ”‚ â”‚ params.jsonâ”‚ â”‚ protwords.txtâ”‚ â”‚ solrconfig.xmlâ”‚ â”‚ stopwords.txtâ”‚ â”‚ synonyms.txtâ”‚ â””â”€lang â”œâ”€data â””â”€lib ojdbc6.jar ç¼–è¾‘ %SOLRHOME%/my_core/conf/solrconfig.xmlï¼Œæ·»åŠ ç±»åº“å’Œæ•°æ®åº“é…ç½®ï¼š 1&lt;lib dir=\"$&#123;solr.install.dir:../../../..&#125;/dist/\" regex=\"solr-dataimporthandler-\\d.*\\.jar\" /&gt; 12345&lt;requestHandler name=\"/dataimport\" class=\"solr.DataImportHandler\"&gt; &lt;lst name=\"defaults\"&gt; &lt;str name=\"config\"&gt;data-config.xml&lt;/str&gt; &lt;/lst&gt; &lt;/requestHandler&gt; é€‰æ‹©å½“å‰ my_core ,é€‰æ‹© Schema, æ·»åŠ ç´¢å¼•å­—æ®µ ï¼ˆå­—æ®µåç§°å’Œ solrconfig.xml ä¸­ field ç›¸åŒï¼Œå¿½ç•¥ä¸»é”®ï¼‰ Add Filed æ·»åŠ å®Œæˆåï¼Œæ‰“å¼€ %SOLRHOME%/my_core/conf/managed-schemaï¼Œå¯ä»¥çœ‹åˆ°ï¼Œæ­¤æ—¶æ·»åŠ ç´¢å¼•å­—æ®µå·²å†™å…¥è¯¥æ–‡ä»¶ä¸­ managed-schema åœ¨å‘½ä»¤å°ä¸­è¾“å…¥1solr restart -p 8983 é‡å¯æœåŠ¡ restart è¿›å…¥ç®¡ç†ç•Œé¢ï¼Œé€‰æ‹© my_core â€“&gt; Dataimport â€“&gt; Execute å¯¼å…¥æ•°æ®ï¼Œå¯ä»¥ç‚¹å‡» Refresh Status æŸ¥çœ‹å¯¼å…¥çŠ¶æ€ Dataimport æŸ¥è¯¢æ•°æ®é€‰æ‹© Query Query ç‚¹å‡» Execute Query æŸ¥è¯¢æ•°æ® Execute Query åˆ†è¯å™¨smartcn ã€ IKAnalyzer ã€ mmseg4jï¼Œé€‰æ‹©å…¶ä¸­ä»»æ„ä¸€ç§å³å¯ smartcnsmartcn æ˜¯ Solr åŒæ­¥å‘è¡Œçš„ä¸€ä¸ªä¸­æ–‡åˆ†è¯åŒ…ï¼Œå°† solr-7.0.1/contrib/analysis-extras/lucene-libs/lucene-analyzers-smartcn-7.0.1.jar æ‹·è´è‡³ %SOLRHOME%/my_core/libï¼Œç¼–è¾‘ %SOLRHOME%/my_core/conf/managed-schema æ–‡ä»¶ï¼Œæ·»åŠ é…ç½® 12345678910&lt;!-- smartcn --&gt;&lt;fieldType name=\"text_smartcn\" class=\"solr.TextField\" positionIncrementGap=\"0\"&gt; &lt;analyzer type=\"index\"&gt; &lt;tokenizer class=\"org.apache.lucene.analysis.cn.smart.HMMChineseTokenizerFactory\"/&gt; &lt;/analyzer&gt; &lt;analyzer type=\"query\"&gt; &lt;tokenizer class=\"org.apache.lucene.analysis.cn.smart.HMMChineseTokenizerFactory\"/&gt; &lt;/analyzer&gt;&lt;/fieldType&gt;&lt;!-- smartcn --&gt; IKAnalyzer IKAnalyzer æ˜¯ä¸€ä¸ªå¼€æºçš„ï¼ŒåŸºäº java è¯­è¨€å¼€å‘çš„è½»é‡çº§çš„ä¸­æ–‡åˆ†è¯å·¥å…·åŒ…ã€‚ å°† ik-analyzer-solr5 æ‰“åŒ…åæ”¾è‡³ %SOLRHOME%/my_core/lib ä¸‹ç¼–è¾‘ %SOLRHOME%/my_core/conf/managed-schema æ–‡ä»¶ï¼Œæ·»åŠ é…ç½® 123456&lt;!-- IKAnalyzer --&gt;&lt;fieldType name=\"text_ik\" class=\"solr.TextField\"&gt; &lt;analyzer type=\"index\" isMaxWordLength=\"false\" class=\"org.wltea.analyzer.lucene.IKAnalyzer\"/&gt; &lt;analyzer type=\"query\" isMaxWordLength=\"true\" class=\"org.wltea.analyzer.lucene.IKAnalyzer\"/&gt;&lt;/fieldType&gt;&lt;!-- IKAnalyzer --&gt; mmseg4j mmseg4j ç”¨ Chih-Hao Tsai çš„ MMSeg ç®—æ³• å®ç°çš„ä¸­æ–‡åˆ†è¯å™¨ï¼Œå¹¶å®ç° lucene çš„ analyzer å’Œ solr çš„TokenizerFactory ä»¥æ–¹ä¾¿åœ¨Luceneå’ŒSolrä¸­ä½¿ç”¨ã€‚ MMSeg ç®—æ³•æœ‰ä¸¤ç§åˆ†è¯æ–¹æ³•ï¼š Simple å’Œ Complexï¼Œéƒ½æ˜¯åŸºäºæ­£å‘æœ€å¤§åŒ¹é…ã€‚ mmseg4j æœ‰ä¸‰ç§åˆ†è¯æ¨¡å¼ simple | complex | max-wordï¼Œé»˜è®¤æ˜¯ max-wordã€‚ mmseg4j çš„è¯åº“å¼ºåˆ¶ä½¿ç”¨ UTF-8ã€‚ ä¸‹è½½éœ€è¦çš„åŒ… mmseg4j-core-1.10.0.jar mmseg4j-solr-2.4.0.jar æ”¾è‡³ %SOLRHOME%/my_core/lib ä¸­ç¼–è¾‘ %SOLRHOME%/my_core/conf/managed-schema æ–‡ä»¶ï¼Œæ·»åŠ é…ç½® 1234567891011121314151617&lt;!-- mmseg4j--&gt;&lt;fieldType name=\"text_mmseg4j_complex\" class=\"solr.TextField\" positionIncrementGap=\"100\" &gt; &lt;analyzer&gt; &lt;tokenizer class=\"com.chenlb.mmseg4j.solr.MMSegTokenizerFactory\" mode=\"complex\"/&gt; &lt;/analyzer&gt;&lt;/fieldType&gt;&lt;fieldType name=\"text_mmseg4j_maxword\" class=\"solr.TextField\" positionIncrementGap=\"100\" &gt; &lt;analyzer&gt; &lt;tokenizer class=\"com.chenlb.mmseg4j.solr.MMSegTokenizerFactory\" mode=\"max-word\" /&gt; &lt;/analyzer&gt;&lt;/fieldType&gt;&lt;fieldType name=\"text_mmseg4j_simple\" class=\"solr.TextField\" positionIncrementGap=\"100\" &gt; &lt;analyzer&gt; &lt;tokenizer class=\"com.chenlb.mmseg4j.solr.MMSegTokenizerFactory\" mode=\"simple\" /&gt; &lt;/analyzer&gt;&lt;/fieldType&gt;&lt;!-- mmseg4j--&gt; é‡å¯æœåŠ¡ Analysisåˆ†è¯å™¨é…ç½®å®Œæˆåï¼Œé€‰æ‹© Analysisï¼Œè¾“å…¥è¦åˆ†è¯çš„å†…å®¹ï¼ˆField Valueï¼‰ï¼Œé€‰æ‹©å­—æ®µç±»å‹ï¼ˆAnalyse Fieldname / FieldType [ä¸é…ç½®ä¿¡æ¯ fieldType name åŒæ­¥]ï¼‰ï¼Œç‚¹å‡» Analyse Values è·å–åˆ†è¯ç»“æœã€‚ Analyse Values ç¼–è¾‘ %SOLRHOME%/my_core/conf/managed-schemaï¼Œä¿®æ”¹ç´¢å¼•å­—æ®µç±»å‹ä¸ºæ–°æ·»åŠ åˆ†è¯ç±»å‹å…¶ä¸­ä»»æ„ä¸€ç§å³å¯ï¼Œè¿™é‡Œæˆ‘ä»¬å°† text_general ä¿®æ”¹ä¸º text_ikï¼Œé‡å¯æœåŠ¡åé‡æ–°å¯¼å…¥æ•°æ® Modify Type è¿™æ ·æˆ‘ä»¬åœ¨å¯¹è¯¥å­—æ®µè¡Œè¿›æœç´¢æ—¶å°±èƒ½è¾¾åˆ°åˆ†è¯æœç´¢çš„æ•ˆæœäº†ğŸ˜›","tags":[{"name":"solr","slug":"solr","permalink":"http://xyue.me/tags/solr/"}]},{"title":"ä½¿ç”¨ UEditor(JSP 1.4.3ç‰ˆæœ¬) é‡åˆ°çš„é—®é¢˜","date":"2017-10-12T09:02:01.000Z","path":"2017/10/12/problems-of-using-ueditor/","text":"ueditorç®€ä»‹: UEditoræ˜¯ç”±ç™¾åº¦webå‰ç«¯ç ”å‘éƒ¨å¼€å‘æ‰€è§å³æ‰€å¾—å¯Œæ–‡æœ¬webç¼–è¾‘å™¨ï¼Œå…·æœ‰è½»é‡ï¼Œå¯å®šåˆ¶ï¼Œæ³¨é‡ç”¨æˆ·ä½“éªŒç­‰ç‰¹ç‚¹ï¼Œå¼€æºåŸºäºMITåè®®ï¼Œå…è®¸è‡ªç”±ä½¿ç”¨å’Œä¿®æ”¹ä»£ç â€¦ é‡åˆ°é—®é¢˜åŠè§£å†³æ–¹æ¡ˆsetContentæŠ¥é”™æè¿°å½“ä½¿ç”¨setContentç»™åˆå§‹åŒ–å®¹å™¨è®¾ç½®å†…å®¹æ—¶å‡ºç°å¦‚ä¸‹é”™è¯¯ï¼š åŸå› å¼‚æ­¥ï¼Œåˆå§‹åŒ–å®¹å™¨å¹¶æœªåˆ›å»ºå®Œæˆï¼Œéœ€ç­‰å¾…ç¼–è¾‘å™¨åˆ›å»ºå®Œæˆåæ‰èƒ½ä½¿ç”¨ã€‚ è§£å†³æ–¹æ³•ä¸€ä½¿ç”¨setTimeoutå»¶è¿Ÿä¸€æ®µæ—¶é—´åè°ƒç”¨ï¼ˆä¸å»ºè®®ï¼šç”±äºsetTimeoutè®¾ç½®çš„æ—¶é—´ä¸å®é™…æ¸²æŸ“éœ€è¦çš„æ—¶é—´ä¸ä¸€è‡´ï¼‰ï¼› æ–¹æ³•äºŒä½¿ç”¨addListener(â€˜readyâ€™,callback)ï¼Œå¾…ç¼–è¾‘å™¨åˆ›å»ºå®Œæˆåæ‰§è¡Œcallbackå›è°ƒã€‚123ue.addListener('ready', function () &#123; ue.setContent(content);&#125;); ä¸Šä¼ æ–‡ä»¶â€”â€”â€œæœªæ‰¾åˆ°ä¸Šä¼ æ•°æ®â€æè¿°æ— è®ºä¸Šä¼ ä»€ä¹ˆæ–‡ä»¶å‡å‡ºç°å¦‚ä¸‹é”™è¯¯ï¼š åŸå›  struts2ï¼šstruts2 æ¡†æ¶é»˜è®¤ä½¿ç”¨ apache çš„ commons-fileUpload ç»„ä»¶å’Œå†…å»ºçš„ FileUploadInterceptor æ‹¦æˆªå™¨å®ç°ä¸Šä¼ ï¼Œä¼šå°† request æ–‡ä»¶åŸŸå°è£…åˆ° action ä¸­ä¸€ä¸ª File ç±»å‹çš„å±æ€§ä¸­ï¼Œå¹¶åˆ é™¤ request ä¸­çš„æ–‡ä»¶åŸŸï¼Œå› æ­¤ä¼šä¸Šä¼ æ–‡ä»¶å¤±è´¥ã€‚ springMVCï¼šUEditor é»˜è®¤ä½¿ç”¨ commons ç»„ä»¶ï¼Œè€Œ springMVC å¯¹ commons ç»„ä»¶è¿›è¡Œäº†å°è£…ï¼Œä½¿å¾—ä¸Šä¼ åè·å–ä¸åˆ°æ–‡ä»¶ã€‚ è§£å†³ struts2ï¼šè‡ªå®šä¹‰ä¸€ä¸ª struts è¿‡æ»¤å™¨ï¼ŒæŒ‡å®šä¸å¯¹ ueditor/jsp/ ç›®å½•ä¸‹çš„ jsp é¡µé¢è¿›è¡Œè¿‡æ»¤ã€‚ 12345678910111213141516public class MyStrutsFilter extends StrutsPrepareAndExecuteFilter&#123; @Override public void doFilter(ServletRequest req, ServletResponse res, FilterChain chain) throws IOException, ServletException &#123; HttpServletRequest request = (HttpServletRequest) req; String url = request.getRequestURI(); System.out.println(url); if (url.contains(request.getContextPath()+\"/js/utf8-jsp/jsp/controller.jsp\")) &#123; System.out.println(\"ä½¿ç”¨è‡ªå®šä¹‰è¿‡æ»¤å™¨\"); chain.doFilter(req, res); &#125;else&#123; System.out.println(\"ä½¿ç”¨é»˜è®¤è¿‡æ»¤å™¨\"); super.doFilter(req, res, chain); &#125; &#125;&#125; springMVCï¼šä¿®æ”¹æºç  upload åŒ…ä¸‹çš„ BinaryUploader.java æ–‡ä»¶ã€‚ä¸‹è½½å¹¶ä½¿ç”¨æºç ï¼š é‡å†™ BinaryUploader.java ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849public class BinaryUploader &#123; public static final State save(HttpServletRequest request,Map&lt;String, Object&gt; conf) &#123; InputStream fileStream = null; if (!ServletFileUpload.isMultipartContent(request)) &#123; return new BaseState(false, AppInfo.NOT_MULTIPART_CONTENT); &#125; try &#123; //ä¿®æ”¹äº†ç™¾åº¦ä½¿ç”¨åŸç”Ÿçš„commonsä¸Šä¼ æ–¹å¼ DefaultMultipartHttpServletRequest multipartRequest=(DefaultMultipartHttpServletRequest)request; Iterator&lt;String&gt; fileNames=multipartRequest.getFileNames(); MultipartFile file=null; while (fileNames.hasNext())&#123; file=multipartRequest.getFiles(fileNames.next()).get(0); fileStream=file.getInputStream(); &#125; if (fileStream == null) &#123; return new BaseState(false, AppInfo.NOTFOUND_UPLOAD_DATA); &#125; String savePath = (String) conf.get(\"savePath\"); String originFileName = file.getOriginalFilename(); String suffix = FileType.getSuffixByFilename(originFileName); originFileName = originFileName.substring(0,originFileName.length() - suffix.length()); savePath = savePath + suffix; long maxSize = ((Long) conf.get(\"maxSize\")).longValue(); if (!BinaryUploader.validType(suffix, (String[]) conf.get(\"allowFiles\"))) &#123; return new BaseState(false, AppInfo.NOT_ALLOW_FILE_TYPE); &#125; savePath = PathFormat.parse(savePath, originFileName); String physicalPath = (String) conf.get(\"rootPath\") + savePath; State storageState = StorageManager.saveFileByInputStream(fileStream,physicalPath, maxSize); fileStream.close(); if (storageState.isSuccess()) &#123; storageState.putInfo(\"url\", PathFormat.format(savePath)); storageState.putInfo(\"type\", suffix); storageState.putInfo(\"original\", originFileName + suffix); &#125; return storageState; &#125; catch (ClassCastException e) &#123; return new BaseState(false, AppInfo.PARSE_REQUEST_ERROR); &#125;catch (IOException e)&#123; return new BaseState(false, AppInfo.IO_ERROR); &#125; &#125; private static boolean validType(String type, String[] allowTypes) &#123; List&lt;String&gt; list = Arrays.asList(allowTypes); return list.contains(type); &#125;&#125; ä¸Šä¼ æ–‡ä»¶æ¶ˆå¤±æè¿°ä½¿ç”¨ tomcat ï¼Œå·²ä¸Šä¼ æ–‡ä»¶åœ¨é‡æ–°éƒ¨ç½²é¡¹ç›®åä¸¢å¤±ã€‚ åŸå› UEditor ä¸Šä¼ é…ç½®æ–‡ä»¶ config.json é»˜è®¤å°†ä¸Šä¼ æ–‡ä»¶ä¸Šä¼ åˆ°é¡¹ç›®ä¸­ï¼Œé‡æ–°éƒ¨ç½²ä¼šæ¸…ç©ºé¡¹ç›®æ–‡ä»¶ã€‚ è§£å†³æ–¹æ³•ä¸€ï¼šä¿®æ”¹ä¸Šä¼ è·¯å¾„åˆ°webappsç›®å½•ä¸‹ç¬¬ä¸€æ­¥ï¼šå°†é…ç½®æ–‡ä»¶ä¸­ä¸Šä¼ ä¿å­˜è·¯å¾„/ueditor/jsp/upload/image/{yyyy}{mm}{dd}/{time}{rand:6}ä¿®æ”¹ä¸º/../ueditor/jsp/upload/image/{yyyy}{mm}{dd}/{time}{rand:6} ç¬¬äºŒæ­¥ï¼šä¿®æ”¹è¿”å›æ–‡ä»¶è¯·æ±‚åœ°å€ï¼Œå°†é‡å†™å BinaryUploader.java ç¬¬33è¡Œçš„PathFormat.format(savePath)ä¿®æ”¹ä¸ºPathFormat.format(savePath).replace(&quot;/..&quot;, &quot;&quot;) æ–¹æ³•äºŒï¼šé…ç½® tomcat è™šæ‹Ÿç›®å½•ç¬¬ä¸€æ­¥ï¼šæ‰“å¼€ %TOMCAT_HOME%/conf/server.xmlï¼ˆå³tomcatçš„å®‰è£…ç›®å½•ä¸‹é¢ç›¸å…³çš„æ–‡ä»¶ï¼‰ï¼Œåœ¨ Host ä¸­åŠ å…¥å¦‚ä¸‹ä»£ç ï¼š123&lt;Host name=\"localhost\" appBase=\"webapps\" unpackWARs=\"true\" autoDeploy=\"true\"&gt; &lt;Context path=\"/ueditor\" docBase=\"D:\\ueditor\" reloadable=\"true\"&gt;&lt;/Context&gt; &lt;/Host&gt; ç¬¬äºŒæ­¥ï¼šä¿®æ”¹ä¸Šä¼ è·¯å¾„ï¼Œå°†é‡å†™å BinaryUploader.java ç¬¬29è¡Œçš„(String) conf.get(&quot;rootPath&quot;) + savePathä¿®æ”¹ä¸º&quot;D://&quot; + savePath ä¸Šä¼ è·¯å¾„ä¸è™šæ‹Ÿç›®å½• docBase ä¿æŒä¸€è‡´","tags":[{"name":"å¯Œæ–‡æœ¬ç¼–è¾‘å™¨","slug":"å¯Œæ–‡æœ¬ç¼–è¾‘å™¨","permalink":"http://xyue.me/tags/å¯Œæ–‡æœ¬ç¼–è¾‘å™¨/"},{"name":"UEditor","slug":"UEditor","permalink":"http://xyue.me/tags/UEditor/"}]},{"title":"Master-Worker è®¾è®¡æ¨¡å¼","date":"2017-09-30T07:02:36.000Z","path":"2017/09/30/master-worker-design/","text":"ä»‹ç»Master-Workeræ˜¯å¸¸ç”¨çš„å¹¶è¡Œè®¡ç®—æ¨¡å¼ã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ç³»ç»Ÿç”±ä¸¤ç±»è¿›ç¨‹åä½œå·¥ä½œï¼š Masterè¿›ç¨‹ï¼šè´Ÿè´£æ¥æ”¶å’Œåˆ†é…ä»»åŠ¡ Workerè¿›ç¨‹ï¼šè´Ÿè´£å¤„ç†å­ä»»åŠ¡ å½“å„ä¸ªWorkerå­è¿›ç¨‹å¤„ç†å®Œæˆå ï¼Œä¼šå°†ç»“æœè¿”å›ç»™Masterï¼Œç”±Masterä½œå½’çº³æ€»ç»“ã€‚å…¶å¥½å¤„å°±æ˜¯èƒ½å°†ä¸€ä¸ªå¤§ä»»åŠ¡åˆ†è§£æˆè‹¥å¹²ä¸ªå°ä»»åŠ¡ï¼Œå¹¶è¡Œæ‰§è¡Œï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„ååé‡ã€‚å„è§’è‰²å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š Masterè¿›ç¨‹ä¸ºä¸»è¦è¿›ç¨‹ï¼Œå®ƒç»´æŠ¤ä¸€ä¸ªWorkerè¿›ç¨‹é˜Ÿåˆ—ã€å­ä»»åŠ¡é˜Ÿåˆ—å’Œå­ç»“æœé›†ã€‚Workerè¿›ç¨‹é˜Ÿåˆ—ä¸­çš„Workerè¿›ç¨‹ä¸åœä»ä»»åŠ¡é˜Ÿåˆ—ä¸­æå–è¦å¤„ç†çš„å­ä»»åŠ¡ï¼Œå¹¶å°†ç»“æœå†™å…¥ç»“æœé›†ã€‚ æ ¹æ®ä¸Šé¢çš„æ€æƒ³ï¼Œæˆ‘ä»¬æ¥æ¨¡æ‹Ÿä¸€ä¸‹è¿™ç§ç»å…¸è®¾è®¡æ¨¡å¼çš„å®ç°ã€‚ åˆ†æè¿‡ç¨‹ æ—¢ç„¶Workeræ˜¯å…·ä½“çš„æ‰§è¡Œä»»åŠ¡ï¼Œé‚£ä¹ˆWorkerä¸€å®šè¦å®ç°Runnableæ¥å£ Matserä½œä¸ºæ¥å—å’Œåˆ†é…ä»»åŠ¡ï¼Œå¾—å…ˆæœ‰ä¸ªå®¹å™¨æ¥è£…è½½ç”¨æˆ·å‘å‡ºçš„è¯·æ±‚ï¼Œåœ¨ä¸è€ƒè™‘é˜»å¡çš„æƒ…å†µä¸‹æˆ‘ä»¬é€‰æ‹©ConcurrentLinkedQueueä½œä¸ºè£…è½½å®¹å™¨ Workerå¯¹è±¡éœ€è¦èƒ½ä»Masteræ¥æ”¶ä»»åŠ¡ï¼Œå®ƒä¹Ÿå¾—æœ‰Master ConcurrentLinkedQueueå®¹å™¨çš„å¼•ç”¨ Masterè¿˜å¾—æœ‰ä¸ªå®¹å™¨éœ€è¦èƒ½å¤Ÿè£…è½½æ‰€æœ‰çš„Workerï¼Œå¯ä»¥ä½¿ç”¨HashMap&lt;String,Thread&gt; Workerå¤„ç†å®Œåéœ€è¦å°†æ•°æ®è¿”å›ç»™Masterï¼Œé‚£ä¹ˆMasteréœ€è¦æœ‰ä¸ªå®¹å™¨èƒ½å¤Ÿè£…è½½æ‰€æœ‰workerå¹¶å‘å¤„ç†ä»»åŠ¡çš„ç»“æœé›†ã€‚æ­¤å®¹å™¨éœ€è¦èƒ½å¤Ÿæ”¯æŒé«˜å¹¶å‘ï¼Œæ‰€ä»¥æœ€å¥½é‡‡ç”¨ConcurrentHashMap&lt;String,Object&gt; åŒç†ç”±äºWorkerå¤„ç†å®Œæˆåå°†æ•°æ®å¡«å……è¿›Masterçš„ConcurrentHashMapï¼Œé‚£ä¹ˆå®ƒä¹Ÿå¾—æœ‰ä¸€ä»½ConcurrentHashMapçš„å¼•ç”¨ ä»£ç å®ç°Taskä»»åŠ¡å¯¹è±¡1234567891011121314151617181920212223242526272829public class Task &#123; private int id; private String name; private int price; public int getId() &#123; return id; &#125; public void setId(int id) &#123; this.id = id; &#125; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; public int getPrice() &#123; return price; &#125; public void setPrice(int price) &#123; this.price = price; &#125;&#125; Masterå¯¹è±¡12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152public class Master &#123; //ä»»åŠ¡é›†åˆ private ConcurrentLinkedQueue&lt;Task&gt; taskQueue = new ConcurrentLinkedQueue&lt;&gt;(); //æ‰€æœ‰çš„å¤„ç†ç»“æœ private ConcurrentHashMap&lt;String,Object&gt; resultMap = new ConcurrentHashMap&lt;&gt;(); //æ‰€æœ‰çš„Workeré›†åˆ private HashMap&lt;String,Thread&gt; workerMap = Maps.newHashMap(); //æ„é€ æ–¹æ³•ï¼Œåˆå§‹åŒ–Worker public Master(Worker worker,int workerCount)&#123; //æ¯ä¸€ä¸ªworkerå¯¹è±¡éƒ½éœ€è¦æœ‰Masterçš„å¼•ç”¨ï¼ŒtaskQueueç”¨äºä»»åŠ¡çš„æå–ï¼ŒresultMapç”¨äºä»»åŠ¡çš„æäº¤ worker.setTaskQueue(this.taskQueue); worker.setResultMap(this.resultMap); for(int i = 0 ;i &lt; workerCount; i++)&#123; //keyè¡¨ç¤ºworkerçš„åå­—,valueè¡¨ç¤ºçº¿ç¨‹æ‰§è¡Œå¯¹è±¡ workerMap.put(\"worker\"+i,new Thread(worker)); &#125; &#125; //ç”¨äºæäº¤ä»»åŠ¡ public void submit(Task task)&#123; this.taskQueue.add(task); &#125; //æ‰§è¡Œæ–¹æ³•ï¼Œå¯åŠ¨åº”ç”¨ç¨‹åºè®©æ‰€æœ‰çš„Workerå·¥ä½œ public void execute()&#123; for(Map.Entry&lt;String,Thread&gt; me : workerMap.entrySet())&#123; me.getValue().start(); &#125; &#125; //åˆ¤æ–­æ‰€æœ‰çš„çº¿ç¨‹æ˜¯å¦éƒ½å®Œæˆä»»åŠ¡ public boolean isComplete() &#123; for(Map.Entry&lt;String,Thread&gt; me : workerMap.entrySet())&#123; if(me.getValue().getState() != Thread.State.TERMINATED)&#123; return false; &#125; &#125; return true; &#125; //æ€»ç»“å½’çº³ public int getResult()&#123; int ret = 0; for (Map.Entry&lt;String, Object&gt; entry : resultMap.entrySet()) &#123; ret+=(Integer) entry.getValue(); &#125; return ret; &#125;&#125; Workerå¯¹è±¡123456789101112131415161718192021222324252627282930313233343536public class Worker implements Runnable&#123; private ConcurrentLinkedQueue&lt;Task&gt; taskQueue; private ConcurrentHashMap&lt;String, Object&gt; resultMap; public void setTaskQueue(ConcurrentLinkedQueue&lt;Task&gt; taskQueue) &#123; this.taskQueue = taskQueue; &#125; public void setResultMap(ConcurrentHashMap&lt;String, Object&gt; resultMap) &#123; this.resultMap = resultMap; &#125; @Override public void run() &#123; while(true)&#123; Task executeTask = this.taskQueue.poll(); if(executeTask == null) break; //çœŸæ­£çš„ä»»åŠ¡å¤„ç† Object result = handle(executeTask); this.resultMap.put(executeTask.getName(),result); &#125; &#125; //æ ¸å¿ƒå¤„ç†é€»è¾‘ï¼Œå¯ä»¥æŠ½ç¦»å‡ºæ¥ç”±å…·ä½“å­ç±»å®ç° private Object handle(Task executeTask) &#123; Object result = null; try &#123; //è¡¨ç¤ºå¤„ç†ä»»åŠ¡çš„è€—æ—¶.... Thread.sleep(500); result = executeTask.getPrice(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; return result; &#125;&#125; Clientè°ƒç”¨12345678910111213141516171819202122232425public class Client &#123; public static void main(String[] args) &#123; //å®é™…å¼€å‘ä¸­å¤šå°‘ä¸ªçº¿ç¨‹æœ€å¥½å†™æˆRuntime.getRuntime().availableProcessors() Master master = new Master(new Worker(), 10); Random random = new Random(); for(int i = 0 ;i &lt;= 100 ;i++)&#123; Task task = new Task(); task.setId(i); task.setName(\"ä»»åŠ¡\"+i); task.setPrice(random.nextInt(1000)); master.submit(task); &#125; master.execute(); long start = System.currentTimeMillis(); while(true)&#123; if(master.isComplete())&#123; long end = System.currentTimeMillis() - start; int ret = master.getResult(); System.out.println(\"è®¡ç®—ç»“æœ:\"+ret+\",æ‰§è¡Œè€—æ—¶:\"+end); break; &#125; &#125; &#125;&#125; åœ¨Workerå¯¹è±¡ä¸­çš„æ ¸å¿ƒå¤„ç†ä¸šåŠ¡é€»è¾‘handleæ–¹æ³•æœ€å¥½æŠ½è±¡æˆå…¬å…±æ–¹æ³•ï¼Œå…·ä½“å®ç°ç”±å­ç±»è¦†å†™ã€‚","tags":[{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"http://xyue.me/tags/å¤šçº¿ç¨‹/"},{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"http://xyue.me/tags/è®¾è®¡æ¨¡å¼/"},{"name":"java","slug":"java","permalink":"http://xyue.me/tags/java/"}]},{"title":"JS ä¸­çš„å€¼ä¼ é€’","date":"2017-09-12T02:12:17.000Z","path":"2017/09/12/value-passing-in-js/","text":"å€¼ä¼ é€’?ç›¸ä¿¡åœ¨çœ‹åˆ°è¿™ä¸ªæ ‡é¢˜æ—¶ï¼Œå¾ˆå¤šç«¥é‹éƒ½ä¼šæœ‰è¿™æ ·çš„ç–‘æƒ‘â€”â€”â€œWhat?ä¸æ˜¯è¿˜æœ‰å¼•ç”¨ä¼ é€’ä¹ˆâ€ã€‚åƒè¿™æ ·ï¼š1234567var person = &#123; name : 'lilei' &#125;;function setName (obj) &#123; obj.name = 'hanmeimei'; console.log(obj.name); //output: hanmeimei&#125;setName(person);console.log(person.name); //output: hanmeimei ç¡®å®ï¼Œå¯¹è±¡personå±æ€§nameçš„å€¼è¢«æ”¹å˜äº†ï¼Œæœ€åˆçš„æˆ‘å¯¹æ­¤ä¹Ÿæ˜¯æ·±ä¿¡ä¸ç–‘ã€‚åœ¨ã€ŠJavaScripté«˜çº§ç¨‹åºè®¾è®¡ã€‹ç¬¬ä¸‰ç‰ˆ 4.1.3ä¸­ï¼Œå…³äºå‚æ•°çš„ä¼ é€’è¿™æ ·è®²åˆ°ï¼š ECMAScriptä¸­æ‰€æœ‰å‡½æ•°çš„å‚æ•°éƒ½æ˜¯æŒ‰å€¼ä¼ é€’çš„ã€‚ å•¥å­å“ï¼è¿çº¢å®ä¹¦éƒ½è¿™æ ·è¯´ï¼Œé‚£å¯å¾—å¥½å¥½æ·±ç©¶ä¸‹ã€‚ å®šä¹‰åœ¨è§£å¼€ç–‘æƒ‘å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸‹ä»€ä¹ˆæ˜¯æŒ‰å€¼ä¼ é€’(call by value)ï¼Œä»€ä¹ˆæ˜¯æŒ‰å¼•ç”¨ä¼ é€’(call by reference)ã€‚åœ¨è®¡ç®—æœºç§‘å­¦é‡Œï¼Œè¿™ä¸ªéƒ¨åˆ†å«æ±‚å€¼ç­–ç•¥(Evaluation Strategy)ã€‚å®ƒå†³å®šå˜é‡ä¹‹é—´ã€å‡½æ•°è°ƒç”¨æ—¶å®å‚å’Œå½¢å‚ä¹‹é—´å€¼æ˜¯å¦‚ä½•ä¼ é€’çš„ã€‚ ä¼ é€’æ–¹å¼ å€¼ä¼ é€’(call by value)å¸¸ç”¨çš„æ±‚å€¼ç­–ç•¥ï¼Œå‡½æ•°çš„å½¢å‚æ˜¯è¢«è°ƒç”¨æ—¶æ‰€ä¼ å®å‚çš„å‰¯æœ¬ã€‚ä¿®æ”¹å½¢å‚çš„å€¼å¹¶ä¸ä¼šå½±å“å®å‚ã€‚ å¼•ç”¨ä¼ é€’(call by reference)å‡½æ•°çš„å½¢å‚æ¥æ”¶å®å‚çš„éšå¼å¼•ç”¨ï¼Œè€Œä¸å†æ˜¯å‰¯æœ¬ã€‚è¿™æ„å‘³ç€å‡½æ•°å½¢å‚çš„å€¼å¦‚æœè¢«ä¿®æ”¹ï¼Œå®å‚ä¹Ÿä¼šè¢«ä¿®æ”¹ã€‚åŒæ—¶ä¸¤è€…æŒ‡å‘ç›¸åŒçš„å€¼ã€‚ æ•°æ®ç±»å‹ECMAScriptåŒ…æ‹¬ä¸¤ä¸ªä¸åŒç±»å‹çš„å€¼ï¼šåŸºæœ¬æ•°æ®ç±»å‹å’Œå¼•ç”¨æ•°æ®ç±»å‹ã€‚ åŸºæœ¬æ•°æ®ç±»å‹ï¼šä¿å­˜åœ¨æ ˆå†…å­˜ä¸­çš„ç®€å•æ•°æ®æ®µï¼Œå¸¸è§çš„åŸºæœ¬æ•°æ®ç±»å‹ Numberã€String ã€Booleanã€Nullå’ŒUndefinedï¼Œæœ€æ–°çš„ECMAScriptæ ‡å‡†å®šä¹‰åŠ å…¥äº†Symbolã€‚ å¼•ç”¨æ•°æ®ç±»å‹ï¼šä¿å­˜åœ¨å †å†…å­˜ä¸­çš„ç”±å¤šä¸ªå€¼æ„æˆçš„å¯¹è±¡ï¼Œæ¯”å¦‚ï¼šArrayã€Functionå’ŒObjectï¼Œä»åº•å±‚æŠ€æœ¯ä¸Šçœ‹ï¼Œå®ƒä»¬ä¸‰éƒ½æ˜¯å¯¹è±¡ã€‚ä¸å…¶ä»–è¯­è¨€çš„ä¸åŒæ˜¯ï¼Œä½ ä¸å¯ä»¥ç›´æ¥è®¿é—®å †å†…å­˜ç©ºé—´ä¸­çš„ä½ç½®å’Œæ“ä½œå †å†…å­˜ç©ºé—´ã€‚åªèƒ½æ“ä½œå¯¹è±¡åœ¨æ ˆå†…å­˜ä¸­çš„å¼•ç”¨åœ°å€ã€‚ å¼•ç”¨ä¼ é€’?å¦‚æœä¸€ä¸ªåŸºæœ¬æ•°æ®ç±»å‹ç»‘å®šç»™æŸä¸ªå˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºè¯¥å˜é‡åŒ…å«è¿™ä¸ªåŸºæœ¬æ•°æ®ç±»å‹çš„å€¼ã€‚1234567var name = 'lilei';function setName (n) &#123; n = 'hanmeimei'; console.log(n); //output: hanmeimei&#125;setName(name);console.log(name); //output: lilei å½“æˆ‘ä»¬å°†æ–°å€¼é‡æ–°èµ‹ç»™å˜é‡ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œ name å€¼å¹¶æ²¡æœ‰æ”¹å˜,å®é™…ä¸Š n åªæ˜¯ä¿å­˜äº† name å¤åˆ¶çš„ä¸€ä¸ªå‰¯æœ¬(å‡½æ•°çš„å½¢å‚æ˜¯è¢«è°ƒç”¨æ—¶æ‰€ä¼ å®å‚çš„å‰¯æœ¬)ã€‚ å˜é‡ å€¼ name lilei n lilei æ‰€ä»¥ï¼Œn çš„æ”¹å˜å¯¹ name æ²¡æœ‰å½±å“ã€‚ å˜é‡ å€¼ name lilei n hanmeimei æˆ‘ä»¬æŠŠå®ƒç§°ä½œå€¼ä¼ é€’ã€‚å¯ä»¥è¿™æ ·ç†è§£ï¼Œå½“ä¼ é€’ name åˆ°å‡½æ•° setName ä¸­ï¼Œç›¸å½“äºæ‹·è´äº†ä¸€ä»½ name ï¼Œå‡è®¾æ‹·è´çš„è¿™ä»½å« _name ï¼Œå‡½æ•°ä¸­ä¿®æ”¹çš„éƒ½æ˜¯ _name çš„å€¼ï¼Œè€Œä¸ä¼šå½±å“åŸæ¥çš„ name å€¼ã€‚ å›åˆ°æœ€å‰è¾¹æˆ‘ä»¬çœ‹åˆ°çš„é‚£æ®µä»£ç ï¼Œç¨åŠ æ”¹åŠ¨:12345678var person = &#123; name : 'lilei' &#125;;function setName (obj) &#123; // obj.name = 'hanmeimei'; obj = &#123; name : 'hanmeimei' &#125;; console.log(obj.name); //output: hanmeimei&#125;setName(person);console.log(person.name); //output: lilei æ‰€è°“æŒ‰å¼•ç”¨ä¼ é€’ï¼Œå°±æ˜¯ä¼ é€’å¯¹è±¡çš„å¼•ç”¨ï¼Œå‡½æ•°å†…éƒ¨å¯¹å‚æ•°çš„ä»»ä½•æ”¹å˜éƒ½ä¼šå½±å“è¯¥å¯¹è±¡çš„å€¼ï¼Œå› ä¸ºä¸¤è€…å¼•ç”¨çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚ä½†è¿™é‡Œ obj çš„æ”¹å˜å¹¶æ²¡æœ‰å½±å“ personï¼Œè¿™ç©¶ç«Ÿæ˜¯å¼•ç”¨ä¼ é€’å—ï¼Ÿ è§£æƒ‘çœ‹åˆ°è¿™ï¼Œç›¸ä¿¡ä½ å¯¹ä¹‹å‰çš„ç†è§£å·²æœ‰äº†ä¸ä¸€æ ·çš„è®¤è¯†ã€‚æ—¢ç„¶è¿™ä¸æ˜¯å¼•ç”¨ä¼ é€’ï¼Œè¿˜ä¼šæ˜¯å€¼ä¼ é€’ä¹ˆï¼Ÿ åŸºæœ¬æ•°æ®ç±»å‹ä¼ é€’å€¼ï¼Œå¼•ç”¨æ•°æ®ç±»å‹ä¼ é€’å¼•ç”¨åœ°å€(å¼•ç”¨ç±»å‹æ•°æ®åœ¨æ ˆå†…å­˜ä¸­ä¿å­˜çš„å®é™…ä¸Šæ˜¯å¯¹è±¡åœ¨å †å†…å­˜ä¸­çš„å¼•ç”¨åœ°å€ã€‚é€šè¿‡è¿™ä¸ªå¼•ç”¨åœ°å€å¯ä»¥å¿«é€ŸæŸ¥æ‰¾åˆ°ä¿å­˜ä¸­å †å†…å­˜ä¸­çš„å¯¹è±¡)ã€‚ æ­£å¦‚å‰è¾¹å®šä¹‰æ‰€æåˆ°çš„é‚£æ ·ï¼Œå€¼ä¼ é€’ï¼Œå‡½æ•°çš„å½¢å‚æ˜¯è¢«è°ƒç”¨æ—¶æ‰€ä¼ å®å‚çš„å‰¯æœ¬ã€‚ä¸éš¾ç†è§£ï¼Œå½“ person å˜é‡ å€¼ åœ°å€ å¯¹è±¡ person &lt;#001&gt; #001 { name : â€˜lileiâ€™ } åšä¸ºå‚æ•°è¿›å…¥å‡½æ•° setName åï¼Œå°±æœ‰äº†åœ°å€å‰¯æœ¬ï¼Œè¿™ä¸ªåœ°å€å‰¯æœ¬å’Œ person çš„åœ°å€æŒ‡å‘æ˜¯ç›¸åŒçš„ã€‚ å˜é‡ å€¼ åœ°å€ å¯¹è±¡ person &lt;#001&gt; #001 { name : â€˜lileiâ€™ } obj &lt;#001&gt; #001 &lt;#002&gt; #002 { name : â€˜hanmeimeiâ€™ } å¦‚æœè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯¹è¿™ä¸ªå‰¯æœ¬æ“ä½œæ”¹å˜å…¶å±æ€§å€¼ï¼Œåˆ™æŒ‡å‘è¿™ä¸ªåœ°å€çš„å˜é‡éƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚ä½†æˆ‘ä»¬ä¸º obj é‡æ–°èµ‹äº†å€¼ï¼Œå°†åœ°å€å‰¯æœ¬æŒ‡å‘æ”¹å˜ï¼ŒæŒ‡å‘äº†æ–°çš„å¯¹è±¡ã€‚ å˜é‡ å€¼ åœ°å€ å¯¹è±¡ person &lt;#001&gt; #001 { name : â€˜lileiâ€™ } obj &lt;#002&gt; #002 { name : â€˜hanmeimeiâ€™ } è¿™æ ·ä¸€æ¥ obj å’Œ person å°±å®Œå…¨æ–­äº†ï¼Œ obj çš„æ”¹å˜å¹¶ä¸ä¼šå½±å“ personã€‚ ä¼ é€’å¯¹è±¡å¼•ç”¨çš„å‰¯æœ¬ï¼Œè¿™æ ·çš„ä¼ é€’æ–¹å¼åˆè¢«ç§°ä¹‹ä¸ºå…±äº«ä¼ é€’(call by sharing)ã€‚æ‹·è´å‰¯æœ¬ï¼Œä¹Ÿæ˜¯ä¸€ç§å€¼çš„æ‹·è´ï¼Œæ‰€ä»¥åœ¨JSä¸­åªæœ‰å€¼ä¼ é€’ã€‚ğŸ˜‰","tags":[{"name":"javascript","slug":"javascript","permalink":"http://xyue.me/tags/javascript/"}]},{"title":"å¦‚ä½•è®©å…ƒç´ é‡Œçš„ div å‚ç›´å±…ä¸­","date":"2017-09-08T09:35:58.000Z","path":"2017/09/08/div-vertical-center/","text":"å·²çŸ¥å®½é«˜å…ƒç´ ç»å¯¹å®šä½ä¸è´Ÿè¾¹è·å®ç°ã€‚åˆ©ç”¨ç»å¯¹å®šä½ï¼Œå°†å…ƒç´ çš„topå’Œleftå±æ€§éƒ½è®¾ä¸º50%ï¼Œå†åˆ©ç”¨marginè¾¹è·ï¼Œå°†å…ƒç´ å›æ‹‰å®ƒæœ¬èº«é«˜å®½çš„ä¸€åŠï¼Œå®ç°å‚ç›´å±…ä¸­ã€‚ 123456789101112#container &#123; position:relative;&#125;#div &#123; position:absolute; width: x; height: y; top: 50%; left: 50%; margin: -x / 2 0 0 -y / 2;&#125; æœªçŸ¥å®½é«˜å…ƒç´ æ–¹æ³•ä¸€ä½¿ç”¨ç»å¯¹å®šä½ä¸marginã€‚ 123456789101112#container &#123; position:relative;&#125;#div &#123; position: absolute; margin: 0 auto; top: 0; bottom: 0; left: 0; right: 0;&#125; æ–¹æ³•äºŒå½“è¦è¢«å±…ä¸­çš„å…ƒç´ æ˜¯å†…è”å…ƒç´ çš„æ—¶å€™ï¼Œå°†çˆ¶çº§å®¹å™¨è®¾ç½®ä¸ºdisplay:table-cellï¼Œé…åˆtext-align:centerå’Œvertical-align:middleå³å¯ä»¥å®ç°æ°´å¹³å‚ç›´å±…ä¸­ã€‚ 12345#container &#123; display:table-cell; text-align:center; vertical-align:middle;&#125; æ–¹æ³•ä¸‰ä½¿ç”¨css3çš„transformã€‚ 12345678910#container &#123; position:relative;&#125; #div &#123; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);&#125; æ–¹æ³•å››ä½¿ç”¨flexå¸ƒå±€ã€‚ 12345#container &#123; display:flex; justify-content:center; align-items: center;&#125;","tags":[{"name":"css","slug":"css","permalink":"http://xyue.me/tags/css/"},{"name":"å±…ä¸­","slug":"å±…ä¸­","permalink":"http://xyue.me/tags/å±…ä¸­/"}]}]